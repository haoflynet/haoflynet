<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <title>Docker - 我的Wiki</title>
  

  <link rel="shortcut icon" href="../../img/favicon.ico">

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">

  
  <script>
    // Current page data
    var mkdocs_page_name = "Docker";
    var mkdocs_page_input_path = "Other Tools/Docker.md";
    var mkdocs_page_url = "/Other Tools/Docker/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script>
  <script src="../../js/theme.js"></script> 

  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> 我的Wiki</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../..">Home</a>
        
    </li>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>code</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../code/安全测试/">安全测试</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../code/编码经验/">编码经验</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../code/代码审查清单/">代码审查清单</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../code/正则表达式/">正则表达式</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../code/packages/">packages</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>python</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../python/Django/">Django</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../python/Flask/">Flask</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../python/kivy/">kivy</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../python/pybrain/">pybrain</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../python/Django/">Django</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../python/PyQT/">PyQT</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../python/pytest/">pytest</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../python/python/">python</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../python/Scrapy-PySpider/">Scrapy-PySpider</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../python/Splinter/">Splinter</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../python/string/">string</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../python/Tornado/">Tornado</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>frontend</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../frontend/bootstrap/">bootstrap</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../frontend/js/">js</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../frontend/css/">css</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../frontend/frontend/">frontend</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../frontend/gulp/">gulp</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../frontend/html/">html</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../frontend/nodejs/">nodejs</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Database</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Database/MySQL and Mriadb/">MySQL and Mriadb</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Database/atlas/">atlas</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Database/MHA/">MHA</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Database/redis/">redis</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Database/sqlite/">sqlite</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>PHP</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../PHP/php/">PHP</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../PHP/Laravel/">Laravel</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../PHP/PHP编码规范/">PHP编码规范</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Other Tools</span></li>

        
            
    <li class="toctree-l1 current">
        <a class="current" href="./">Docker</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#docker">Docker 使用指南</a></li>
                
                    <li><a class="toctree-l4" href="#_1">系统相关</a></li>
                
                    <li><a class="toctree-l4" href="#_2">镜像和容器</a></li>
                
                    <li><a class="toctree-l4" href="#_3">创建容器</a></li>
                
                    <li><a class="toctree-l4" href="#_4">容器操作</a></li>
                
                    <li><a class="toctree-l4" href="#_5">迁移</a></li>
                
                    <li><a class="toctree-l4" href="#troubleshooting">TroubleShooting</a></li>
                
                    <li><a class="toctree-l4" href="#_6">常用命令</a></li>
                
            
            </ul>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Git/">Git</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Chrome/">Chrome</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../curl/">curl</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Atom/">Atom</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../SVN/">SVN</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Openstack/">Openstack</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../shadowsocks/">shadowsocks</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../fpm/">fpm</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../hexo/">hexo</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../phpmyadmin/">phpmyadmin</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../Sublime Text/">Sublime Text</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../terminal/">terminal</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../vim/">vim</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../wireshark/">wireshark</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../wordpress/">wordpress</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../workbench/">workbench</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>server</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../server/apache/">apache</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../server/HAProxy/">HAProxy</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../server/lamp/">lamp</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../server/nginx/">nginx</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../server/puppet/">puppet</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../server/saltstack/">saltstack</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../server/wamp/">wamp</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../server/zabbix/">zabbix</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>system</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../system/装机必备/">装机必备</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../system/Android/">Android</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../system/Linux/">Linux</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../system/MAC OSX/">MAC OSX</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../system/Raspberry Pi/">Raspberry Pi</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../system/Windows/">Windows</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>C and C++</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../C and C++/C/">C</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../C and C++/C++/">C++</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Java</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Java/java/">Tips</a>
        
    </li>

        
    </ul>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">我的Wiki</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Other Tools &raquo;</li>
        
      
    
    <li>Docker</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="docker">Docker 使用指南</h1>
<p>需要注意的是在Docker里面，镜像和容器是两个概念，镜像类似操作系统的ISO，而容器则是以该ISO为基础生成而来的。</p>
<h2 id="_1">系统相关</h2>
<pre><code>boot2docker默认用户名是docker，密码是tcuser
</code></pre>
<h2 id="_2">镜像和容器</h2>
<pre><code>docker pull ubuntu:14.04.1 # 拉取官方镜像
docker pull registry.hub.docker.com/ubuntu:14.04  # 拉取特定网站的镜像
docker pull index.alauda.cn/library/centos:centos6.6 # 灵雀云的镜像，镜像中心https://hub.alauda.cn/
docker images # 列出所有的镜像

docker ps           # 列出正在运行的容器
docker ps -a -s # 列出所有容器,-s可以列出大小信息
docker ps -q        # 只列出容器的ID

docker rm # 删除容器
docker rmi # 删除镜像
</code></pre>
<h2 id="_3">创建容器</h2>
<pre><code># docker run命令用于从镜像创建一个容器
# --add-host="host:IP"  # 给hosts添加一行，这个非常有用
# -d：使容器在后台运行(detached mode)，不加则默认是前台模式，启动后会将当前命令行窗口挂在到容器中
# --name：指定名称，如--name haofly
# -t：分配一个伪终端
# -i参数表示将STDIN持续打开而不管是否已经attached
docker run -t -i ubuntu:14.04.1      # 从ubuntu:14.04.1镜像创建一个容器
docker run -t -i ubuntu:14.04.1 /bin/bash # 从ubuntu:14.04.1创建容器并在容器中执行命令
docker run -t -i -d ubuntu:14.04.1  # 创建容器并作为daemon运行
docker run -t -i -p 80:80 ubuntu:14.04.1 # 创建容器并映射容器的80端口到主机的80端口
docker run -t -i -v /etc/hehe/:/etc/haha ubuntu:14.04.1 # 创建容器并映射主机的/etc/hehe目录到容器的/etc/haha目录
docker run -t -i
exit # 退出容器
docker logs 容器名称  # 获取容器的输出信息
docker run -t -i -d -p 80:80 -v /home/haofly/docker/test/mysite:/mysite django-apache:latest # 我当前机器上的一条执行自己创建的镜像的命令
</code></pre>
<h2 id="_4">容器操作</h2>
<pre><code>docker start：和docker run后面参数一样，只是它是重启容器，而docker run是创建容器
docker stop 容器名/ID：停止某个容器
docker attach 容器名/ID：直接进入容器，查看容器当前的标准输出
docker exec -it 容器名 bash  # ssh进一个容器
</code></pre>
<h2 id="_5">迁移</h2>
<pre><code>docker save -o ubuntu_14.04.tar ubuntu:14.04  # 导出镜像到本地
docker load &lt; ubuntu_14.04.tar   #　加载本地镜像
docker export 容器ID &gt; ubuntu.tar # 导出容器快照到本地
docker import # 导入本地快照
</code></pre>
<h2 id="troubleshooting">TroubleShooting</h2>
<ul>
<li>
<p>动态添加端口映射</p>
<pre><code>方法一：此方法据说不安全，就是在run的时候--net host
方法二：在virtualbox中添加映射，这个其实没试验过
</code></pre>
</li>
<li>
<p>官方mysql镜像打开二进制日志</p>
<pre><code>docker run -v /var/lib/mysql:/var/lib/mysql \
            mysql:5.7 \
            mysqld \
            --data \
            --user=mysql \
            --server-id=1 \
            --log-bin=/var/log/mysql/mysql-bin.log \
            --binlog_do_db=test
</code></pre>
</li>
<li>
<p>CentOS7容器无法使用systemctl命令，提示<code>Failed to get D-Bus connection: No connection to service manager.</code>不知道为何不能支持，但可以有其他方法，在创建容器的时候使用如下命令<code>docker run --privileged XXX /usr/sbin/init</code></p>
</li>
</ul>
<h2 id="_6">常用命令</h2>
<pre><code># 使用php容器执行php文件
docker run -it --rm --name my-running-script -v "$PWD":/usr/src/myapp -w /usr/src/myapp index.alauda.cn/library/php:5.6-cli php test.php








  * 镜像或容器


        docker pull ubuntu:14.04.1 # 拉取官方镜像
    docker pull registry.hub.docker.com/ubuntu:14.04  # 拉取特定网站的镜像
    docker images # 列出所有的镜像

    docker ps    # 列出正在运行的容器
    docker ps -a # 列出所有容器
    docker ps -q # 只列出容器的ID


  * 创建容器docker run：
  *     # docker run命令用于从镜像创建一个容器，
    # -d：使容器在后台运行(detached mode)，不加则默认是前台模式，启动后会将当前命令行窗口挂在到容器中
    # --name：指定名称，如--name haofly
    # -t：分配一个伪终端
    # -i参数表示将STDIN持续打开而不管是否已经attached
    docker run -t -i ubuntu:14.04.1      # 从ubuntu:14.04.1镜像创建一个容器
    docker run -t -i ubuntu:14.04.1 /bin/bash # 从ubuntu:14.04.1创建容器并在容器中执行命令
    docker run -t -i -d ubuntu:14.04.1  # 创建容器并作为daemon运行
    docker run -t -i -p 80:80 ubuntu:14.04.1 # 创建容器并映射容器的80端口到主机的80端口
    docker run -t -i -v /etc/hehe/:/etc/haha ubuntu:14.04.1 # 创建容器并映射主机的/etc/hehe目录到容器的/etc/haha目录
    docker run -t -i
    exit # 退出容器
    docker logs 容器名称  # 获取容器的输出信息
    docker run -t -i -d -p 80:80 -v /home/haofly/docker/test/mysite:/mysite django-apache:latest # 我当前机器上的一条执行自己创建的镜像的命令

  * 容器暂停与重启


        docker start：和docker run后面参数一样，只是它是重启容器，而docker run是创建容器



  * docker start : 和docker run后面跟的参数什么的都一样,唯一不一样的是,docker run是创建一个新的容器,而docker start则是从一个已经停止的容器开始,并且不会自动退出.
  * docker stop : 停止某个容器的运行
  * docker commit : 更改容器后要把更改后的容器作为一个镜像,注意这里和直接用Dockerfile不一样

        docker commit -m "说明信息" -a "用户信息

  * docker save : 导出镜像到本地

        docker save -o ubuntu_14.04.1.tar ubuntu:14.04.1

  * docker load : 加载本地镜像,导入用docker save命令保存的本地镜像

        docker load &lt; ubuntu_14.04.1.tar

  * docker export : 导出容器快照到本地

        docker export 容器ID &gt; ubuntu.tar

  * docker import : 导出本地快照
  * docker kill : 杀死正在运行的容器,后跟容器ID

        docker kill $(docker ps -a -q)

  * docker rm : 移除容器,后跟容器ID

        docker rm $(docker ps -a -q)  # 删除所有已停止的容器

  * docker rmi : 删除镜像,后跟镜像名称或ID

        docker rmi $(docker images -q -a)

  *
    ---
    title: "Docker 之Dockerfile的使用"
    date: 2015-02-01 08:58:06
    categories: docker
    ---
    使用Dockerfile可以方便地build自己的Docker镜像,并且Dockerfile语法简单,清晰明了.Dockerfile中每一条指令都对应镜像中
    的一层,后面的层会依赖前面的层,每一层都会有一个唯一的ID,这样前半部分都相同的Dockerfile那前半部分构建时都一样,会自动复用.

    一般,如果Dockerfile就位于当前目录,那么可以直接执行一下命令进行构建(-t参数指定REPOSITORY名称,默认的Tag为latest)`dock
    er build -t="haofly" .`

      * **#** Dockerfile中用#来进行注释
      * **FROM** 指定基于哪个镜像创建,这样会先pull该镜像.例如`FROM ubuntu:14.04.1`
      * **MAINTAINER** 指定创建作者的信息.例如`MAINTAINER haofly &lt;haoflynet@gmail.com&gt;`
      * **ADD** 将指定的主机目录中的文件代替要构建的镜像中的文件,这条命令通常用于镜像源的更换,例如`ADD sources.list_aliyun /etc/apt/sources.list`,这样,镜像中的/etc/apt/sources.list文件就被sources.list_aliyun文件替代了
      * **RUN **执行一条shell命令
      * **EXPOSE** 暴露什么端口给主机,需要注意的是,即使指定了,也得在docker run的时候通过-p参数执行端口的映射
      * **WORKDIR** 切换工作目录,这样下面的CMD等就可以在新的目录执行
      * **CMD** 一般写于最后,因为它是容器启动时才执行的命令,并且无论写多少,都只执行最后那一条,一般用于容器中镜像的启动,例如`CMD ["/usr/sbin/apache2ctl", "-D", "FOREGROUND"]`,当然,也可不加括号和引号,直接用shell的方式写一条命令.但是如果docker run 中指定了命令过后,CMD将不被执行
      * **ENTRYPOINT** 和CMD类似,但是如果docker run中指定了命令,它仍然会被执行
      * **ENV** 指定环境变量
</code></pre>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../Git/" class="btn btn-neutral float-right" title="Git">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../../PHP/PHP编码规范/" class="btn btn-neutral" title="PHP编码规范"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../../PHP/PHP编码规范/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../Git/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>
