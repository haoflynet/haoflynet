<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <title>Laravel - 我的Wiki</title>
  

  <link rel="shortcut icon" href="../../img/favicon.ico">

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">

  
  <script>
    // Current page data
    var mkdocs_page_name = "Laravel";
    var mkdocs_page_input_path = "PHP/Laravel.md";
    var mkdocs_page_url = "/PHP/Laravel/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script>
  <script src="../../js/theme.js"></script> 

  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> 我的Wiki</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../..">Home</a>
        
    </li>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>code</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../code/安全测试/">安全测试</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../code/编码经验/">编码经验</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../code/代码审查清单/">代码审查清单</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../code/正则表达式/">正则表达式</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../code/packages/">packages</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>python</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../python/Django/">Django</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../python/Flask/">Flask</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../python/kivy/">kivy</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../python/pybrain/">pybrain</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../python/Django/">Django</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../python/PyQT/">PyQT</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../python/pytest/">pytest</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../python/python/">python</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../python/Scrapy-PySpider/">Scrapy-PySpider</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../python/Splinter/">Splinter</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../python/string/">string</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../python/Tornado/">Tornado</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>frontend</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../frontend/bootstrap/">bootstrap</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../frontend/js/">js</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../frontend/css/">css</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../frontend/frontend/">frontend</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../frontend/gulp/">gulp</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../frontend/html/">html</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../frontend/nodejs/">nodejs</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Database</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Database/MySQL and Mriadb/">MySQL and Mriadb</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Database/atlas/">atlas</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Database/MHA/">MHA</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Database/redis/">redis</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Database/sqlite/">sqlite</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>PHP</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../php/">PHP</a>
        
    </li>

        
            
    <li class="toctree-l1 current">
        <a class="current" href="./">Laravel</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#laravel">Laravel指南</a></li>
                
            
                <li class="toctree-l3"><a href="#_1">介绍：</a></li>
                
            
                <li class="toctree-l3"><a href="#_2">建表操作/创建迁移</a></li>
                
            
                <li class="toctree-l3"><a href="#_3">执行建表操作/运行迁移</a></li>
                
            
                <li class="toctree-l3"><a href="#_4">撤销建表操作/回滚迁移</a></li>
                
            
                <li class="toctree-l3"><a href="#_5">数据库填充</a></li>
                
            
            </ul>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../PHP编码规范/">PHP编码规范</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Other Tools</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Other Tools/Docker/">Docker</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Other Tools/Git/">Git</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Other Tools/Chrome/">Chrome</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Other Tools/curl/">curl</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Other Tools/Atom/">Atom</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Other Tools/SVN/">SVN</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Other Tools/Openstack/">Openstack</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Other Tools/shadowsocks/">shadowsocks</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Other Tools/fpm/">fpm</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Other Tools/hexo/">hexo</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Other Tools/phpmyadmin/">phpmyadmin</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Other Tools/Sublime Text/">Sublime Text</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Other Tools/terminal/">terminal</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Other Tools/vim/">vim</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Other Tools/wireshark/">wireshark</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Other Tools/wordpress/">wordpress</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Other Tools/workbench/">workbench</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>server</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../server/apache/">apache</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../server/HAProxy/">HAProxy</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../server/lamp/">lamp</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../server/nginx/">nginx</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../server/puppet/">puppet</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../server/saltstack/">saltstack</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../server/wamp/">wamp</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../server/zabbix/">zabbix</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>system</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../system/装机必备/">装机必备</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../system/Android/">Android</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../system/Linux/">Linux</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../system/MAC OSX/">MAC OSX</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../system/Raspberry Pi/">Raspberry Pi</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../system/Windows/">Windows</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>C and C++</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../C and C++/C/">C</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../C and C++/C++/">C++</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Java</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Java/java/">Tips</a>
        
    </li>

        
    </ul>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">我的Wiki</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>PHP &raquo;</li>
        
      
    
    <li>Laravel</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="laravel">Laravel指南</h1>
<hr />
<p>title: "laravel控制器"
date: 2014-09-23 10:19:11
categories: 编程之路</p>
<hr />
<p>创建控制器：</p>
<p>1</p>
<p>|</p>
<p>php artisan make:controller HomeController  </p>
<p>---|---  </p>
<p>就有这么一个文件了</p>
<p>1</p>
<p>|</p>
<p>app/Http/Controllers/HomeController.php  </p>
<p>---|---  </p>
<p>如果要传递参数，可以直接</p>
<p>Route::resource(‘wei/{who}’, ‘WeixinController’);</p>
<p>然后在控制器里的函数定义里面添加上该参数名，如：</p>
<p>public function index($who)</p>
<p>在Laravel中，我们通过扩展 app/controllers 目录的BaseController类来创建控制器，我们所有的控制器都存在app/contr
ollers目录中。文件管理方面这一点类似MODEL，使用一个文件当作入口来管理所有的同类文件。<br />
在BaseController.php里面可以定义基本的布局文件，比如：</p>
<p>1</p>
<p>2</p>
<p>3</p>
<p>4</p>
<p>5</p>
<p>6</p>
<p>7</p>
<p>8</p>
<p>9</p>
<p>10</p>
<p>11</p>
<p>12</p>
<p>13</p>
<p>14</p>
<p>15</p>
<p>16</p>
<p>17</p>
<p>18</p>
<p>19</p>
<p>20</p>
<p>21</p>
<p>22</p>
<p>23</p>
<p>24</p>
<p>25</p>
<p>|</p>
<?php

<p>class BaseController extends \Controller {</p>
<p>/**</p>
<ul>
<li>
<p>layout to use</p>
</li>
<li>
<p>@var View</p>
</li>
</ul>
<p>*/</p>
<p>protected $layout = 'master';</p>
<p>/**</p>
<ul>
<li>Setup the layout used by the controller.</li>
</ul>
<p>*</p>
<ul>
<li>@return void</li>
</ul>
<p>*/</p>
<p>protected function setupLayout()</p>
<p>{</p>
<p>if ( ! is_null($this-&gt;layout) )</p>
<p>{</p>
<p>$this-&gt;layout = View::make($this-&gt;layout);</p>
<p>}</p>
<p>}</p>
<p>}  </p>
<p>---|---  </p>
<p>BlogController.php：<a href="http://blog.csdn.net/ipip2005/article/details/37568215">http://blog.csdn.net/ipip2005/article/details/37568215</a></p>
<p>__construct使我们能够在控制器内部指定过滤器，过滤器的定义在app/filters.php。</p>
<p>getIndex()获取主页显示的元素，每页显示20张图片，调用布局home，在home.blade.php中的{{content}}部分填充布局index
，布局由构造出的20张图片的键值对数组生成，这一步相当于显示了主页。</p>
<p>getLogin()获取验证状态并转移页面到管理员控制面板</p>
<p>getLogout()登出用户</p>
<p>postRegister()注册验证，需要验证未使用用户名和未使用的邮箱地址</p>
<p>postLogin()登陆验证</p>
<p>1</p>
<p>2</p>
<p>3</p>
<p>4</p>
<p>5</p>
<p>6</p>
<p>7</p>
<p>8</p>
<p>9</p>
<p>10</p>
<p>11</p>
<p>12</p>
<p>13</p>
<p>14</p>
<p>15</p>
<p>16</p>
<p>17</p>
<p>18</p>
<p>19</p>
<p>20</p>
<p>21</p>
<p>22</p>
<p>23</p>
<p>24</p>
<p>25</p>
<p>26</p>
<p>27</p>
<p>28</p>
<p>29</p>
<p>30</p>
<p>31</p>
<p>32</p>
<p>33</p>
<p>34</p>
<p>35</p>
<p>36</p>
<p>37</p>
<p>38</p>
<p>39</p>
<p>40</p>
<p>41</p>
<p>42</p>
<p>43</p>
<p>44</p>
<p>45</p>
<p>46</p>
<p>47</p>
<p>48</p>
<p>49</p>
<p>50</p>
<p>51</p>
<p>52</p>
<p>53</p>
<p>54</p>
<p>55</p>
<p>56</p>
<p>57</p>
<p>58</p>
<p>59</p>
<p>60</p>
<p>61</p>
<p>62</p>
<p>63</p>
<p>64</p>
<p>65</p>
<p>66</p>
<p>67</p>
<p>68</p>
<p>69</p>
<p>70</p>
<p>71</p>
<p>72</p>
<p>73</p>
<p>74</p>
<p>75</p>
<p>76</p>
<p>77</p>
<p>78</p>
<p>79</p>
<p>80</p>
<p>81</p>
<p>82</p>
<p>83</p>
<p>84</p>
<p>85</p>
<p>86</p>
<p>87</p>
<p>88</p>
<p>89</p>
<p>90</p>
<p>91</p>
<p>92</p>
<p>93</p>
<p>94</p>
<p>95</p>
<p>96</p>
<p>97</p>
<p>98</p>
<p>99</p>
<p>100</p>
<p>101</p>
<p>102</p>
<p>103</p>
<p>104</p>
<p>105</p>
<p>106</p>
<p>107</p>
<p>108</p>
<p>109</p>
<p>110</p>
<p>111</p>
<p>112</p>
<p>113</p>
<p>114</p>
<p>115</p>
<p>116</p>
<p>117</p>
<p>118</p>
<p>|</p>
<?php

<p>use Illuminate\Support\Facades\Redirect;</p>
<p>class BlogController extends BaseController</p>
<p>{</p>
<p>&nbsp; &nbsp; public function __construct()</p>
<p>&nbsp; &nbsp; {</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; //updated: prevents re-login.</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;beforeFilter('guest', ['only' =&gt;
['getLogin']]);</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;beforeFilter('auth', ['only' =&gt;
['getLogout']]);</p>
<p>&nbsp; &nbsp; }</p>
<p>&nbsp; &nbsp; public function getIndex()</p>
<p>&nbsp; &nbsp; {</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; $pictures = Picture::orderBy('id',
'desc')-&gt;paginate(10);</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp;
$pictures-&gt;getFactory()-&gt;setViewName('pagination::simple');</p>
<p>$this-&gt;layout-&gt;title = 'Home Page | Picture Wall Blog';
给layout里面的东西赋值，在layout.master中有section 里面的值</p>
<p>$this-&gt;layout-&gt;main = View::make('home')-&gt;nest('content', 'index',
compact('pictures'));</p>
<p>&nbsp; &nbsp; }</p>
<p>&nbsp; &nbsp; public function getSearch()</p>
<p>&nbsp; &nbsp; {</p>
<p>&nbsp; &nbsp; <span style="white-space:pre"> </span>$searchTerm =
Input::get('s');</p>
<p>&nbsp; &nbsp; <span style="white-space:pre"> </span>$pictures =
Picture::whereRaw('match(title,description) against(? in boolean mode)',
[$searchTerm])</p>
<p>&nbsp; &nbsp; <span style="white-space:pre"> </span>-&gt;paginate(10);</p>
<p>&nbsp; &nbsp; <span style="white-space:pre">
</span>$pictures-&gt;getFactory()-&gt;setViewName('pagination::slider');</p>
<p>&nbsp; &nbsp; <span style="white-space:pre"> </span>$pictures-&gt;appends(['s' =&gt;
$searchTerm]);</p>
<p>&nbsp; &nbsp; <span style="white-space:pre">
</span>$this-&gt;layout-&gt;with('title', 'Search: ' . $searchTerm);</p>
<p>&nbsp; &nbsp; <span style="white-space:pre"> </span>$this-&gt;layout-&gt;main =
View::make('home')</p>
<p>&nbsp; &nbsp; <span style="white-space:pre"> </span>-&gt;nest('content', 'index',
($pictures-&gt;isEmpty()) ? ['notFound' =&gt; true] : compact('pictures'));</p>
<p>&nbsp; &nbsp; }</p>
<p>&nbsp; &nbsp;&nbsp;</p>
<p>&nbsp; &nbsp; public function getLogin()</p>
<p>&nbsp; &nbsp; {</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;layout-&gt;title = 'login';</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; $this-&gt;layout-&gt;main = View::make('login');</p>
<p>&nbsp; &nbsp; }</p>
<p><span style="white-space:pre"> </span></p>
<p>&nbsp; &nbsp; public function getRegister()</p>
<p>&nbsp; &nbsp; {</p>
<p>&nbsp; &nbsp; <span style="white-space:pre"> </span>$this-&gt;layout-&gt;title =
'register';</p>
<p>&nbsp; &nbsp; <span style="white-space:pre"> </span>$this-&gt;layout-&gt;main =
View::make('register');</p>
<p>&nbsp; &nbsp; }</p>
<p>&nbsp; &nbsp;&nbsp;</p>
<p>&nbsp; &nbsp; public function postRegister()</p>
<p>&nbsp; &nbsp; {</p>
<p>&nbsp; &nbsp; <span style="white-space:pre"> </span>$credentials = [</p>
<p>&nbsp; &nbsp; <span style="white-space:pre"> </span>'username' =&gt;
Input::get('username'),</p>
<p>&nbsp; &nbsp; <span style="white-space:pre"> </span>'password' =&gt;
Input::get('password'),</p>
<p>&nbsp; &nbsp; <span style="white-space:pre"> </span>'email' =&gt;
Input::get('email')</p>
<p>&nbsp; &nbsp; <span style="white-space:pre"> </span>];</p>
<p>&nbsp; &nbsp; <span style="white-space:pre"> </span>$rules = [</p>
<p>&nbsp; &nbsp; <span style="white-space:pre"> </span>'username' =&gt; 'required',</p>
<p>&nbsp; &nbsp; <span style="white-space:pre"> </span>'password' =&gt; 'required',</p>
<p>&nbsp; &nbsp; <span style="white-space:pre"> </span>'email' =&gt;
'required|email'</p>
<p>&nbsp; &nbsp; <span style="white-space:pre"> </span>];</p>
<p>&nbsp; &nbsp; <span style="white-space:pre"> </span>$validator =
Validator::make($credentials, $rules);</p>
<p>&nbsp; &nbsp; <span style="white-space:pre"> </span>if ($validator-&gt;passes())
{</p>
<p>&nbsp; &nbsp; <span style="white-space:pre"> </span>$userCheck =
DB::table('users')-&gt;where('username',$credentials['username'])-&gt;get();</p>
<p>&nbsp; &nbsp; <span style="white-space:pre"> </span>if (!empty($userCheck)){</p>
<p>&nbsp; &nbsp; <span style="white-space:pre"> </span>return
Redirect::back()-&gt;withInput()-&gt;with('failure', 'username already exists!');</p>
<p>&nbsp; &nbsp; <span style="white-space:pre"> </span>}</p>
<p>&nbsp; &nbsp; <span style="white-space:pre"> </span>$emailCheck =
DB::table('users')-&gt;where('email',$credentials['email'])-&gt;get();</p>
<p>&nbsp; &nbsp; <span style="white-space:pre"> </span>if (!empty($emailCheck)){</p>
<p>&nbsp; &nbsp; <span style="white-space:pre"> </span>return
Redirect::back()-&gt;withInput()-&gt;with('failure', 'mail address already
exists!');</p>
<p>&nbsp; &nbsp; <span style="white-space:pre"> </span>}</p>
<p>&nbsp; &nbsp; <span style="white-space:pre"> </span>$user = array(</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'username' =&gt;
$credentials['username'],</p>
<p>&nbsp; &nbsp; &lt;span class="crayon-sy" style="color: rgb(248, 248, 242); font-
size: i</p>
<hr />
<p>title: "Laravel学习——Migration&amp;Seeding建立数据表以及填充数据"
date: 2014-09-24 23:57:25
categories: Laravel</p>
<hr />
<p>参考手册：<a href="http://v4.golaravel.com/docs/4.1/schema">http://v4.golaravel.com/docs/4.1/schema</a></p>
<h1 id="_1">介绍：</h1>
<p>Laravel提供了migration和seeding为数据库的迁移和填充提供了方便，可以让团队在修改数据库的同时，保持彼此的进度，将建表语句及填充操作写在
laravel框架文件里面并，使用migration来控制数据库版本，再配合Artisan命令，比单独管理数据库要方便得多。</p>
<h1 id="_2">建表操作/创建迁移</h1>
<p>首先，数据库的基本参数在app/config/database.php里面进行设置，这里就不介绍了。</p>
<p>然后在composer命令行中输入如下命令，新建一张名为users的表(建表的时候最好使用复数形式)：</p>
<pre><code>php artisan migrate:make create_groups_users
</code></pre>
<p>执行了该命令过后，在<code>app/database/migrations/</code>文件夹下会生成带有时间戳的文件，比如<code>2014_11_01_134525_creat
e_groups_table.php</code>，这就是建表的文件，里面是一个继承自Migration的建表类，名称如<code>CreateUsersTable</code>。该文件夹下
每个PHP文件代表一张表。</p>
<p>在该PHP文件里面的表类有几个主要的方法：</p>
<p><strong>up()</strong>方法：定义表结构，如：</p>
<pre><code>/**
 * Run the migrations.
 _
 * @return void
 _/
public function up()
\{
    Schema::create('groups', function (Blueprint $table) \{
        $table-&gt;increments('ID');
        $table-&gt;string('Name', 20);
    \});
\}
</code></pre>
<p><strong>down()</strong>方法：定义如何删除表，如：</p>
<pre><code>/**
 * Reverse the migrations.
 _
 * @return void
 _/
public function down()
\{
    Schema::table('groups', function (Blueprint $table) \{
            $table-&gt;drop();
    \});
\}
</code></pre>
<p><strong> 注：</strong>$table的建表时候的字段类型和mysql不大一样，<a href="http://v4.golaravel.com/api/4.1/">点击查看API</a>，比如：</p>
<pre><code>$table-&gt;string(string $column, int $length = 255)：对应varchar()类型
$table-&gt;increments(string $column)：对应自增长整型
$table-&gt;unique(string|array $columns, string $name=null)：指明为unique
$table-&gt;foreign('user_id')-&gt;references('id')-&gt;on('users')：定义了外键
$table-&gt;integer(string $column)-&gt;default(2)：设置默认值
</code></pre>
<h1 id="_3">执行建表操作/运行迁移</h1>
<p>保存该文件后在composer的cmd执行如下语句</p>
<pre><code>php artisan migrate
</code></pre>
<p>就可以自动执行默认的该文件夹下的所有建表文件。</p>
<h1 id="_4">撤销建表操作/回滚迁移</h1>
<p>在composer的cmd中执行如下语句</p>
<pre><code>php artisan migrate:rollback         // 回滚最后一次迁移




php artisan migrate:reset            // 回滚所有迁移




php artisan migrate:refresh          // 回滚所有迁移并重新运行所有迁移
</code></pre>
<h1 id="_5">数据库填充</h1>
<p>Laravel使用数据填充类来填充数据，在app/database/seeds/DatabaseSeeder.php中定义。可以在其中自定义一个填充类，但最
好以形式命名，如(默认填充类为DatabaseSeeder，只需要在该文件新建类即可)：</p>
<pre><code>class UserTableSeeder extends Seeder \{
    public function run()
    \{
        DB::table('users')-&gt;delete();
        User::create(array('email' =&gt; 'foo@bar.com'));
    \}
\}
</code></pre>
<p>然后在Composer的命令行里执行填充命令</p>
<pre><code>php artisan db:seed




php artisan migrate:refresh --seed    //回滚数据库并重新运行所有的填充


---
title: "Laravel基本配置"
date: 2014-12-26 12:28:31
categories: Laravel
---
## Laravel5

Laravel5的配置文件将经常用到的文件集中到了根目录下的.env目录下，这样更高效更安全。其内容如下：



    # 这里配置
    APP_ENV=local
    APP_DEBUG=true
    APP_KEY=YboBwsQ0ymhwABoeRgtlPE6ScqSzeWZG




    # 这里配置数据库




    DB_HOST=localhost
    DB_DATABASE=test
    DB_USERNAME=root
    DB_PASSWORD=mysql




    CACHE_DRIVER=file
    SESSION_DRIVER=file
    QUEUE_DRIVER=sync




    MAIL_DRIVER=smtp
    MAIL_HOST=mailtrap.io
    MAIL_PORT=2525
    MAIL_USERNAME=null
    MAIL_PASSWORD=null


还可以在该文件里配置其它的变量，然后在其它地方使用$_ENV['变量名']即可访问。

## Laravel4

Laravel框架的配置文件主要有`app/config`、`app/database`等

  1. 主配置文件**_app/config/app.php_**

        &lt;?php
    return array(
        'debug' =&gt; true,                   // 是否打开调试模式
        'url' =&gt; 'localhost';              // 该选项可以影响laravel使用url函数生成的url
        'timezone' =&gt; 'Asia/Chongqing';    // 修改时区为本地




        ... // 其他功能暂时未用到，这里忽略


)

  2. 缓存的配置(我这里修改成了redis作为缓存)****_app/config/cache.php_****

        &lt;?php
    return array(
        'driver' =&gt; 'redis',               // 缓存驱动名称
        'path' =&gt; storage_path().'/cache', // 缓存的存储路径
        'connection' =&gt; null;              // 如果不是数据库驱动的缓存就默认设置为null
        'table' =&gt; 'test',                 // 选择所使用的表，只有数据库驱动的缓存才有用
        'memcached' =&gt; array(              // 缓存连接设置
            array('host' =&gt; '127.0.0.1', 'port' =&gt; 6379, 'weight' =&gt; 100),
        )
        'prefix' =&gt; 'laravel';             // 缓存的键的前缀
    );

  3. 数据库的配置****_app/config/database.php_****

        &lt;?php
    return array(
        'fetch' =&gt; PDO::FETCH_CLASS,
        'default' =&gt; 'mysql',     // 默认的数据库
        'connections' =&gt; array(   // 这里面包含了各种数据库的连接设置，这里直接设置mysql就可以了
            'mysql' =&gt; array(
                'driver'    =&gt; 'mysql',
                'host'      =&gt; 'localhost',
                'database'  =&gt; 'test',
                'username'  =&gt; 'root',
                'password'  =&gt; 'psd',
                'charset'   =&gt; 'utf8',
                'collation' =&gt; 'utf8_unicode_ci',
                'prefix'    =&gt; 'v_',                 // 数据表的前缀
            ),
        ),
        ....
        'redis' =&gt; array(    // Laravel默认在这里可以设置Redis，这样可以直接使用魔术方法
            'cluster' =&gt; false,
            'default' =&gt; array(
                'host'     =&gt; '127.0.0.1',
                'port'     =&gt; 6379,
                'database' =&gt; 0,
            ),
        ),
    );

    ---
    title: "Laravel奇淫技巧"
    date: 2015-03-29 08:08:22
    categories: laravel
    ---
    收集一些laravel的小技巧和一些小的知识点：

      1. **路由缓存**：laravel里面使用

            route:cache Artisan

    可以加速控制器的路由表，而且性能提升非常显著。

      2. **禁止全局csrf认证**：在_app/Http/Kernel.php_中，_$middleware_表示全局中间件，而_$routeMiddleware_表示针对某个路由的中间件，所以只需要把csrf在$middleware中注释屌，然后在$routeMiddleware中添加

            'csrf' =&gt; 'App\\Http\\Middleware\\VerifyCsrfToken',

    如果要在某个路由上使用就这样：


            Route::group(['middleware' =&gt; 'csrf'], function()\{     // csrf保护的接口
            Route::get('/', 'HomeController@index');            // 网站首页
        \}

      3. **处理上传文件**：

            $file = Input::file('upload_file");// 获取上传文件对象
        $file-&gt;isValid()                   // 检验文件是否有效
        $file-&gt;getClientOriginalName();    // 获取文件原名
        $file-&gt;getFileName();              // 获取上传后缓存的文件的名字
        $file-&gt;getRealPath();              // 获取缓存文件的绝对路径
        $file-&gt;getClientOriginalExtension();// 获取上传文件的后缀
        $file-&gt;getMimeType();              // 获取上传文件的MIME类型
        $file-&gt;getSize();                  // 获取上传文件的大小

      4. **获取输入信息**：

            $id = Input:;get('id');
        $id = Input::get('id', 2);  // 还可以指定默认值

      5. **获取请求信息**：

            Request::url();      // 获取请求url
        $request = new Request;
        $request-&gt;get('id'); // 同样实现获取数据的功能

      6. ****手动清理配置缓存 ****

            php artisan config:cache

      7.
</code></pre>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../PHP编码规范/" class="btn btn-neutral float-right" title="PHP编码规范">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../php/" class="btn btn-neutral" title="PHP"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../php/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../PHP编码规范/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>
