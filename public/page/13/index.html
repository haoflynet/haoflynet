<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="豪翔天下,Python开发工程师,全栈开发工程师" />





  <link rel="alternate" href="/atom.xml" title="豪翔天下" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="豪翔天下的个人博客">
<meta property="og:type" content="website">
<meta property="og:title" content="豪翔天下">
<meta property="og:url" content="https://haofly.net/page/13/index.html">
<meta property="og:site_name" content="豪翔天下">
<meta property="og:description" content="豪翔天下的个人博客">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="豪翔天下">
<meta name="twitter:description" content="豪翔天下的个人博客">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://haofly.net/page/13/"/>





  <title> 豪翔天下 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-47480072-1', 'auto');
  ga('send', 'pageview');
</script>


  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?d06802e96e214bdb413a40b263d4cc15";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>








  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">豪翔天下</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">Change My World by Program</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-favorites">
          <a href="/favorites.html" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-flag"></i> <br />
            
            menu.favorites
          </a>
        </li>
      
        
        <li class="menu-item menu-item-wiki">
          <a href="https://wiki.haofly.net" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-key"></i> <br />
            
            menu.wiki
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="https://haofly.net/zhihu/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="haofly">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/uploads/avatar.png">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="豪翔天下">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="豪翔天下" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/zhihu/" itemprop="url">
                  [转]从0到100——知乎架构变迁史
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2015-04-04T08:38:44+08:00">
                2015-04-04
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/编程之路/" itemprop="url" rel="index">
                    <span itemprop="name">编程之路</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/zhihu/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="zhihu/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>转自：<a href="http://www.admin10000.com/document/5744.html" target="_blank" rel="external">http://www.admin10000.com/document/5744.html</a></p>
<p>许很多人还不知道，知乎在规模上是仅次于百度贴吧和豆瓣的中文互联网最大的UGC(用户生成内容)社区。知乎创业三年来，从0开始，到现在已经有了100多台服务器。<br>目前知乎的注册用户超过了1100万，每个月有超过8000万人使用；网站每个月的PV超过2.2亿，差不多每秒钟的动态请求超过2500。</p>
<p>在ArchSummit北京2014大会上，知乎联合创始人兼 CTO<br>李申申带来了知乎创业三年多来的首次全面技术分享（幻灯片下载）。本文系根据演讲内容整理而成。</p>
<h2 id="初期架构选型"><a href="#初期架构选型" class="headerlink" title="初期架构选型"></a>初期架构选型</h2><p>在2010年10月真正开始动手做知乎这个产品时，包含李申申在内，最初只有两位工程师；到2010年12月份上线时，工程师是四个。</p>
<p>知乎的主力开发语言是<strong>Python</strong>。因为Python简单且强大，能够快速上手，开发效率高，而且社区活跃，团队成员也比较喜欢。</p>
<p>知乎使用的是<strong>Tornado框架</strong>。因为它支持异步，很适合做实时Comet应用，而且简单轻量，学习成本低，再就是有FriendFeed<br>的成熟案例，Facebook 的社区支持。知乎的产品有个特性，就是希望跟浏览器端建立一个长连接，便于实时推送Feed和通知，所以Tornado比较合适。</p>
<p>最初整个团队的精力全部放在产品功能的开发上，而其他方面，基本上能节约时间、能省的都用最简单的方法来解决，当然这在后期也带来了一些问题。</p>
<p>最初的想法是用云主机，节省成本。知乎的第一台服务器是512MB内存的Linode主机。但是网站上线后，内测受欢迎程度超出预期，很多用户反馈网站很慢。跨国网络<br>延迟比想象的要大，特别是国内的网络不均衡，全国各地用户访问的情况都不太一样。这个问题，再加上当时要做域名备案，知乎又回到了<strong>自己买机器</strong>找机房的老路上。</p>
<p>买了机器、找了机房之后又遇到了新的问题，服务经常宕掉。当时服务商的机器内存总是出问题，动不动就重启。终于有一次机器宕掉起不来了，这时知乎就做了Web和数据库<br>的高可用。创业就是这样一个情况，永远不知道明早醒来的时候会面临什么样的问题。<br><img src="http://7xnc86.com1.z0.glb.clouddn.com/zhihu_0.jpg" alt=""><br>这是当时那个阶段的架构图，Web和数据库都做了主从。当时的图片服务托管在<strong>又拍云</strong>上。除了主从，为了性能更好还做了读写分离。为解决同步问题，又添加了一个<br>服务器来跑离线脚本，避免对线上服务造成响应延迟。另外，为改进内网的吞吐量延迟，还更换了设备，使整个内网的吞吐量翻了20倍。</p>
<p>在2011年上半年时，知乎对<strong>Redis</strong>已经很依赖。除了最开始的队列、搜索在用，后来像Cache也开始使用，单机存储成为瓶颈，所以引入了<strong>分片</strong>，<br>同时做了<strong>一致性</strong>。</p>
<p>知乎团队是一个很<strong>相信工具</strong>的团队，相信工具可以提升效率。工具其实是一个过程，工具并没有所谓的最好的工具，只有最适合的工具。而且它是在整个过程中，随着整<br>个状态的变化、环境的变化在不断发生变化的。知乎自己开发或使用过的工具包括Profiling（函数级追踪请求，分析调优）、Werkzeug（方便调试的工具）、<br>Puppet（配置管理）和Shipit（一键上线或回滚）等。</p>
<h2 id="日志系统"><a href="#日志系统" class="headerlink" title="日志系统"></a>日志系统</h2><p>知乎最初是<strong>邀请制</strong>的，2011年下半年，知乎上线了申请注册，没有邀请码的用户也可以通过填写一些资料申请注册知乎。用户量又上了一个台阶，这时就有了一些发<br>广告的账户，需要扫除广告。日志系统的需求提上日程。</p>
<p>这个日志系统必须支持分布式收集、集中存储、实时、可订阅和简单等特性。当时调研了一些开源系统，比如Scribe总体不错，但是不支持订阅。Kafka是Scala<br>开发的，但是团队在Scala方面积累较少，Flume也是类似，而且比较重。所以开发团队选择了自己开发一个日志系统——Kids（Kids Is Data<br>Stream）。顾名思义，Kids是用来汇集各种数据流的。</p>
<p>Kids参考了Scribe的思路。Kdis在每台服务器上可以配置成Agent或Server。Agent直接接受来自应用的消息，把消息汇集之后，可以打给下一个<br>Agent或者直接打给中心Server。订阅日志时，可以从Server上获取，也可以从中心节点的一些Agent上获取。<br><img src="http://7xnc86.com1.z0.glb.clouddn.com/zhihu_1.jpg" alt=""><br>具体细节如下图所示：<br><img src="http://7xnc86.com1.z0.glb.clouddn.com/zhihu_2.jpg" alt=""><br>知乎还基于Kids做了一个Web小工具（Kids Explorer），支持实时看线上日志，现在已经成为调试线上问题最主要的工具。</p>
<p>Kids已经开源，放到了Github上。</p>
<h2 id="事件驱动的架构"><a href="#事件驱动的架构" class="headerlink" title="事件驱动的架构"></a>事件驱动的架构</h2><p>知乎这个产品有一个特点，最早在添加一个答案后，后续的操作其实只有更新通知、更新动态。但是随着整个功能的增加，又多出了一些更新索引、更新计数、内容审查等操作，<br>后续操作五花八门。如果按照传统方式，维护逻辑会越来越庞大，维护性也会非常差。这种场景很适合事件驱动方式，所以开发团队对整个架构做了调整，做了事件驱动的架构。</p>
<p>这时首先需要的是一个消息队列，它应该可以获取到各种各样的事件，而且对一致性有很高的要求。针对这个需求，知乎开发了一个叫Sink的小工具。它拿到消息后，先做本<br>地的保存、持久化，然后再把消息分发出去。如果那台机器挂掉了，重启时可以完整恢复，确保消息不会丢失。然后它通过Miller开发框架，把消息放到任务队列。Sin<br>k更像是串行消息订阅服务，但任务需要并行化处理， Beanstalkd就派上了用场，由其对任务进行全周期管理。架构如下图所示：<br><img src="http://7xnc86.com1.z0.glb.clouddn.com/zhihu_3.jpg" alt=""><br>举例而言，如果现在有用户回答了问题，首先系统会把问题写到MySQL里面，把消息塞到Sink，然后把问题返回给用户。Sink通过Miller把任务发给<br>Beanstalkd，Worker自己可以找到任务并处理。</p>
<p>最开始上线时，每秒钟有10个消息，然后有70个任务产生。现在每秒钟有100个事件，有1500个任务产生，就是通过现在的事件驱动架构支撑的。</p>
<h2 id="页面渲染优化"><a href="#页面渲染优化" class="headerlink" title="页面渲染优化"></a>页面渲染优化</h2><p>知乎在2013年时每天有上百万的PV，页面渲染其实是计算密集型的，另外因为要获取数据，所以也有IO密集型的特点。这时开发团队就对页面进行了组件化，还升级了数<br>据获取机制。知乎按照整个页面组件树的结构，自上而下分层地获取数据，当上层的数据已经获取了，下层的数据就不需要再下去了，有几层基本上就有几次数据获取。</p>
<p>结合这个思路，知乎自己做了一套模板渲染开发框架——ZhihuNode。</p>
<p>经历了一系列改进之后，页面的性能大幅度提升。问题页面从500ms 减少到150ms，Feed页面从1s减少到600ms。</p>
<h2 id="面向服务的架构（SOA）"><a href="#面向服务的架构（SOA）" class="headerlink" title="面向服务的架构（SOA）"></a>面向服务的架构（SOA）</h2><p>随着知乎的功能越来越庞杂，整个系统也越来越大。知乎是怎么做的服务化呢？</p>
<p>首先需要一个最基本的RPC框架，RPC框架也经历了好几版演进。</p>
<p>第一版是Wish，它是一个严格定义序列化的模型。传输层用到了STP，这是自己写的很简单的传输协议，跑在TCP上。一开始用的还不错，因为一开始只写了一两个服务<br>。但是随着服务增多，一些问题开始出现，首先是ProtocolBuffer会 生成一些描述代码，很冗长，放到整个库里显得很丑陋。另外严格的定义使其不便使用。这<br>时有位工程师开发了新的RPC框架——Snow。它使用简单的JSON做数据序列化。但是松散的数据定义面对的问题是，比如说服务要去升级，要改写数据结构，很难知道<br>有哪几个服务在使用，也很难通知它们，往往错误就发生了。于是又出了第三个RPC框架，写RPC框架的工程师，希望结合前面两个框架的特点，首先保持Snow简单，其<br>次需要相对严格的序列化协议。这一版本引入了 Apache<br>Avro。同时加入了特别的机制，在传输层和序列化协议这一层都做成了可插拔的方式，既可以用JSON，也可以用Avro，传输层可以用STP，也可以用二进制协议。</p>
<p>再就是搭了一个服务注册发现，只需要简单的定义服务的名字就可以找到服务在哪台机器上。同时，知乎也有相应的调优的工具，基于Zipkin开发了自己的<br>Tracing系统。</p>
<p>按照调用关系，知乎的服务分成了3层：聚合层、内容层和基础层。按属性又可以分成3类：数据服务、逻辑服务和通道服务。数据服务主要是一些要做特殊数据类型的存储，比<br>如图片服务。逻辑服务更多的是CPU密集、计算密集的操作，比如答案格式的定义、解析等。通道服务的特点是没有存储，更多是做一个转发，比如说Sink。<br><img src="http://7xnc86.com1.z0.glb.clouddn.com/zhihu_4.jpg" alt=""><br>这是引入服务化之后整体的架构。  </p>
<p><img src="http://7xnc86.com1.z0.glb.clouddn.com/zhihu_5.jpg" alt="">  </p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="https://haofly.net/python-encoding-specification/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="haofly">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/uploads/avatar.png">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="豪翔天下">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="豪翔天下" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/python-encoding-specification/" itemprop="url">
                  Python编码及注释规范
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2015-04-03T12:38:08+08:00">
                2015-04-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/编程之路/" itemprop="url" rel="index">
                    <span itemprop="name">编程之路</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/python-encoding-specification/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="python-encoding-specification/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Python，我最喜欢的语言。但是，在其强大的功能以及强制的编码格式背后，也会引来一大波的编码方面的困扰，所以依然得需要进行一些规范化。</p>
<h2 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h2><p>函数或者文档的注释使用三引号，结尾空一行</p>
<p><strong>函数注释</strong>需要注明三个参数：Args(参数)、Return(返回值)和Raises(抛出的错误)，例如：</p>
<pre><code>def exampleFunc(one, two):
    &quot;&quot;&quot;
    这里是函数的功能





Args:
    one: 参数一的注释
    two: 参数二的注释

Return:返回值的解释，如果返回值比较复杂，比如是一个json数据，那么还需要将返回的格式卸载这儿

Raises: 非必须
&quot;&quot;&quot;&lt;/pre&gt;
</code></pre><p><strong> 类的注释</strong>，依然得有一行文档字符串，若有共有属性，需要在注释处表名，例如：</p>
<pre><code>class exampleClass(基类):
    &quot;&quot;&quot;
    类的注释





Attributes:
    公有属性1: 解释
&quot;&quot;&quot;&lt;/pre&gt;
</code></pre><p><strong> 文件注释：</strong>一般包括了编码信息、版权、许可声明、模块头等信息，例如：</p>
<pre><code># coding = utf-8




# Copyright 2015 ........




&quot;&quot;&quot;
这里是模块头，用一行文字概括文件或模块或脚本的作用
&quot;&quot;&quot;
</code></pre><h2 id="命名"><a href="#命名" class="headerlink" title="命名"></a>命名</h2><pre><code>module_name：模块
package_name：包
ClassName：类
method_name：方法
ExceptionName：错误
function_name：函数
GLOBAL_VAR_NAME：全局变量
function_parameter_name：函数参数
local_var_name：局部变量
has_或is_：定义布尔类型元素
</code></pre><h2 id="空行"><a href="#空行" class="headerlink" title="空行"></a>空行</h2><p>两个函数的定义之间空两行，而方法或者语句模块之间则只空一行</p>
<h2 id="空格"><a href="#空格" class="headerlink" title="空格"></a>空格</h2><p>二元操作符之间添加空格</p>
<h2 id="其它"><a href="#其它" class="headerlink" title="其它"></a>其它</h2><p>对于常字符串，Python可以使用小括号将行隐式地连接在一起而不用在每行末尾加上加号，例如：</p>
<pre><code>a = (
    &apos;wang&apos;
    &apos;hao&apos;
)
print(a)




# 打印出来就是wanghao
</code></pre>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="https://haofly.net/the-difference-of-frame-and-framework/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="haofly">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/uploads/avatar.png">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="豪翔天下">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="豪翔天下" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/the-difference-of-frame-and-framework/" itemprop="url">
                  [转]一图胜千言:谈框架和架构的区别
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2015-03-28T09:12:20+08:00">
                2015-03-28
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/编程之路/" itemprop="url" rel="index">
                    <span itemprop="name">编程之路</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/the-difference-of-frame-and-framework/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="the-difference-of-frame-and-framework/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="http://7xnc86.com1.z0.glb.clouddn.com/the-difference-of-frame-and-
framework_0.jpg" alt=""></p>
<p>该文章是我之前在麦库里收藏的，但不知为何现在已找不到原文链接了，网上都是些转载文章，还不完整。如果作者能看到，希望作者可以联系我。为使文章结构更清晰，下文稍<br>有改动。</p>
<h2 id="架构和框架的区别"><a href="#架构和框架的区别" class="headerlink" title="架构和框架的区别"></a>架构和框架的区别</h2><p>笔者发现，人们对软件架构存在非常多的误解，其中一个最为普遍的误解就是：将架构和框架（Framework）混为一谈。本文阐述了它们的区别。算是对思辨成果的一个<br>应用吧。一图胜千言，下图切中肯綮地点出了架构和框架的区别。一句话，框架是软件，架构不是软件。  </p>
<p><strong>框架</strong>是一种特殊的<strong>软件</strong>，它并不能提供完整无缺的解决方案，而是为你构建解决方案提供良好的基础。框架是<strong>半成品</strong>。典型地，框架是系统或子系统的半成品；框架中的服务可以被最终应用直接调用，而框架中的扩展点是供应用开发人员定制的“可变化点”。</p>
<p><strong>软件架构不是软件</strong>，而是<strong>关于软件如何设计的重要决策</strong>。软件架构决策涉及到如何将软件系统分解成不同的部分、各部分之间的静态结构关系和动态交互关系等。经过完整的开发过程之后，这些架构决策将体现在最终开发出的软件系统中；当然，引入软件框架之后，整个开发过程变成了“分两步走”，而架构决策往往会体现在框架之中。或许，人们常把架构和框架混为一谈的原因就在于此吧。</p>
<p>理解了本图，我们就很容易理解Frank Buschmann等人在《面向模式的软件体系结构（第一卷）》中为框架所下的定义了，其中也提到了框架和架构的关系：<br><strong><em>框架是一个可实例化的、部分完成的软件系统或子系统，它为一组系统或子系统定义了架构，并提供了构造系统的基本构造块，还为实现特定功能定义了可调整点。在面向对象环境中，框架由抽象类和具体类组成</em>。</strong>（A framework is a partially complete software (sub-) system that is intended to be instantiated. It defines the architecture for a family of (sub-) systems and provides the basic building blocks to create them. It also defines the places where adaptations for specific functionality should be made. In an object-oriented environment a framework consists of abstract and concrete classes.）</p>
<p>在以前经常和同事、朋友，甚至是合作伙伴之间进行一些技术上的交流，很多时候他们给我的印象是软件“架构”和“框架”被混为一谈，而我也曾经经历过这个阶段。在理解上<br>从模糊混淆到有所认识是需要投入足够的时间来进行理解的。软件“架构”和“框架”是两个不同的概念，但它们也是相互关联的。</p>
<p><strong>软件框架是一特殊的软件，由实际的代码构建而成，是软件系统、子系统的半成品。</strong>软件框架为具体的解决方案提供了基础，提供了基础服务和可扩展点，同时软件框架也建立了一些约束，开发人员在此基础上进行特定业务功能的定制开发。例如，在J2EE企业级应用程序开发中，经常使用struts+spring+hibernate来搭建一个基本的项目结构，在没有其他特殊系统需求的前提下，<em>这就是一个软件框架</em>。</p>
<p><strong>软件架构是引导如何设计软件框架的重要决策</strong>。它决定了软件系统如何划分，在一定程度上描述了被划分的各个部分之间的静态、动态关系。软件架构的决策体现在软件系统的框架中。</p>
<p><strong>框架（Framework）</strong>是整个或部分系统的可重用设计，表现为一组抽象构件及构件实例间交互的方法;另一种定义认为，框架是可被应用开发者定制的应用骨架。前者是从应用方面而后者是从目的方面给出的定义。可以说，一个框架是一个可复用的设计构件，它规定了应用的体系结构，阐明了整个设计、协作构件之间的依赖关系、责任分配和控制流程，表现为一组抽象类以及其实例之间协作的方法，它为构件复用提供了上下文(Context)关系。因此构件库的大规模重用也需要框架。</p>
<p>构件领域框架方法在很大程度上借鉴了硬件技术发展的成就，它是构件技术、软件体系结构研究和应用软件开发三者发展结合的产物。在很多情况下，框架通常以构件库的形式出<br>现，但构件库只是框架的一个重要部分。框架的关键还在于框架内对象间的交互模式和控制流模式。</p>
<p>框架比构件可定制性强。在某种程度上，将构件和框架看成两个不同但彼此协作的技术或许更好。框架为构件提供重用的环境，为构件处理错误、交换数据及激活操作提供了标准<br>的方法。</p>
<p>应用框架的概念也很简单。它并不是包含构件应用程序的小片程序，而是实现了某应用领域通用完备功能（除去特殊应用的部分）的底层服务。使用这种框架的编程人员可以在一<br>个通用功能已经实现的基础上开始具体的系统开发。框架提供了所有应用期望的默认行为的类集合。具体的应用通过重写子类(该子类属于框架的默认行为)或组装对象来支持应<br>用专用的行为。</p>
<p>应用框架强调的是软件的设计重用性和系统的可扩充性,以缩短大型应用软件系统的开发周期，提高开发质量。与传统的基于类库的面向对象重用技术比较，应用框架更注重于面<br>向专业领域的软件重用。应用框架具有领域相关性，构件根据框架进行复合而生成可运行的系统。框架的粒度越大，其中包含的领域知识就更加完整。</p>
<p>框架，即framework。其实就是某种应用的半成品，就是一组组件，供你选用完成你自己的系统。简单说就是使用别人搭好的舞台，你来做表演。而且，框架一般是成熟<br>的，不断升级的软件。</p>
<p>框架目前还没有统一的定义，其中Ralph Johnson所给出的定义基本上为大多数研究人员所接受：</p>
<p>一个框架是一个可复用设计，它是由一组抽象类及其实例间协作关系来表达的 【Johnson 98】。</p>
<p>这个定义是从框架内涵的角度来定义框架的，当然也可以从框架用途的角度来给出框架的定义：</p>
<p>一个框架是在一个给定的问题领域内，一个应用程序的一部分设计与实现【Bosch 97】。</p>
<p>从以上两个定义可以看出，框架是对特定应用领域中的应用系统的部分设计和实现的整体结构。<em>框架将应用系统划分为类和对象，定义类和对象的责任，类和对象如何互相协作<br>，以及对象之间的控制线程。</em>这些共有的设计因素由框架预先定义，应用开发人员只须关注于特定的应用系统<strong>特有部分</strong>。框架刻画了其应用领域所共有的设计决策，所<br>以说框架着重于设计复用，尽管框架中可能包含用某种程序设计语言实现的具体类。</p>
<p>一个基于框架开发的应用系统包含一个或多个框架，与框架相关的构件类，以及与应用系统相关的功能扩展。与应用系统相关的扩展包括与应用系统相关的类和对象。应用系统可<br>能仅仅复用了面向对象框架的一部分，或者说，它可能需要对框架进行一些适应性修改，以满足系统需求。</p>
<p>面向对象的框架作为一种可复用的软件，在基于框架的软件开发过程中会涉及到框架的开发和利用两个方面的工作。框架的开发阶段在于产生领域中可复用的设计。该阶段的主要<br>结果是框架以及与框架相关的构件类。该阶段的一个重要活动是框架的演变和维护。象所有软件一样，框架也易于变化。产生变化的原因很多，如应用出错，业务领域变化，等等<br>。</p>
<p>不论是哪一种技术，最终都是为业务发展而服务的。从业务的角度来讲。首先，框架的是为了企业的业务发展和战略规划而服务的，他服从于企业的愿景（vision）；其次<br>，框架最重要的目标是提高企业的竞争能力，包括降低成本、提高质量、改善客户满意程度，控制进度等方面。最后，框架实现这一目标的方式是进行有效的知识积累。软件开发<br>是一种知识活动，因此知识的聚集和积累是至关重要的。框架能够采用一种结构化的方式对某个特定的业务领域进行描述，也就是将这个领域相关的技术以代码、文档、模型等方<br>式固化下来。</p>
<h3 id="详细介绍一下框架的作用"><a href="#详细介绍一下框架的作用" class="headerlink" title="详细介绍一下框架的作用"></a>详细介绍一下框架的作用</h3><p>一、框架要解决的问题</p>
<p>框架要解决的最重要的一个问题是<strong>技术整合</strong>的问题，在J2EE的框架中，有着各种各样的技术，不同的软件企业需要从J2EE中选择不同的技术，这就使得软件企业<br>最终的应用依赖于这些技术，技术自身的复杂性和技术的风险性将会直接对应用造成冲击。而应用是软件企业的核心，是竞争力的关键所在，因此应该将应用自身的设计和具体的<br>实现技术解耦。这样，软件企业的研发将集中在应用的设计上，而不是具体的技术实现，技术实现是应用的底层支撑，它不应该直接对应用产生影响。</p>
<p>要理解这一点，我们来举一些例子：</p>
<p>一个做视频流应用的软件企业，他为电广行业提供整体的解决方案。他的优势在于将各种各样的视频硬件、服务器、和管理结合起来，因此他扮演的是一个集成商的角色。因此他<br>的核心价值在于使用软件技术将不同的硬件整合起来，并在硬件的整合层面上提供一个统一的管理平台。所以他的精力应该放在解决两个问题：</p>
<p>如何找到一种方法，将不同的硬件整合起来，注意，这里的整合并不是技术整合，而是一种思路上的整合。<em>首先要考虑的绝对不是要使用什么技术，而是这些硬件需要提供哪些<br>服务，需要以什么样的方式进行管理</em>。因此，这时候做的事情实际上是对领域进行建模。例如，我们定义任何一种硬件都需要提供两种能力，一种是统一的管理接口，用于对所<br>有硬件统一管理；另一种是服务接口，系统平台可以查询硬件所能够提供的服务，并调用这些服务。所以，设计的规范将会针对两种能力进行。</p>
<p>另一个问题是如何描述这个管理系统的规范。你需要描述各种管理活动，以及管理中所涉及的不同实体。因为管理系统是针对硬件的管理，所以它是构架在硬件整合平台之上的。</p>
<p>在完成业务层面的设计之后，我们再来看看具体的技术实现。光有规范和设计是不够的，我们还需要选择一个优秀的技术。由于是对不同硬件的整合，我们想到采用Java提供<br>的JMX技术。JMX技术适合用来进行系统整合，它定义了一个通用的规范，并给出了远程管理端口的一些默认实现。JMX已经经过了实践的检验，不少的应用服务器都采用<br>了以JMX为基础的结构，例如有名的JBoss。JMX已经是一个很好的开始了，但是我们还需要在JMX的基础上再做一些工作。</p>
<p>二、什么要用框架？</p>
<p>因为软件系统发展到今天已经很复杂了，特别是服务器端软件，设计到的知识，内容，问题太多。在某些方面使用别人成熟的框架，就相当于让别人帮你完成一些基础工作，你只<br>需要集中精力完成系统的业务逻辑设计。而且框架一般是成熟，稳健的，他可以处理系统很多细节问题，比如，事物处理，安全性，数据流控制等问题。还有框架一般都经过很多<br>人使用，所以结构很好，所以扩展性也很好，而且它是不断升级的，你可以直接享受别人升级代码带来的好处。</p>
<p>框架一般处在低层应用平台（如J2EE）和高层业务逻辑之间的<strong>中间层</strong>。软件为什么要分层？为了实现“高内聚、低耦合”。把问题划分开来各个解决，易于控制，易<br>于延展，易于分配资源…总之好处很多啦。</p>
<p>三、为什么要进行框架开发?</p>
<p><strong>框架的最大好处就是重用</strong>。面向对象系统获得的最大的复用方式就是框架，一个大的应用系统往往可能由多层互相协作的框架组成。</p>
<p>由于框架能重用代码，因此从一已有构件库中建立应用变得非常容易，因为构件都采用框架统一定义的接口，从而使构件间的通信简单。</p>
<p>框架能重用设计。它提供可重用的抽象算法及高层设计，并能将大系统分解成更小的构件，而且能描述构件间的内部接口。这些标准接口使在已有的构件基础上通过组装建立各种<br>各样的系统成为可能。只要符合接口定义，新的构件就能插入框架中，构件设计者就能重用构架的bsp;<br>框架还能重用分析。所有的人员若按照框架的思想来分析事务，那么就能将它划分为同样的构件，采用相似的解决方法，从而使采用同一框架的分析人员之间能进行沟通。</p>
<p>采用框架技术进行软件开发的主要特点包括：</p>
<ul>
<li>领域内的软件结构一致性好</li>
<li>建立更加开放的系统</li>
<li>重用代码大大增加，软件生产效率和质量也得到了提高</li>
<li>软件设计人员要专注于对领域的了解，使需求分析更充分</li>
<li>存储了经验，可以让那些经验丰富的人员去设计框架和领域构件，而不必限于低层编程</li>
<li>允许采用快速原型技术</li>
<li>有利于在一个项目内多人协同工作</li>
<li>大粒度的重用使得平均开发费用降低，开发速度加快，开发人员减少，维护费用降低，而参数化框架使得适应性、灵活性增强</li>
</ul>
<p>四、与框架相关的概念</p>
<p>1\. 白盒与黑盒框架</p>
<p>框架可分为白盒(White-Box)与黑盒(Black-Box)两种框架。</p>
<p><strong>基于继承的框架被称为白盒框架</strong>。所谓白盒即具备可视性，被继承的父类的内部实现细节对子类而言都是可知的。利用白盒框架的应用开发者通过衍生子类或重写父类的成员方法来开发系统。子类的实现很大程度上依赖于父类的实现，这种依赖性限制了重用的灵活性和完全性。但解决这种局限性的方法可以是只继承抽象父类，因为抽象类基本上不提供具体的实现。白盒框架是一个程序骨架，而用户衍生出的子类是这个骨架上的附属品。</p>
<p><strong>基于对象构件组装的框架就是黑盒框架</strong>。应用开发者通过整理、组装对象来获得系统的实现。用户只须了解构件的<em>外部接口</em>，无须了解内部的具体实现。另外，组装比继承更为灵活，它能动态地改变，继承只是一个静态编译时的概念。</p>
<p>在理想情况下，任何所需的功能都可通过组装已有的构件得到，事实上可获得的构件远远不能满足需求，有时通过继承获得新的构件比利用已有构件组装新构件更容易，因此白盒<br>和黑盒将同时应用于系统的开发中。不过白盒框架趋向于向黑盒框架发展，黑盒框架也是系统开发希望达到的理想目标。</p>
<p>2\. 热点、食谱以及好莱坞原则</p>
<p>成功的框架开发需要确定领域专用的“热点” (Hot spot)。应用开发者在框架的基础上进行开发，只须扩展框架的某些部分，<em>“热点”就是在应用领域的一种扩展<br>槽，开发者根据自己的需要填充这些扩展槽</em>。“热点”使框架具有灵活性，如在具体的实现中，扩展槽可以被看成是一些抽象类，开发者通过重写抽象方法获得具体实现。</p>
<p>“食谱” (Cookbook)就是描述如何使用框架方法的文档。在“食谱”中包含了许多“烹饪”方法，这些“烹饪”方法相当于一些具体的操作步骤，描述了为解决某一<br>专门问题如何使用框架的详细方法。框架的内部设计和实现细节通常不出现在“食谱”中。</p>
<p>框架的一个重要特征就是用户定义的方法经常被框架自身调用，而不是从用户的应用代码中调用。这种机制常称为“好莱坞原则”(Hollywood<br>Principle)或“别调用我们，我们会调用您”。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="https://haofly.net/github-set-webhook/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="haofly">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/uploads/avatar.png">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="豪翔天下">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="豪翔天下" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/github-set-webhook/" itemprop="url">
                  在Github上设置webhook钩子
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2015-03-22T17:47:14+08:00">
                2015-03-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/编程之路/" itemprop="url" rel="index">
                    <span itemprop="name">编程之路</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/github-set-webhook/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="github-set-webhook/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>又搞了一天才搞好，主要原因是没看懂错误提示信息。</p>
<p><strong>webhook</strong>：简单地说，使用webhook可以让每次在本地push到github上去后，让服务器自动pull下来，这样就不用每次提交然后手动pull的过程了。</p>
<p>下面是详细配置过程(基于laravel)：</p>
<ol>
<li><p>首先，得在laravel里添加一个路由，然后指向某个文件，例如路由为’/webhook’，然后指向PHP文件为’webhook.php’，然后在该文件内添加如下内容，该文件即是服务器响应Github webhook请求的文件：</p>
<pre><code>&lt;?php
    $dir = &apos;/var/www/test&apos;;
    echo shell_exec(&quot;cd /var/www/test&quot;);
    echo shell_exec(&quot;sudo git pull -f git@github.com:haoflynet/guake.git 2&gt;&amp;1&quot;);
?&gt;
</code></pre></li>
<li><p>用户权限问题，由于执行该PHP文件的用户是apache的默认用户www-data，所以我在上面的命令中使用的是’sudo’，这样可以不用给www-<br>data用户生成ssh，然后又出现各种混乱的问题。但是www-<br>data又怎么免输密码执行git命令呢，还好linux提供了这么一个方面的操作，在’/etc/sudoers’文件里有如下内容：</p>
<pre><code># User privilege specification
root ALL=(ALL:ALL) ALL  # 默认的root用户可以在所有平台使用所有权限
www-data ALL=NOPASSWD:/usr/bin/git # 这里给www-data赋予免密码执行git的权限
</code></pre></li>
<li><p>在仓库中添加钩子，执行<code>vim .git/hooks/post-receive</code>，然后添加如下内容，最后还要加入可执行权限：</p>
<pre><code>GIT_WORK_TREE=/var/www git checkout -f
</code></pre></li>
<li><p>在Github上进行设置<br><img src="http://7xnc86.com1.z0.glb.clouddn.com/github-set-webhook_0.png" alt=""><br>如图所示添加webhook，设置中可以选择各种出发事件event，一般默认是push事件，在Payload<br>URL中设置自己刚才所设置的URL，最后添加即可完成。</p>
</li>
<li><p>测试<br>测试钩子的时候，可以直接在Github上面看到执行的列表，还可以看到每一个POST的详细信息以及响应信息：<br><img src="http://7xnc86.com1.z0.glb.clouddn.com/github-set-webhook_2.png" alt="">  </p>
</li>
</ol>
<h2 id="TroubleShooting："><a href="#TroubleShooting：" class="headerlink" title="TroubleShooting："></a>TroubleShooting：</h2><ul>
<li>Laravel 5中如果要设置webhook，该POST路由不能使用CSRF</li>
<li><p>Django同样要禁用csrf：</p>
<pre><code>import os
from django.views.decorators.csrf import csrf_exempt
from django.http import HttpResponse

@csrf_exempt
def webhook(request):
    os.system(&apos;cd /var/www/admin&apos;)
os.system(&apos;git pull -f git@github.com:haoflynet/admin.git 2&gt;&amp;1&apos;)
    return HttpResponse(&apos;ok&apos;)
</code></pre></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="https://haofly.net/android/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="haofly">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/uploads/avatar.png">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="豪翔天下">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="豪翔天下" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/android/" itemprop="url">
                  Android开发
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2015-03-18T09:12:39+08:00">
                2015-03-18
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/system/" itemprop="url" rel="index">
                    <span itemprop="name">system</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/android/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="android/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Android开发"><a href="#Android开发" class="headerlink" title="#Android开发"></a>#Android开发</h2><p>title: “Android 奇淫技巧”<br>date: 2015-08-27 14:10:14</p>
<h2 id="categories-android"><a href="#categories-android" class="headerlink" title="categories: android"></a>categories: android</h2><p>本文搜集了一些自己经常用到的Android方面的奇淫技巧：</p>
<ul>
<li><p>调试：打印日志的方式</p>
<pre><code>Log.v(String tag, String msg);  //verbose类型日志，颜色为黑色
</code></pre><p>Log.d(String tag, String msg);  //debug日志，颜色为蓝色<br>Log.i(String tag, String msg);  //information日志，颜色为绿色<br>Log.w(String tag, String msg); //warn告警日志，颜色为橙色<br>Log.e(String tag, String msg); //error错误日志，颜色肯定为红色</p>
</li>
<li><p>Toast提示框：</p>
<pre><code>    import android.widget.Toast;
Toast.makeText(this,&quot;显示内容&quot;, Toast.LENGTH_SHORT).show();
</code></pre><ul>
<li><p>获取系统时间</p>
<pre><code>import    java.text.SimpleDateFormat;     
</code></pre></li>
</ul>
</li>
</ul>
<pre><code>SimpleDateFOrmat formatter = new SimpleDateFormat(&quot;yyyy年MM月日 HH:mm:ss&quot;);
Date curDate = new Date(System.currentTimeMillis()); // 获取当前时间
String str = formatter.formate(curDate);
</code></pre><ul>
<li><p>获取当前地理位置</p>
<pre><code>public Location getLocation() \{
LocationManager locManger = (LocationManager) getSystemService(Context.LOCATION_SERVICE);
Location loc = locManger.getLastKnownLocation(LocationManager.GPS_PROVIDER);
if (loc == null) \{
    loc = locManger.getLastKnownLocation(LocationManager.NETWORK_PROVIDER);
\}
return loc;
</code></pre><p>}</p>
</li>
<li><p>让APP变成系统应用，无法卸载：必须root后通过re管理器进入/app目录，把安装包放在那里然后重启会自动安装</p>
<ul>
<li><p>让APP开机自启动</p>
<pre><code>开机自启动
</code></pre><p><activity></activity></p>
<pre><code>&lt;intent-filter&gt;
    &lt;action android:name=&quot;android.intent.action.BOOT_COMPLETED&quot;/&gt;
    &lt;category android:name=&quot;android.intent.category.HOME&quot; /&gt;
&lt;/intent-filter&gt;
</code></pre><p><br>权限<br><uses-permission android:name="android.permission.RECEIVE_BOOT_COMPLETED"></uses-permission></p>
</li>
<li><p>Android镜像下载慢的问题，使用<a href="http://sunjiajia.com/2015/08/16/tencent-bugly-android-sdk-mirror/" title="Link: http://sunjiajia.com/2015/08/16/tencent-bugly-android-sdk-mirror/" target="_blank" rel="external">腾讯Bugly Android SDk 镜像</a></p>
</li>
<li>HTTP请求：</li>
<li>mainxml的设置  </li>
</ul>
</li>
</ul>
<pre><code>    # 使程序不现实在最近程序列表中
&lt;activity  android:excludeFromRecents=&quot;true&quot;&gt;&lt;/&gt;
</code></pre><ul>
<li></li>
</ul>
<p>###Android Activity<br>Activity生命周期的七个函数：<br><strong>onStart()</strong>：可以被用户看到的时候调用的方法<br><strong>onRestart()</strong>：从第二个返回第一个，因为第一个没被销毁<br><strong>onResume()</strong>：可以获得用户焦点的时候调用<br><strong>onPause()</strong>：从一个Activity换向另一个Activity时第一个会调用这个<br><strong>onStop()</strong>：当调完第二个时，第一个就调用这个，该Activity处于不可见时，而如果没有全部遮挡起来就不会调用第一个的onStop()方法了<br><strong>onDestroy()</strong>：如果点击返回，可能会调用这个，把第二个摧毁了    </p>
<hr>
<p>title: “新建Android项目时避免继承ActionBarActivity并去掉titleBar”<br>date: 2014-09-02 10:02:54</p>
<h2 id="categories-Android"><a href="#categories-Android" class="headerlink" title="categories: Android"></a>categories: Android</h2><p>大家都知道，在最新的SDK里新建项目时默认Activity是继承于ActionBarActivity而不是Activity，虽然这样做对于大多数用户是有好处<br>的(考虑到兼容性)，但许多用户都不习惯这样的做法，我们都喜欢更自由的方法，直接继承于Activity。</p>
<p>解决方法：<br><img src="http://7xnc86.com1.z0.glb.clouddn.com/android-unable.jpg" alt="">  </p>
<p>在新建项目时Theme选择None，这样就可以直接继承了Activity，但是光这样做还是有titleBar出现，此时我们就要修改style文件(位于val<br>ue-vX这几个文件夹中)，将</p>
<p>style中标签中的parent修改为parent=”@android:style/Theme.Light.NoTitleBar”即可</p>
<hr>
<p>title: “导入android项目：android.support.v7”<br>date: 2014-08-30 17:11:41</p>
<h2 id="categories-Android-1"><a href="#categories-Android-1" class="headerlink" title="categories: Android"></a>categories: Android</h2><p>问题原因：在高版本安卓SDK里导入低版本的SDK时出现的错误</p>
<p>背景知识：Google为开发者提供了Android Support Library<br>Package来保证高版本的SDK开发能够向下兼容，所以提供了Android Support<br>v4/v7/v13等几个包来分别照顾安卓1.6以上、安卓2.1以上和安卓3.2以上的版本。</p>
<p>解决方案：</p>
<p>我们在安装SDK的时候其实这几个jar包都已经在目录中了，所以可以直接在系统SDK安装目录里面搜索android-<br>support即可找到对应的jar包，我的SDK目录里能收到一下内容：</p>
<p>android-support-v4.jar<br>android-support-v13.jar<br>android-support-v7-appcompat.jar<br>android-support-v7-gridlayout.jar<br>android-support-v7-mediarouter.jar</p>
<p>找到对应的路径后，在项目名称上点击右键-&gt;构建路径-&gt;配置构建路径，在库(L)里面选择添加外部JAR(X)，然后在那个路径下面选择该jar即可。</p>
<hr>
<p>title: “导入android项目：Unable to resolve target ‘android-14’”<br>date: 2014-08-30 16:57:50</p>
<h2 id="categories-Android-2"><a href="#categories-Android-2" class="headerlink" title="categories: Android"></a>categories: Android</h2><p>这是因为Android SDK的API版本不一致所致，一般出现在把低版本的安卓项目导入高版本安卓项目所致，因为我的Eclipse默认是Android<br>4.2.2(API 17)，即android-17，而该项目是Android 4.0(API<br>14)编写的，所以导入的时候需要修改项目的属性，具体API对照表可直接打开Android SDK Manager里面<br><img src="http://7xnc86.com1.z0.glb.clouddn.com/android-unable.jpg" alt=""><br>解决方案一：直接到该项目的工作目录下找到project.properties文件，修改</p>
<pre><code># Project target.
target=android-14
</code></pre><p>把其中的14改为默认的17即可。</p>
<p>解决方案二：安装android-14对应的SDK(即Android4.0)</p>
<p>handler是android中为了处理异步线程更新UI的问题而出现的一个工具。在android异步线程是不能够更新UI的，只能在主线程中更新UI。那么就要通过handle来更新。</p>
<p>handle不能直接写在Activity里，不然会报警告Handler Class Should be Static or Leaks Occur。应该这样写：<br>public class SampleActivity extends Activity {</p>
<p>  /**</p>
<ul>
<li>Instances of static inner classes do not hold an implicit</li>
<li><p>reference to their outer class.<br>  */<br> private static class MyHandler extends Handler {<br>   private final WeakReference<sampleactivity> mActivity;</sampleactivity></p>
<p>   public MyHandler(SampleActivity activity) {</p>
<pre><code>mActivity = new WeakReference&lt;SampleActivity&gt;(activity);
</code></pre><p>   }</p>
<p>   @Override<br>   public void handleMessage(Message msg) {</p>
<pre><code>SampleActivity activity = mActivity.get();
if (activity != null) {
  //
</code></pre><p> switch(msg.what){<br>  case 产量：<br>   String str1 = msg.getData().getString(“变量名”);break;<br>   default: break;<br> }</p>
<pre><code>}
</code></pre><p>   }<br> }</p>
<p> private final MyHandler mHandler = new MyHandler(this);</p>
<p> /**</p>
<ul>
<li>Instances of anonymous classes do not hold an implicit</li>
<li><p>reference to their outer class when they are “static”.<br>*/<br>private static final Runnable sRunnable = new Runnable() {<br> @Override<br> public void run() {</p>
<p>   Message msg = new Message();<br>msg.what = 常量<br>Bundle bundle = new Bundle();<br>bundle.putString(“变量名”, “变量值”);<br>bundle.putString(“变量名”, “变量值”);<br>msg.setData(bundle);<br>mHandler.sendMessage(bundle);<br>   }<br>};</p>
</li>
</ul>
<p>@Override<br>protected void onCreate(Bundle savedInstanceState) {<br> super.onCreate(savedInstanceState);</p>
<p> // Post a message and delay its execution for 10 minutes.<br> mHandler.postDelayed(sRunnable, 60 <em> 10 </em> 1000);</p>
<p> // Go back to the previous Activity.<br> finish();<br>}<br>}</p>
</li>
</ul>
<p>来源： <a href="http://www.jcodecraeer.com/a/anzhuokaifa/androidkaifa/2014/1106/1922.html" target="_blank" rel="external">http://www.jcodecraeer.com/a/anzhuokaifa/androidkaifa/2014/1106/1922.html</a></p>
<p>package com.example.haofly.myapplication;</p>
<p>import android.app.Notification;<br>import android.app.PendingIntent;<br>import android.app.Service;<br>import android.content.Intent;<br>import android.os.Binder;<br>import android.os.IBinder;<br>import android.util.Log;</p>
<p>/**</p>
<ul>
<li><p>Created by haofly on 15/8/23.<br> */<br>public class LocalService extends Service{<br> private IBinder binder = new LocalService.LocalBinder();</p>
<p> @Override<br> public IBinder onBind(Intent intent){</p>
<pre><code>return binder;
</code></pre><p> }</p>
<p> @Override<br> public void onCreate(){</p>
<pre><code>Log.v(&quot;haofly&quot;, &quot;create&quot;);
int a = 1000;
while(a &gt; 0){
    Log.v(&quot;haofly&quot;, &quot;success&quot;);
    try {
        Thread.sleep(1000);
    } catch (InterruptedException e) {
        e.printStackTrace();
    }
    a = a-1;
}
</code></pre><p> }</p>
</li>
</ul>
<pre><code>public class LocalBinder extends Binder {
    LocalService getService(){
        return LocalService.this;
    }
}

@Override
public int onStartCommand(Intent intent, int flags, int startId) {
    return super.onStartCommand(intent, flags, startId);
}
</code></pre><p>}</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="https://haofly.net/regret-living-on-others-life/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="haofly">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/uploads/avatar.png">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="豪翔天下">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="豪翔天下" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/regret-living-on-others-life/" itemprop="url">
                  最后悔莫过于过上别人期待的人生
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2015-03-15T09:32:57+08:00">
                2015-03-15
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/边走边想/" itemprop="url" rel="index">
                    <span itemprop="name">边走边想</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/regret-living-on-others-life/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="regret-living-on-others-life/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>写这篇文章源于年前一个程序爱好者的QQ群里的一次讨论，很想说说自己的想法。以下是我们的聊天内容(本来想直接上传截图的，但是太小看不清，所以一字一字敲出来吧)<br>：</p>
<p>A：家里人给介绍一个工作，在一个效益很好的单位干文职<br><code>A即是主人公</code><br>A：我想，我以后不会再做程序方面的工作了<br>A：…可是我还是对PHP比较有兴趣<br>A：for($i=╯﹏╰; $i &lt; 999999; $i++){ echo $i;}<br>B：这种工作应该不会太忙吧<br><code>我上场啦</code><br>A：是的<br>B：还不是可以在闲暇的时候写代码<br>A：家里人都想找个稳定的<br><code>让他们去找呗。。。</code><br>A：..我觉得 如果爱好 就要一心一意的<br><code>不同意，反正我爱好很多，如果一辈子只有一个爱好那多无聊呀</code><br>A：想了很久 真想 破釜沉舟！！<br><code>破釜沉舟这个词我是去年在决定不考研的时候用过，当时一下就把所有的书给卖了</code><br>C：那么问题来了<br>A：妈的 就是 不敢<br>D：。。。<br>C：到底应该是践行自己的目标呢？还是开一辈子挖掘机<br><code>不是蓝翔毕业能开好挖掘机吗，哈哈</code><br>D：亮点是不敢<br><code>有的人怕的是违反父命，有的人怕的是未知的人生</code><br>B：无法理解你们已经工作了的人<br><code>由于大人总是说我幼稚，所以有可能确实是我没去社会无法理解你们</code><br>A：要是敢了 我也不会这么说…<br><code>如果真的觉得自己不能勇敢一次，就没必要说出来了</code><br>A：现实！<br>A：马勒个B<br>E：我父母当年安排进入事业单位，年少轻狂，坚决不去，结果现在惨兮兮。。。<br><code>这是重点任务，只有经历过的，才有资格说话</code><br>D：不能反抗 那你就躺好姿势享受就是了<br><code>生活就像强奸，要么反抗要么就去享受；工作就像轮奸，您不行就让别人上 ；社会就像自慰，所有的都要靠自己的双手来解决</code><br>A：我不能说，如果我继续干PHP，以后能怎么样怎么样，但是现在就是选择<br><code>我知道，他们会说如果按照他们的干，以后能怎么样怎么样</code><br>A：我就是知道这些，才特别特别的纠结<br>A：就是选择if else，执行了，if下面就跟你没关系了<br>D：呵呵<br>E：<strong>惨兮兮怎么了，好歹自己选的</strong><br>A：你后悔么？如果让你再选你怎么选？<br>E：<strong>有时候哭起来，说不后悔是假的。但是心里还是觉得，自己能选择还是好</strong>。<br><code>这句话说到我心坎里来了</code><br>F：我就是听从了父母的安排，每天就像在等死一样！现在觉得我不能再坐以待毙！才开始自学网页方面的知识，虽然我不了解网页！但是我有学习的能力！<br><code>另一个例子出来了，无论怎样，看样子他已经找到了自己想要走的路了</code></p>
<p>虽然我还在上大学，但我已经体会到生活中有各种各样的if else，很多情况，我们只能选择一条路。但无论选择哪一条路，未来都是未知的，只是从过往的经验来看，总<br>有那么一条路要诱人一点。选择诱人的那条路无可厚非。但别人的现在并不一定会成为你的未来，既然都是未知的，为何不选择自己喜欢的那条路呢，既然都可能会后悔，你想想<br>选择哪一条路会更后悔呢？下面是罗伯特·弗罗斯特的一首诗，我们应该都听过：</p>
<p>黄色的林子里有两条路<br>很遗憾我无法同时选择两者<br>身在旅途的我久久站立<br>对着其中一条极目眺望<br>直到它蜿蜒拐进远处的树丛</p>
<p>我选择了另外的一条，天经地义<br>也许更为诱人<br>因为它充满荆棘，需要开拓<br>然而这样的路过<br>并未引起太大的改变</p>
<p>那天清晨这两条小路一起静卧在<br>无人踩过的树叶丛中<br>哦，我把另一条路留给了明天<br>明知路连着路<br>我不知是否该回头</p>
<p>我将轻轻叹息，叙述这一切<br>许多许多年以后：<br>林子里有两条路，我——<br>选择了行人稀少的那一条<br>它改变了我的一生</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="https://haofly.net/wamp/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="haofly">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/uploads/avatar.png">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="豪翔天下">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="豪翔天下" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/wamp/" itemprop="url">
                  Wamp环境设置虚拟目录
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2015-03-14T20:48:38+08:00">
                2015-03-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/server/" itemprop="url" rel="index">
                    <span itemprop="name">server</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/wamp/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="wamp/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>记得以前在wamp设置虚拟目录的时候都还挺简单的，干脆直接没有记录下来，但这次遇到一些坑，特记录于此。</p>
<p>系统环境：Windows 7 + WampServer2.5</p>
<p>注意事项：下面的步骤一定要参考其完整路径，切勿直接在资源管理器里进行搜索，因为在C:\wamp\bin\apache\apache2.4.9\conf目录下<br>居然有一个original，应该是用来保存最原始的配置信息，对这里面的配置文件进行的更改并不会影响当前的使用。</p>
<p>配置过程：</p>
<ol>
<li><p>首先在C:\wamp\bin\apache\apache2.4.9\conf\httpd.conf目录中找到下面两行：</p>
<h1 id="Virtual-hosts"><a href="#Virtual-hosts" class="headerlink" title="Virtual hosts"></a>Virtual hosts</h1><p>Include conf/extra/httpd-vhosts.conf  # 去掉这一行的注释</p>
</li>
<li><p>然后仍然在该文件中找到监听端口的配置</p>
<p>   #Listen 12.34.56.78:80<br>Listen 0.0.0.0:80<br>Listen [::0]:80<br>Listen 8080       # 这一行是自己添加的，我想要它监听8080端口</p>
</li>
<li><p>将vhost的配置文件C:\wamp\bin\apache\apache2.4.9\conf\extra\httpd-vhosts.conf修改为如下(去掉原来的)：</p>
   <virtualhost *:80=""><br>   DocumentRoot “c:/wamp/www”<br>   ServerName localhost<br>   ServerAlias localhost<br>   <directory "c:="" wamp="" www"=""><br>      AllowOverride All<br>   Require local<br>   </directory><br></virtualhost>

<hr>
<p>title: “wamp 局域网403 Forbidden解决方法”<br>date: 2014-11-09 16:10:02</p>
<h2 id="categories-wamp"><a href="#categories-wamp" class="headerlink" title="categories: wamp"></a>categories: wamp</h2><p>近日，经常需要和对面寝室的同学交流一个网站的设计，但直接把笔记本搬过去太不方便了，于是想到了使用最近刚买的平板电脑，但是平板电脑脸上电脑上的wifi居然无法<br>访问笔记本里的wamp服务，出现403错误，好吧，我原以为在局域网内是可以不用设置其他东西的哟。其实解决方法很简单，但是和linux系统不一样，linux使<br>用<code>Allow from all</code>，而windows使用<code>Require all granted</code>解决方法如下：</p>
<p><strong>环境</strong>：windows7 + wampserver2.5</p>
<h1 id="解决步骤："><a href="#解决步骤：" class="headerlink" title="解决步骤："></a>解决步骤：</h1><p>首先找到wamp的apache配置文件目录，我的在<code>C:\\wamp\\bin\\apache\\apache2.4.9\\conf\\http.conf</code>，然后打开它<br>后找到，如下几行</p>
</li>
</ol>
<pre><code>    # Each directory to which Apache has access can be configured with respect




    # to which services and features are allowed and/or disabled in that




    # directory (and its subdirectories).




    #




    # First, we configure the &quot;default&quot; to be a very restrictive set of




    # features.




    #




    &lt;Directory /&gt;
        AllowOverride All
        #Order Deny,Allow     # 注释掉
        Require all granted   # 添加这一行
    &lt;/Directory&gt;





&lt;VirtualHost *:8080&gt;
    DocumentRoot &quot;f:/workspace/laravel/public&quot;
    ServerName localhost
    ServerAlias localhost
    &lt;Directory  &quot;f:/workspace/laravel/public&quot;&gt;
        AllowOverride All
        Require local
    &lt;/Directory&gt;
&lt;/VirtualHost&gt;
</code></pre><ol>
<li>重启Apache即可</li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="https://haofly.net/django/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="haofly">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/uploads/avatar.png">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="豪翔天下">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="豪翔天下" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/django/" itemprop="url">
                  Django教程
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2015-03-14T08:44:39+08:00">
                2015-03-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/" itemprop="url" rel="index">
                    <span itemprop="name">python</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/django/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="django/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Django教程"><a href="#Django教程" class="headerlink" title="Django教程"></a>Django教程</h1><p>Python一直是我最喜欢的语言，在这个寒假打算认真学习一下Python的Web框架。在Django和Tornado之间我选择了前者，没有特别的原因，网上人云亦云的，肯定不会有一方离另一方差很远，我就直接去看了看Github上两个项目的活跃度，所以选择了前者。</p>
<p>应该说Django坚持自己造轮子，确实为开发者节约了不少的时间，我很看重它的扩展功能，packages数量十分丰富。Django采用的是最流行也是我最熟悉的MVC设计模式，虽然在之前的一个PHP(Laravel)项目中也是采用的MVC模式，但一直都没怎么吃透，始终在各层分离的时候不是很清晰，所以也可趁学习Django对MVC的概念进行强化。</p>
<p>Django另一个我特别喜欢的特性就是Application，它与Project的概念不同，一个APP就相当于一个功能模块，一个Project可以包含多个APP，一个APP可以同时被多个Project引用，App增加了代码的复用机会，提高了扩展性和松耦合性，Django中很多的packages都是以APP的形式存在的。</p>
<p>另外，我学习主要参考的是开源书籍 <a href="http://andrew-liu.gitbooks.io/django-blog/" title="Link: http://andrew-liu.gitbooks.io/django-blog/" target="_blank" rel="external">Django搭建简易博客教程</a></p>
<p>下面是搭建一个Django环境的基本步骤：</p>
<ol>
<li><a href="http://haofly.net/virtualenv-python-django/">使用Virtualenv搭建Python3的Django环境</a></li>
<li><p>新建项目 <code>django-admin startproject 项目名</code> 这样会在当前目录新建一个目录，里面已经有一些基本的配置文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">django_test</div><div class="line">├── db.sqlite3</div><div class="line">├── django_test</div><div class="line">│   ├── __init__.py</div><div class="line">│   ├── settings.py</div><div class="line">│   ├── urls.py</div><div class="line">│   └── wsgi.py</div><div class="line">└── manage.py</div></pre></td></tr></table></figure>
</li>
<li><p>新建APP <code>django-admin startapp APP名称</code> 如果是搭建一个非常简单的应用，那么不使用APP也行，只需要吧路由指向目标view就可以了，但是如果要搭建复杂的应用并且需要良好的隔离性，那最好使用APP。同样，使用该命令也会在当前目录下新建一个目录，里面已经包含一些配置文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">django_test/testapp</div><div class="line">├── admin.py	# 注册models，用于admin管理</div><div class="line">├── __init__.py</div><div class="line">├── migrations	# 数据库迁移</div><div class="line">├── models.py	# 定义models</div><div class="line">├── tests.py	# 单元测试</div><div class="line">├── apps.py		# App的配置类，AppConfig用于存储应用程序的元数据</div><div class="line">└── views.py	# 视图文件</div></pre></td></tr></table></figure>
<p>如过添加了APP，那么需要在主配置文件<code>settings.py</code>里面的<code>INSTALLED_APPS</code>里面添加该APP的名称</p>
</li>
<li><p>Hello World！ 所有入门教程都必须要有一个Hello World! 首先，在APP的视图文件views.py里添加函数，该函数直接返回一个字符串的响应：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</div><div class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse</div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span><span class="params">(request)</span>:</span></div><div class="line">	<span class="keyword">return</span> HttpResponse(<span class="string">'Hello World!'</span>)</div></pre></td></tr></table></figure>
<p>然后添加URL，在Project目录里的<code>urls.py</code>里进行管理，添加hello的url如下：</p>
<pre><code>from django.conf.urls import patterns, include, url
from django.contrib import admin

urlpatterns = [
    url(r&apos;^admin/&apos;, include(admin.site.urls)),
    url(r&apos;^hello/&apos;, &apos;testapp.views.hello&apos;),
]
</code></pre></li>
<li>运行 <code>python manage.py runserver</code> 如果要以daemon的方式在后台运行，可以使用nohup命令 <code>nohup python manage.py runserver 0.0.0.0:8000 &amp;</code> 使用它可以打开Django自带的默认Web引擎，可以在 <a href="http://127.0.0.1:8000中查" target="_blank" rel="external">http://127.0.0.1:8000中查</a>看 在测试的时候可以使用该引擎，它不仅轻量，而且在打开后还会自动检测代码的更改，进行自动更新，这样就不用每次对代码变动了都来重启一次</li>
</ol>
<h2 id="配置项"><a href="#配置项" class="headerlink" title="配置项"></a>配置项</h2><h3 id="全局配置"><a href="#全局配置" class="headerlink" title="全局配置"></a>全局配置</h3><p>需要注意的是，Django官方并没有默认的分离配置文件的方案，我觉得最佳的方式是，建立多个配置文件，然后在默认的配置文件里面进行导入即可。例如:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">env = <span class="string">'local'</span></div><div class="line"></div><div class="line"><span class="keyword">if</span> env == <span class="string">'local'</span>:</div><div class="line">    <span class="keyword">from</span> settings_local <span class="keyword">import</span> *</div><div class="line"><span class="keyword">else</span>:</div><div class="line">    <span class="keyword">from</span> settings_prod <span class="keyword">import</span> *</div></pre></td></tr></table></figure>
<p>配置文件内容</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">DEBUG = <span class="keyword">True</span>			<span class="comment"># DEBUG模式</span></div><div class="line">TEMPLATE_DEBUG = <span class="keyword">True</span>	<span class="comment"># TEMPLATE的DEBUG模式</span></div><div class="line"></div><div class="line">ALLOWED_HOSTS = []   	<span class="comment"># 设置哪些域名可以访问，当debug为false时必须为其指定一个值，['*']表示允许所有的访问</span></div><div class="line"></div><div class="line">INSTALLED_APPS = [默认APP+自己的APP]</div><div class="line">MIDDLEWARE_CLASSES = [中间件]</div><div class="line"></div><div class="line">ROOT_URLCONF = <span class="string">'admin.urls'</span>	<span class="comment"># 读取的默认的url文件</span></div><div class="line"></div><div class="line"><span class="comment"># Database 数据库的配置</span></div><div class="line">DATABASES = &#123;</div><div class="line">    <span class="string">'default'</span>: &#123;</div><div class="line">        <span class="string">'ENGINE'</span>: <span class="string">'django.db.backends.mysql'</span>,	<span class="comment"># MySQL/Mariadb数据库设置</span></div><div class="line">        <span class="string">'NAME'</span>: <span class="string">'admin'</span>,</div><div class="line">        <span class="string">'USER'</span>: <span class="string">'root'</span>,</div><div class="line">        <span class="string">'PASSWORD'</span>: <span class="string">'mysql'</span>,</div><div class="line">        <span class="string">'HOST'</span>: <span class="string">'127.0.0.1'</span>,</div><div class="line">        <span class="string">'PORT'</span>: <span class="number">3307</span></div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">LANGUAGE_CODE = <span class="string">'en-us'</span>  <span class="comment"># 语言，中文可用zh-Hans、zh-CN，完整列表见：http://www.i18nguy.com/unicode/language-identifiers.html</span></div><div class="line">TIME_ZONE = <span class="string">'Asia/Chongqing'</span>        <span class="comment"># 时区</span></div><div class="line"></div><div class="line"><span class="comment"># Static files (CSS, JavaScript, Images) 静态文件目录  </span></div><div class="line">STATIC_URL = <span class="string">'/static/'</span></div><div class="line">STATIC_ROOT = os.path.join(BASE_DIR, <span class="string">'static'</span>) <span class="comment"># 这个选项默认是没有的，在编码时将静态文件放在APP中的static目录下，部署时用python manage.py collectstatic就可以把静态文件收集到STATIDC_ROOT目录</span></div></pre></td></tr></table></figure>
<p>在其他文件访问全局配置项，可以这样访问：</p>
<pre><code>from django.conf import settings
settings.DEBUG
</code></pre><h3 id="应用配置"><a href="#应用配置" class="headerlink" title="应用配置"></a>应用配置</h3><p>在上面新建的app的目录结构里面又一个<code>apps.py</code>文件，它存储了应用的元数据，通过继承<code>AppConfig</code>来配置其属性，可配置的选项如下:</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">可配置的属性</div><div class="line">AppConfig.name			# 应用的完整Python路径，例如django.crontrib.admin，在整个Django项目中必须是唯一的</div><div class="line">AppConfig.label			# 应用的缩写，例如admin，</div><div class="line">AppConfig.verbose_name	# 应用的适合阅读的名称</div><div class="line">AppConfig.path			# 应用目录的文件系统路径，例如/usr/lib/python3.4/dist-packages/django/contrib/admin</div><div class="line"></div><div class="line">可配置的方法</div><div class="line">AppConfig.get_models()			# 返回可迭代的Model类</div><div class="line">AppConfig.get_model(model_name)	# 返回具体的Model</div><div class="line">AppConfig.ready()				# 执行初始化任务</div></pre></td></tr></table></figure>
<h2 id="路由与视图"><a href="#路由与视图" class="headerlink" title="路由与视图"></a>路由与视图</h2><p><strong>url</strong>: web访问请求的入口(相当于Laravel里的路由)<br><strong>view</strong>：应用的逻辑部分，从客户端接收请求，处理并返回数据，一般返回到template模板进行渲染(相当于Laravel里的控制器)<br>将<code>/test</code>定位到article这个APP里面的views里面的home方法来处理的形式</p>
<pre><code>url(r&apos;^test$&apos;, &apos;article.views.home&apos;)
</code></pre><h4 id="url传递参数"><a href="#url传递参数" class="headerlink" title="url传递参数"></a>url传递参数</h4><p>Django的路由是采用正则表达式来匹配的，同样能使用命名组，比如<code>(?P&lt;name&gt;)</code>，这样就可以通过URL给views传递参数了，例如：</p>
<pre><code># 有如下视图
def hello(request, name):
    return HttpResponse(&apos;name is %s&apos;, % name)
# 在url中可以这样写
url(r&apos;^(?P&lt;name&gt;\d+)/$&apos;, &apos;testapp.views.hello)
</code></pre><h4 id="url命名"><a href="#url命名" class="headerlink" title="url命名"></a>url命名</h4><pre><code>url(r&apos;^add/$&apos;, &apos;app.views.add&apos;, name=&apos;add&apos;)
</code></pre><p>给url命名可以方便我们进行统一修改url样式，比如之前用<code>a-and-b</code>的url可以访问到add这个方法，但现在如果想改成<code>a/b</code>的方式来访问，那么由于后端的模板渲染等都是用的其命名<code>add</code>，就无需修改后端逻辑了</p>
<h4 id="路由按照app分组"><a href="#路由按照app分组" class="headerlink" title="路由按照app分组"></a>路由按照app分组</h4><p>首先主urls.py里面使用include包含应用下的urls.py文件</p>
<pre><code>from django.conf.urls import include
urlpatterns = [
    url(r&apos;^app1&apos;, include(&apos;app1.urls&apos;)),
]
</code></pre><p>然后在app1下的urls.py文件里面，进行如下设置:</p>
<pre><code>from django.conf.urls import url
from . import views

urlpatterns = [
    url(r&apos;^/$&apos;, views.hello),
]
</code></pre><p>这样就可以通过<code>/app1/</code>，来访问app1下的hello方法了</p>
<h2 id="数据库"><a href="#数据库" class="headerlink" title="数据库"></a>数据库</h2><p>Django同很多框架一样使用了ORM(Object Relational Mapping，对象关系映射)的方式，每个model类代表一张数据库的表，每一个属性代表其一个字段(这种特性的实现依赖于python的元类)。 </p>
<h3 id="数据表定义"><a href="#数据表定义" class="headerlink" title="数据表定义"></a>数据表定义</h3><p>定义model的文件是<code>project/app/models.py</code>里面，例如，要定义一张用户表：</p>
<pre><code>fromo django.db import models

class User(models.Model):
    username = models.CharField(max_length = 20)    # 用户名字段
    create_time = models.DateTimeField(auto_now_add = True)    # 注册日期字段，如果同时有两个字段对应着同一个外键，那么久得重命名字段名了，比如：
    receiver = models.ForeignKey(Users, null=True, related_name=&apos;receiver&apos;)
    poster = models.ForeignKey(Users, null=True, related_name=&apos;poster&apos;)

    def __str__(self):
        &apos;&apos;&apos;这个函数可以用于str(obj)函数来输出该对象的信息，默认是表名&apos;&apos;&apos;
        return self.username
</code></pre><p>当建立好models过后，执行如下命令就可以在数据库中新建或更新数据表了：</p>
<pre><code>python manage.py makemigrations
python manage.py migrate
</code></pre><p>注：如果是有修改的，那么新添加的数据必须要允许null或者设置默认值，否则会报错，这其实是为了保护已经存在了的数据，当然在添加完该字段后把null去掉再更新数据库就可以了。</p>
<h3 id="字段类型"><a href="#字段类型" class="headerlink" title="字段类型"></a>字段类型</h3><p>注：Django默认为每张表设置了一个int(11)的自增主键，不需要自己去定义了。</p>
<h4 id="字段通用参数"><a href="#字段通用参数" class="headerlink" title="字段通用参数"></a>字段通用参数</h4><pre><code>primary_key = False/True   # 是否设置为主键
blank = False/True         # 是否可为空，这其实是用于Field的判断
null = False/True          # 是否可为空，这才是真正的数据库里面是否可以为null
max_length = 3             # 最大长度，对整型无效
default = &apos;&apos;               # 设置默认值
verbose_name =             # 相当于备注，如果没给出那么就是该字段,当然，要指定的话，可以直接第一个参数一个字符串就可以指定了
editable = False/True      # 是否可编辑
unique = False/True        # 是否唯一
auto_now = False/True      # 用于时间，每次更新记录的时候更新该字段
auto_now_add = False/True  # 用于时间，创建新纪录的时候自动更新该字段
choices # 很实用的一个功能，相当于存储一个枚举列表，其中左边的key是实际存储在数据库中的值，例如，可以这样定义一个字段：
    YEAR_IN_SCHOOL_CHOICES= (
        (&apos;FR&apos;, &apos;Freshman&apos;),
        (&apos;SO&apos;, &apos;Sophomore&apos;),
        (&apos;JR&apos;, &apos;Junior&apos;),
        (&apos;SR&apos;, &apos;Senior&apos;),
    )
    然后在定义字段的时候给个参数choices=YEAR_IN_SCHOOL_CHOICES，在插入字段的时候，使用&apos;RF&apos;这样的，在获取字段值的时候这样：p.get_year_in_school_display()即可显示&apos;Freshman&apos;
verbose_name        # 定义字段的注释
</code></pre><h4 id="常用类型"><a href="#常用类型" class="headerlink" title="常用类型"></a>常用类型</h4><pre><code>数字类型：
AutoField：自增长字段
IntegerField：长度为11的整数
PositiveIntegerField：
SmallIntegerField
PositiveSmallIntegerField
BigIntegerField：
BinaryField：
BooleanField：
NullBooleanField：
DecimalField(max_digits = None, decimal_places = None)
FloatField

字符类型：
CharField：字符串类型，可用max_length指定长度
TextField：text类型
CommaSeparatedIntegerField：用逗号分隔的整数，我擦，这有用

时间类型：
DateField
TimeField：datetime.time，时间
DateTimeField()：datetime类型，包括了日期和时间，需要注意的是Django默认的TIME_ZONE是UTC，其fixture数据(初始化数据)的时候，格式如&quot;2015-04-27T15:01:00Z&quot;，它属于python里面的datetime.datetime类型，可分别用year/month/day等获取时间
unique_for_date属性：比如，如果有一个title字段，其有一个参数unique_for_date = &quot;pub_date&quot;，那么该表就不会出现title和pub_date同时相同的情况，其它的还有unique_for_month,unique_for_year

其它很有用的类型：
EmailField：Email邮箱类型
FileField：文件类型，不过不能设置为primary_key和unique，要使用该字段还有很多需要注意的地方，具体的见官方文档
FilePathField：同上
ImageField
IPAddressField：从1.7开始已经不建议使用了，应该使用下面这个
GenericIPAddressField：
URLField
UUIDField
</code></pre><h3 id="数据库SQL操作"><a href="#数据库SQL操作" class="headerlink" title="数据库SQL操作"></a>数据库SQL操作</h3><p>要使用model，必须先导入它，例如<code>from app.models import Blog</code>，一条记录就是一个model类的实例，要获取其字段值，直接用点号访问即可，例如有Blog对象blog，那么可以直接用blog.userName访问其值。<br>如果想要在执行数据库操作的时候查看数据库的实际的SQL语句，可以这样</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> connection</div><div class="line">print(Blogobjects.filter(name=<span class="string">""</span>).query)	<span class="comment"># 这样可以将SQL语句打印出来</span></div><div class="line"></div><div class="line">connection.queries			<span class="comment"># 会返回一个所有执行过的SQL的列表，并且每条时一个字典，包含了SQL语句以及SQL所执行的时间</span></div></pre></td></tr></table></figure>
<h4 id="查询记录"><a href="#查询记录" class="headerlink" title="查询记录"></a>查询记录</h4><pre><code>Blog.objects.all()   # 获取该表的所有记录，返回的是记录对象组成的列表
Blog.objects.get(pk=1)      # 根据主键获取数据
Blog.objects.get(name=&quot;&quot;)  # 只会找到第一个匹配的数据
Blog.objects.filter(name=&quot;&quot;)# 这个就会找到匹配的多个数据
Blog.objects.filter(name__contains=&quot;&quot;)  # 模糊查找name字段的值，返回列表
Blog.objects.order_by(&quot;字段1&quot;, &quot;字段2&quot;)   # 排序
Blog.objects.all().order_by(&quot;字段&quot;)
Blog.objects.count()     # 返回记录总数
Blog.objects.values(&apos;id&apos;, &apos;name&apos;)  # 相当于select id name from Blog
Blog.objects.values(&apos;name&apos;).distinct()   # distinct在django的mysql引擎中无法对field进行distinct操作，所以需要这样做
Blog.objects.values_list(&apos;id&apos;, flat=True) # 查询该字段的所有值并且返回的是id的列表，而不是包括了名字的字典
Blog.objects.latest(&apos;id&apos;)  # 根据某个字段查找其最后一条记录
Blog.objects.filter(time__gte = &apos;2015-07-23&apos;, time__lte = &apos;2015-07-24&apos;) # 大于等于并且小于等于，不加e表示不能等于
Blog.objects.filter(time__isnull = True)  # 判断某个字段是否为空
Blog.objects.all().exclude(id=7)  # 排除
Blog.objects.filter(&apos;time__year&apos;: &apos;2015&apos;, &apos;time__month&apos;: &apos;08&apos;, &apos;time__day&apos;: &apos;17&apos;)：按年月日查询日期，可仅查询其中某一个条件

# Q查询，可以对关键字参数进行封装，可以使用&amp;,|,~等操作
from django.db.models import Q
Blog.objects.filter( Q(name__startswith=&apos;wang&apos;) | ~Q(name__startswith=&apos;hao&apos;) )
Blog.objects.get( Q(name__startswith=&apos;wang&apos;), Q(name__startswith=&apos;hao&apos;)) # 逗号就可以直接表示and了


        print(People.objects.filter(
        (Q(birth_lunar__month=old_month) &amp; Q(birth_lunar__day=old_day)) |
        (Q(birth_new__month=new_month) &amp; Q(birth_new__day=new_day))
    ).query)
</code></pre><h4 id="新增记录"><a href="#新增记录" class="headerlink" title="新增记录"></a>新增记录</h4><pre><code>post = Blog(userName=&quot;wanghao&quot;, userId=12)
post.save()

# 批量插入/新增
posts = []
for i in title:
    posts.append(Posts(title = title))
Posts.objects.bulk_create(posts)
</code></pre><h4 id="更新记录"><a href="#更新记录" class="headerlink" title="更新记录"></a>更新记录</h4><pre><code>post = Blog.objects.filter(id=1).update(userName=&quot;new&quot;) #1.7之前更新单条记录如果要用字典的话就只能这样了
Blog.objects.all().update(userName=&quot;new&quot;)  # 还可以批量更新
obj, created = Posts.objects.update_or_create(pk = 3, title=&apos;wang&apos;, defaults = updated_values)   # 1.7之后可以用这种方法来更新或者创建一个，如果没找到对象，那么就新建，新建或者更新的字典是defaults的值，返回值中，obj表示该对象，created是一个布尔值
get_or_create(title=&apos;wang&apos;, defaults=\{\})：获取或者新建
</code></pre><h4 id="删除记录"><a href="#删除记录" class="headerlink" title="删除记录"></a>删除记录</h4><pre><code>Blog.objects.get(userName=&quot;xiao&quot;).delete()
Blog.objects.all().delete()
Blog.author.through.objects.filter(author = author.id).delete()  # 删除多对多关系，仅仅是删除关系，而不是删除对象
</code></pre><h3 id="数据约束"><a href="#数据约束" class="headerlink" title="数据约束"></a>数据约束</h3><h4 id="ForeignKey"><a href="#ForeignKey" class="headerlink" title="ForeignKey"></a>ForeignKey</h4><p>例如：</p>
<pre><code># modles.py
class System(models.Model):
    name = models.CharField(max_length = 20)
        **ForeignKey**，实例如下：

class Server(models.Model):
    ip = models.GenericIPAddressField(default = &apos;127.0.0.1&apos;)
    system = models.ForeignKey(System)

# views.py里面这样子使用
server = Server.objects.get(id=1)
server_system = server.system.name # 这样就可以获取到那个name了
</code></pre><h4 id="OneToMany-hasMany"><a href="#OneToMany-hasMany" class="headerlink" title="OneToMany(hasMany)"></a>OneToMany(hasMany)</h4><p>一对多关系，同样使用ForeighKey实现，例如</p>
<pre><code># 在models.py中定义
class Posts(models.Model):
    title = models.CharField(&apos;标题&apos;, max_length = 50)

class Comments(models.Model):
    post = models.ForeignKey(Posts, related_name = &apos;comments_set&apos;)

# 在views.py中这么用
post = Posts.objects.get(pk = 1)    # 获取一篇文章
comments = post.comments_set.all()  # 获取该文章的所有评论，是一个列表
</code></pre><h4 id="ManyToManyField"><a href="#ManyToManyField" class="headerlink" title="ManyToManyField"></a>ManyToManyField</h4><p>多对多关系，有一种特殊情况，如果需要对这种关系添加额外的字段，可以使用through，添加额外的表来表示，例如，用户一张表，被使用的物品一张表，用户与物品是多对多的关系，但是有时候我们需要记录下用户使用该物品的一些其他属性，比如使用了多少次什么的，这时候就需要给这个多对多关系添加额外的字段来表示，那就需要添加额外的表了，示例如下：</p>
<pre><code>class User(models.Model):
    username = models.CharField(max_length = 20)
    goods = models.ManyToManyField(&apos;物品&apos;, &apos;Goods&apos;, through=&apos;user_goods&apos;)

class Goods(models.Model):
    goodsname = models.CharField(max_length = 20)

class user_goods(models.Model):
    user = models.ForeignKey(User)
    goods = models.ForeignKey(Goods)
    clicks = models.IntegerField(&apos;点击量&apos;, default=0)
</code></pre><h4 id="OneToOneField"><a href="#OneToOneField" class="headerlink" title="OneToOneField"></a>OneToOneField</h4><p>必须是一对一，而不是多对一或一对多</p>
<h3 id="分页"><a href="#分页" class="headerlink" title="分页"></a>分页</h3><p>Django使用内建的paginator模块进行分页的操作，十分方便。使用方法见例子：</p>
<pre><code>from django.core.paginator import Paginator, EmptyPage, PageNotAnInteger  # 导入模块
def listing(request):
    contact_list = Contacts.objects.all()   # 获取所有model对象
    paginator = Paginator(contact_list, 25) # 第二个参数是每页显示的数量
    page = request.GET.get(&apos;page&apos;)          # 获取URL参数中的page number
    try:
        contacts = paginator.page(page)
    except PageNotAnInteger:                # 若不是整数则跳到第一页
        contacts = paginator.page(1)
    except EmptyPage:                       # 若超过了则最后一页
        contacts = paginator.page(paginator.num_pages)

    return render_to_response(&apos;list.html&apos;, {&quot;contacts&quot;: contacts})
</code></pre><p>虽然contacts是一个Page对象，但是在模板中仍然可以使用for循环对其进行遍历，它其实是一个对象所组成的list。下面是分页按钮html模板例子：</p>
<pre><code>&lt;nav&gt;
    &lt;ul class=&quot;pagination&quot;&gt;
        &lt;li class=&quot;{% if current_page == 1 %}disabled{% endif %}"><a href="#" aria-label="Previous"><span aria-hidden="true"></span></a>
			{% for index in page_index %}
				{% if index == current_page %}class="active"{% endif %}&lt;a href=&quot;#&quot;;{{ index }}&lt;span class=&quot;sr-only&quot;(current)/&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;
            {% endfor %}
        &lt;li class=&quot;{% if current_page == num_pages %}disabled{% endif %}<a href="#" aria-label="Previous"><span aria-hidden="true"></span></a>
		
	
### 初始化数据
为了方便迁移,让别人使用你的APP,有时候需要为APP里面的表提供demo数据,这时候就需要预先填充一些数据.这里使用Django的fixtures方式填充(Django提供两种[填充方式](https://docs.djangoproject.com/en/1.8/howto/initial-data/))。使用JSON格式，我们可以首先使用`manage.py dumpdata data.json`方式到处原来数据库中内容看看该格式，类似如下：

	[
		{
			"fields": {
			"userName": "小豪",
			"title": "第一篇文章",
			"userId": 1,
			"update": "2015-04-27T15:01:03Z",
			"datetime": "2015-04-27T15:01:00Z",
			"content": "这是文章的内容"
			},
			"model": "digital.blog",
			"pk": 1
		},
		{
			"fields": {
				"userName": "笑总",
				"title": "第二篇文章",
				"userId": 2,
				"update": "2015-04-28T15:01:03Z",
				"datetime": "2015-04-28T15:01:03Z",
				"content": "这是文章的内容吗"
			},
			"model": "digital.blog",
			"pk": 2
		},
	]
我们可以自己按照这个模板新建填充数据，其中pk指的是主键值。当建立好json文件过后，执行`python manage.py loaddata data.json`即可导入数据。

## Template: Django模板
和所有的MVC框架一样，模板功能是必须有的。这里介绍一下Django模板的使用方法。

### 模板定义
为了方便管理，最好在app的目录下新建templates文件夹用于存放模板文件，然后在project的配置文件settings.py中指明模板文件夹的位置:

	TEMPLATES['DIRS']这个变量中添加即可，比如
	'DIRS': [
		os.path.join(BASE_DIR, 'dashboard/templates').replace('\\', '/'),
	]

这样，在该app的view中就可以这样使用templates下的test.html模板文件了。例如：

	def test(request):
		return render(request, 'test.html')
### 参数传递
要向模板中传递参数，可以给render添加第三个参数，该参数其实是一个字典，在模板中可以直接使用该字典的key，例如：
​	
	return render(request, 'test.html', {'name1': value1, 'name2': value2} )
这样，在模板文件test.html中就可以直接`{{ name1 }}`来使用`name1`的值了。

### 继承与引用
模板方便之处就是可以使用继承将代码分块并且将重复的地方都写在一个base.html里。当要实现继承的时候在html文件第一行写上`{% extends 'base.html' %}`，然后分别实现其区块即可。 在base模板中一般这样定义区块：

	{% block 块名 %}
		这里直接写html代码
	{% endblock %}

如果子模块没有定义某个block的内容，那么就采用父模板的，如果需要使用父模板的内容可以用`{{ block.super }}`  
模板也可以通过引用其它模板的代码，例如，在要引用的地方使用：

	{% include 'nav.html' %}
	{% include 'includes/nav.html' %}

### 静态文件css、js、img
静态文件一般当然是要存放在自己的app里面，这时候，就应该指定静态文件的路径，在project的配置文件settings.py中添加如下配置：
​	
	STATICFILES_DIRS = (
		os.path.join(BASE_DIR, 'static'),
		'f:/project/app/static', # 无论是windows还是linux都要用左斜杠哟
	)
在模板中使用静态文件就这样：
​	
	{% load staticfiles %}
	<link href="{% static 'css/style.css' %}" rel="stylesheet">

### 模板标签
Django内置了一些比较常用又实用的标签：

<!--￼7-->

### 过滤器
可以直接格式化输出，是一种最便捷的转换变量输出格式的方式。

	{{ today | data: "F j, Y" }}
这里可以将today这个变量直接按照规定格式输出。  
这里是常见的过滤器：

	add：将该数字加上一个数字，例如 `{{ value|add:"2" }}`，如果原来的值为4，那么新的值就为6，不仅进可以作用与int，还能作用与列表，将列表中每个值都加
	addslashes：添加反斜杠到需要转义的地方前
	capfirst：第一个字母大写
	center：在字符串前后加空格，并让该字符串位于中间，例如 `{{ value|center: "5" }}`，那么输出时前后都是5个空格
	cut：去除字符串中的指定字符，例如`{{ value|cut:" " }}`，表示去除字符串中的所有空格
	date：按指定的格式字符串参数格式化date或者datetime对象，参数太多了，看[文档](https://docs.djangoproject.com/en/1.8/ref/templates/builtins/)
	default：参数没赋值的情况下给定默认值，例如`{{ value|default: "nothing" }}`
	default_if_none：如果它是none就给定默认值
	dictsort：将一个字典组成的列表排序，例如`{{ value|dictsort:"name" }}`意思是将value这个列表里面的字典按照字典里的name的顺序来排序
	dictsortreversed：与上面顺序相反
	divisibleby：是否能被整除，返回True/False，例如`{{ value|divisibleby:"3" }}`
	filesizeformat：-h方式输出文件的大小，例如`{{ value|filesizeformat}}`，如果value=123456789，那么输出将是117.7MB
	first：返回列表的第一个值
	floatformat：设置浮点数的显示形式
	get_digit：获取一个整数的倒数第几个数字，例如`{{ value|get_digit:"2" }}`,那么123456789的值为8
	join：将一个列表的值添加一个分隔符并以字符串形式输出，例如`{{ value|join:"//"}}`那么['a', 'b', 'c']输出将是"a//b//c"
	last：返回列表的最后yield值
	length：返回变量的长度，也可以在if语句里面使用，例如 {% if messages|length >= 100%} ...{% endif %}
length_is：判断一长度是否是某个值，例如`{{ vlaue|length_is:"4" }}`如果value长度是4那么就返回True
linebreaks：替换换行符，例如如果value的值是Joel\nis a slug，那么输出就是&lt;&lt;p&gt;Joel&lt;br /&gt; is a slug&lt;/p&gt;
linenumbers：在输出的tex前加上标号
ljust：在字符串后面加上指定长度的宽度，例如`{{ value|ljust:"10" }}`
make_list：将整型或字符串转换为单个单个的列表元素组成一个列表
random：在列表里面随机选取一个元素
lower：转换为小写
rjust：在字符串前面加上指定长度的宽度
slice：列表分片，例如`{{ some_list|slice:":2"}}`就表示前面两个元素妈
slugify：
stringformat：
striptags：取出HTML中的tag，只去内容
time：同date
timesince：
timeuntil
title：将一个字符串转换为title的形式，即一般的第一个字母大写那种标题
truncatewords: &quot;30&quot;：表示只显示前面30个字符
truncatechars_html：
truncatewords：显示前面多少个字符，单位是词，而不是字符
truncatewords_html：
unordered_list：
upper：转换为大写
urlencode：将url进行编码，例如&quot;http://www.example.org/foo?a=b&amp;c=d&quot;被编码为“http\%3A//www.example.org/foo\%3Fa\%3Db\%26c\%3Dd”
urlize：
urlizetrunc：
wordcount：统计字符串中单词的数量
wordwrap：指定特定的长度来分隔字符串
yesno：
</code></pre><h3 id="其他标签"><a href="#其他标签" class="headerlink" title="其他标签"></a>其他标签</h3><pre><code># autoescape标签
{% autoescape on %}       # 去掉自动转义
	{{ body }}
	{% endautoescape %}

# cycle标签：每次使用该标签，标签中的值就会变化，比如下面这个，第一次该值为row1，第二次则为row2，第三次又变为了1，感觉可以用于循环里面的奇偶什么的
{% for o in some_list %}
	<tr class="{% cycle 'row1' 'row'2 %}
	...
	</tr>
	{% endfor %}

# now 标签，直接将当前时间按指定格式输出：
{% now " js="" f="" y="" h:i"="" %}="" #="" spaceless标签：移出html="" tags之间的空白="" {%="" spaceless="" <p="">
	...
	<p></p>
	{% endspaceless %}

# verbatim：停止模版引擎，一般用于在模板里面写Javascript什么的
{% verbatim %}
	...
	{% endverbatim %}

# with标签：和语法里面的with类似
{% with total=business.employees.count %}
	{{ total }} employee{{ total|pluralize }}
	{% endwith %}
</tr></code></pre><h2 id="用户认证系统"><a href="#用户认证系统" class="headerlink" title="用户认证系统"></a>用户认证系统</h2><p>Django项目默认添加了用户认证系统的，可以通过</p>
<pre><code>python manage.py makemigrations
python manage.py migrate
</code></pre><p>将认证系统的数据表添加到数据库中去.</p>
<h3 id="创建用户"><a href="#创建用户" class="headerlink" title="创建用户"></a>创建用户</h3><pre><code>from django.contrib.auth.models import User
user = User.objects.create_user(&apos;john&apos;, &apos;lennon@thebeatles.com&apos;, &apos;johnpassword&apos;)
user.save()
</code></pre><h3 id="创建超级用户"><a href="#创建超级用户" class="headerlink" title="创建超级用户"></a>创建超级用户</h3><pre><code>$ python manage.py createsuperuser --email=896499825@qq.com --username=wanghao
Password:
Password (again):
Superuser created successfully.
</code></pre><h3 id="验证用户登录"><a href="#验证用户登录" class="headerlink" title="验证用户登录"></a>验证用户登录</h3><p>需要注意的是，为了不与login冲突，views最好不要写成login</p>
<pre><code>from django.contrib.auth import authenticate, login
user = authenticate(username=&apos;hao&apos;, password=&apos;test&apos;)
if user is not None:
    if user.is_activate:
        print(&apos;用户验证并登录成功&apos;)
        login(request, user)     # 这才是登录，才会写入session
    else:
        print(&apos;密码正确，但是用户无法登录&apos;)
    return HttpResponse(&apos;居然有这个用户&apos;)
else:
    return HttpResponse(&apos;用户不存在&apos;)
</code></pre><p>若登录成功，则会返回一个user对象，否则返回None，但是Django默认的认证系统只能认证username和password，却不能认证其它的字段，比如<br>email字段，看似非常糟糕，但是Django却提供了十分方便的功能来扩展默认的验证组件。查看文档：<a href="https://docs.djangoproject.com/en/1.8/topics/auth/customizing/" target="_blank" rel="external">Customizing authentication<br>in Django</a></p>
<p>如果要验证用户名或email可以这样做：首先，在myapp目录下新建一个文件，姑且取名叫<code>backends.py</code>，其内容如下：</p>
<pre><code>from django.conf import settings
from django.contrib.auth.models import User

class EmailOrUsernameModelBackend(object):
    def authenticate(self, username=None, password=None):
        if &apos;@&apos; in username:
            kwargs = {&apos;email&apos;: username}
        else:
            kwargs = {&apos;username&apos;: username}
        try:
            user = User.objects.get(**kwargs)
            if user.check_password(password):
                return user
            except User.DoesNotExist:
                return None

def get_user(self, user_id):
    try:
        return User.objects.get(pk=user_id)
    except User.DoesNotExist:
        return None&lt;/pre&gt;
</code></pre><p>然后在settings.py中添加如下代码：</p>
<pre><code># 该字段指定了默认的验证后台，从上到下顺序验证，如果上面验证不成功就验证下面的
AUTHENTICATION_BACKENDS = (
    &apos;myapp.backends.EmailOrUsernameModelBackend&apos;,   # 自定义的认证后台
    &apos;django.contrib.auth.backends.ModelBackend&apos;,    # 这是默认的认证后台
)
</code></pre><p>这样，就可以依然使用刚才的代码对用户登录进行验证了。</p>
<h3 id="退出登录"><a href="#退出登录" class="headerlink" title="退出登录"></a>退出登录</h3><pre><code>from django.contrib.auth import logout

def logout_view(request):
    logout(request)
</code></pre><h3 id="限制登录用户访问路由"><a href="#限制登录用户访问路由" class="headerlink" title="限制登录用户访问路由"></a>限制登录用户访问路由</h3><p>某些路由只能登录用户才能访问，那么只需要添加这个装饰器：</p>
<pre><code>from django.contrib.auth.decorators import login_required

@login_required
def my_view(request):
    ......
</code></pre><p> 未登录的用户将会重定向到<code>settings.LOGIN_URL</code>去       </p>
<pre><code>          # TroubleShooting

          1.for循环获取index：



              \{\% for item in item_list \%\}
                  \{\{ forloop.counter \}\}  \{\# 从1开始的序号 \#\}
                  \{\{ forloop.counter0 \}\} \{\# 从0开始的序号 \#\}
              \{\% endfor \%\}

          2.直接将html生成成变量：



              from django.template import Context, Template
              t = Template(&quot;My name is \{\{ my_name \}\}.&quot;)
              c = Context(\{&quot;my_name&quot;: &quot;Adrian&quot;\})
              output = t.render(c)
              return HttpResponse(output)  # 还能直接将HTML返回成页面

          3.使模板对HTML字符串进行转义 如果有一个HTML格式字符串，比如&apos;&lt;strong&gt;haofly&lt;/strong&gt;&apos;，那么当把它作为一个变量传递到htm
          l中区的时候，会原封不动的保留，很明显我们有时候并不想这样，而是真的想将&apos;haofly&apos;进行加粗，可以这样做：



              \{\{ variable name | safe\}\}







## TroubleShooting：

  * 自定义表名：在class model名()里面指明meta类，例如：

        class Server(models.Model):
        object_id = models.AutoField(primary_key = True)




        class Meta:
        db_table = &apos;自定义表名&apos;


  * migrate的时候出现类似这样的错误：

        django.db.utils.OperationalError: (1091, &quot;Can&apos;t DROP &apos;os_id_id&apos;; check that column/key exists&quot;)

原因是你在试图创建一个已经存在的column或者删除一个已经删除的column，这时候需要在migrate后面添加一个参数忽略这些：


        python manage.py migrate --fake


  * 通过字符串来获取model类，django的apps模块包含了所有注册的app的配置以及model信息([Application文档](https://docs.djangoproject.com/en/1.8/ref/applications/))

        from django.apps import apps




    print(apps.get_model(&apos;myapp&apos;, &apos;Classify_cpu&apos;))

  * 多个键联合unique，增加一个Meta即可：

        class Meta:
        db_table = &apos;posts&apos;
        unique_together = (&apos;product_1&apos;, &apos;product_2&apos;)

  * 如果要与默认的auth_user表做外键，那么可以这样做：

        from django.db import models
    from django.contrib.auth.models import User




    class UserInfo(models.Model):
        user_id = models.ForeignKey(User)


  * 如果通过查询语句始终查询不到数据并且数据库的设置也是正确的，那么可能是model里面定义的字段名与数据库实际的字段不一致，这样既不会跑错，也不会提示，就说查找结果为空，很难debug
  * 根据对象获取model的名称：

        Blog.**class**.**name** # 会输出&apos;Blog&apos;
</code></pre><h2 id="django-crontab插件"><a href="#django-crontab插件" class="headerlink" title="django-crontab插件"></a>django-crontab插件</h2><p>Django下的定时任务插件，依赖于Linux的cron服务。</p>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p><code>pip install django-crontab</code>进行安装，然后在django的配置文件中添加一个APP</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">INSTALLED_APPS = (</div><div class="line">	<span class="string">'django_crontab'</span>,</div><div class="line">    ...</div><div class="line">)</div></pre></td></tr></table></figure>
<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><p>编写完定时任务逻辑以后，需要在配置文件中添加上，例如</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">CRONJOBS = [</div><div class="line">    (<span class="string">'*/5 * * * *'</span>, <span class="string">'myapp.cron.my_scheduled_job'</span>)</div><div class="line">    (<span class="string">'*/5 * * * *'</span>, <span class="string">'myapp.cron.other_scheduled_job'</span>, [<span class="string">'arg1'</span>, <span class="string">'arg2'</span>], &#123;<span class="string">'verbose'</span>: <span class="number">0</span>&#125;),</div><div class="line">    (<span class="string">'0 4 * * *'</span>, <span class="string">'django.core.management.call_command'</span>, [<span class="string">'clearsessions'</span>]),</div><div class="line">]</div></pre></td></tr></table></figure>
<p>最后，将其添加到系统<code>cron</code>服务中去</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">python manage.py crontab add	# 将当前配置文件中的定时任务添加到cron中去，当add以后，会在crontab -e里面出现类似这样的一条记录</div><div class="line"># */5 * * * * /usr/local/bin/python /usr/src/app/manage.py crontab run e0418752956c4dd997212171486888ff # django-cronjobs for admin</div><div class="line"># 前面是命令部分，后面是根据定义的函数计算出来的hash值，最后面则是自带的注释</div><div class="line">python manage.py crontab show	# 列出当前已经添加到cron中的定时任务</div><div class="line">python manage.py crontab remove	# 移除所有的定时任务</div></pre></td></tr></table></figure>
<h2 id="TroubleShooting"><a href="#TroubleShooting" class="headerlink" title="TroubleShooting"></a>TroubleShooting</h2><ul>
<li><p><strong>如果想要直接执行<em>./manage.py</em>来启动runserver</strong>，那么可以修改manage.py文件如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="keyword">import</span> os</div><div class="line"><span class="keyword">import</span> sys</div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</div><div class="line">    os.environ.setdefault(<span class="string">"DJANGO_SETTINGS_MODULE"</span>, <span class="string">"frontend.settings"</span>)</div><div class="line">    <span class="keyword">from</span> django.core.management <span class="keyword">import</span> execute_from_command_line</div><div class="line">    sys.argv = [<span class="string">'manage.py'</span>, <span class="string">'runserver'</span>, <span class="string">'0.0.0.0:8000'</span>]</div><div class="line">	execute_from_command_line(sys.argv)</div></pre></td></tr></table></figure>
</li>
<li><p><strong>保存用户上传的图片或文件</strong>：使用Django自带的文件存储系统：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> django.core.files.storage <span class="keyword">import</span> FileSystemStorage</div><div class="line">storage = FileSystemStorage(</div><div class="line">                    location = <span class="string">'/var/www/site/upfiles'</span>,</div><div class="line">                    base_url = <span class="string">'/upfiles'</span></div><div class="line">                  )</div><div class="line">content = request.FILES[<span class="string">'the_file'</span>]</div><div class="line">name = storage.save(<span class="keyword">None</span>, content)</div><div class="line">url = storage.url(name)</div></pre></td></tr></table></figure>
<p>​</p>
</li>
</ul>
<p>##signal<br><a href="http://www.weiguda.com/blog/38/" target="_blank" rel="external">参考</a>django中signal与操作系统的signal是完全不一样的.Django的signal是一种同步的消息队列.通常在以下情况进行使用：</p>
<ul>
<li>signal的receiver需要同时修改对多个model时</li>
<li>将多个app的相同signal引到同一receiver中处理时</li>
<li>在某一model保存之后将cache清除时</li>
<li>无法使用其他方法, 但需要一个被调函数来处理某些问题时</li>
</ul>
<pre><code>---
title: &quot;Django forms表单&quot;
date: 2015-06-12 22:08:26
categories: django
---
Django有一个十分重要的特色功能就是将表单功能独立了出来，使得表单构造和验证更加灵活可控。其实际使用方法如下：

首先，在app目录下新建`forms.py`文件，内容如下：



    from django import forms




    class LoginForm(forms.Form):
        username = forms.CharField(label=&apos;用户名&apos;, max_length = 50)
        password = forms.CharField(label=&apos;密码&apos;, max_length = 50)

然后，在views.py有如下代码



    from .forms import LoginForm  # 引入该表单
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">(request)</span>:</span></div><div class="line">        <span class="keyword">if</span> request.method == <span class="string">'POST'</span>:</div><div class="line">            form = LoginForm(request.POST)</div><div class="line">            <span class="keyword">if</span> form.is_valid():     <span class="comment"># 判断合法性</span></div><div class="line">                <span class="keyword">return</span> HttpResponse(<span class="string">'数据合法'</span>)</div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            form = LoginForm()</div><div class="line">            <span class="keyword">return</span> render(request, <span class="string">'login.html'</span>, \&#123;<span class="string">'form'</span>: form\&#125;</div><div class="line"></div><div class="line">最后，在templates里面这样使用：</div></pre></td></tr></table></figure>
<pre><code>    &lt;form class=&quot;form-horizontal&quot; method=&quot;post&quot;}
        {% csrf_token %}
        {{ form }}
        &lt;p class=&quot;form-actions&quot; style=&quot;margin: 0&quot;&gt;
            &lt;input type=&quot;submit&quot; value=&quot;登录&quot; class=&quot;btn btn-primary&quot;&gt;
        &lt;a href=&quot;#&quot;&gt;&lt;input type=&quot;button&quot; value=&quot;注册&quot; class=&quot;btn btn-success&quot;&gt;&lt;/a&gt;
        &lt;a href=&quot;#&quot;&gt;忘记密码&lt;/a&gt;
        &lt;/p&gt;
    &lt;/form&gt;

## 获取表单的值



    if request.method == &apos;POST&apos;:
        form = Login(request.POST)
        if form.is_valid():
            username = form.cleaned_data[&apos;username&apos;]   # 如果需要单独获取表单的值用这个方法

        form = ProfileLoginForm(request.POST)

        warning = &quot;&quot;
        if form.is_valid():
            username = form.cleaned_data[&apos;username&apos;]
            password = form.cleaned_data[&apos;password&apos;]&lt;/pre&gt;


## django-bootstrap3的使用

默认的form表单没有任何的css样式，如果要让默认的表单拥有bootstrap样式，那么可以使用django-
bootstrap3这个库，不仅提供了表单的bootstrap样式，而且还提供了bootstrap其它组件的样式，文档见&lt;http://django-
bootstrap3.readthedocs.org/en/latest/templatetags.html#bootstrap-form&gt;

## TroubleShooting

1.给表单添加样式，例如：



    username = forms.CharField(label=&apos;用户名&apos;, max_length = 50, widget = forms.TextInput(attrs=\{&apos;class&apos;: &apos;one&apos;\}))


2.Form表单可以不整个使用，而使用其中单个的field，比如form.username，这样就可以很方便地为表单中的每个field设置不同的css样式了
</code></pre><h2 id="Django-Model"><a href="#Django-Model" class="headerlink" title="Django Model"></a>Django Model</h2><pre><code>官方文档：[Request and response
objects](https://docs.djangoproject.com/en/1.8/ref/request-response/)
当请求一个页面的时候，Django会建立一个HttpRequest对象，它包含了请求的一些数据，该对象就是每个views函数里面的第一个参数request.
需要注意的是，Django的HTTP动词(get/post等)在url上没有区分，只需要在view里面进行判断即可。

例子：



    if request.method == &apos;GET&apos;:    # GET请求
        do_something()
    elif request.method == &apos;POST&apos;: # POST请求
        request.POST[&apos;变量名&apos;]   # 获取请求参数

### JsonResponse

如果要返回JSON数据(常见于Ajax请求)，可以在view里面这样构造json数据



    from django.http import JsonResponse




    reponse = JsonResponse(字典)  # JsonResponse(data, encoder=编码方式默认是utf-8
    response = JsonResponse([1, 2, 3], safe = False)   # 如果要返回一个单纯的列表数据而不是字典类型的数据，就这样
    return response

### HttpResponse

直接响应字符串或者html



    response = HttpResponse(&apos;响应一个字符串&apos;)
    response.write(&apos;给那个字符串再添加东西&apos;)




    # 如果响应一个字典类型




    response = HttpResponse()
    response[&apos;Age&apos;] = 120




    # 常用构建方法




    HttpResponse(&apos;字符串&apos;, content_type=&quot;text/plain&quot;) # 指定content_type

常用属性：



    HttpRequest.method   # 请求种类
    HttpRequest.GET      # 获取所有的GET参数(字典)
    HttpRequest.POST     # 获取POST的参数(字典)
    HttpRequest.scheme   # 表示请求的模式，是http还是https
    HttpRequest.cookies  # 包含了所有的cookie信息
    HttpRequest.session  # session信息
    HttpRequest.FILES    # 包含了上传的文件
    HttpRequest.meta     # 包含了http请求的各种headers
    HttpRequest.user     # 当前的登录的用户，配合着auth使用

常用方法：



    get_host()           #不解释了吧
    get_full_path()      # 获取路径，不包含域名
    build_absolute_uri() # 获取完整路径
    is_secure()          # 如果是https返回true，否则false
    is_ajax()            # 是否是ajax请求

### StreamingHttpResponse

媒体数据等

### FileResponse

文件数据等

# TroubleShooting

1.设置GET请求的默认值：



    date = request.GET.get(&apos;value&apos;, &apos;2&apos;)

2.返回状态码：



    return JsonResponse(error, status = 422)

3.将上传的文件写入到本地，使用chunks()生成器可以将文件一块一块地写入，而不使用read方法，这样可以防止大文件写入失败



    destination = open(&apos;temp/&apos; + filename, &apos;wb+&apos;)
    for chunk in file.chunks():
        destination.write(chunk)
    destination.close()

4.获取用户IP地址：



    ip = request.META.get(&apos;REMOTE_ADDR&apos;)

5.退出登录功能：直接添加一个URL：



    (r&apos;^logout$&apos;, &apos;django.contrib.auth.views.logout&apos;,\{&apos;next_page&apos;: &apos;login&apos;\}, name = &apos;logout&apos;)


6.通过Ajax发送多维数组，原生不支持的，不过可以在前端以及后端同时传输JSON格式的


    # 在前端使用Ajax进行传输
    $.ajax(
        url: &apos;test&apos;,
        datatype: &apos;json&apos;,
        data: JSON.stringify(\{
            &apos;one&apos;: 123,
            &apos;two&apos;: {
                &apos;two_one&apos;: &apos;test&apos;
            \}
        \})
    )

    # 在后端使用JSON进行解析
    def test(request):
        data = json.loads(request.POST)
     或者前端不变，后端用这个来接收request.POST.getlist(&apos;taskIdList[]&apos;)
</code></pre><p>​                          </p>
<pre><code># TroubleShooting

  1. POST请求403错误：

        Forbidden (403)
    CSRF verification failed. Request aborted.

原因是Django默认给所有的post请求都添加了CSRF验证中间件，要想对某个路由(url)忽略，可以使用csrf_exempt，关于CSRF的其它一些装
饰器见&lt;https://docs.djangoproject.com/en/1.7/ref/contrib/csrf/&gt;


        from django.views.decorators.csrf import csrf_exempt




    @csrf_exempt
    def webhook(request):
        pass

  2. 统一APP的路由 Django是以app的形式定义一个应用的，所以为了保持应用的隔离性，就需要将应用的url分离开来，相当于一个前缀，例如，先在setting.py里面添加APP

        INSTALLED_APPS = (
        &apos;django.contrib.admin&apos;,
        &apos;django.contrib.auth&apos;,
        &apos;django.contrib.contenttypes&apos;,
        &apos;django.contrib.sessions&apos;,
        &apos;django.contrib.messages&apos;,
        &apos;django.contrib.staticfiles&apos;,
        &apos;haofly&apos;,                # 需要添加的APP名称
    )

然后在工程的urls.py文件里定义APP的主url：


        from django.conf.urls import include, url




    urlpatterns = [
        url(r&apos;^前缀/&apos;, include(&apos;haofly.urls&apos;)), # haofly下的urls.py
    ]


然后再在haofly这个APP下建立一个独立的urls.py：


        from django.conf.urls import include, url




    urlpatterns = [
        url(r&apos;^test/&apos;, &apos;haofly.views.test&apos;),
    ]

  3. 在设置路由参数的时候出现如下错误：

        TypeError at /operation/servers/13/commands
    commands() got an unexpected keyword argument &apos;id&apos;

原因是没有将该参数加入views的定义中去，需要将id加入该views的第二个参数

  4. 跳转功能：

        return HttpResponseRedirect(&apos;/&apos;)
</code></pre>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="https://haofly.net/weibo/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="haofly">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/uploads/avatar.png">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="豪翔天下">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="豪翔天下" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/weibo/" itemprop="url">
                  感谢微博——1000条微博纪念
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2015-03-09T14:56:35+08:00">
                2015-03-09
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/边走边想/" itemprop="url" rel="index">
                    <span itemprop="name">边走边想</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/weibo/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="weibo/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="http://7xnc86.com1.z0.glb.clouddn.com/weibo_0.png" alt="">  </p>
<p>2013年1月7日注册微博至今已经发了1000条微博了。微博带给了我太多的改变，必须在这里感谢一下。</p>
<p>我承认，最先申请微博是因为某苍姓明星，第一个关注的是她，第二个关注的就是创新工场李开复。这两年，社会上发生了太多的事情，开心的不开心的，深沉的悲哀的，都已成<br>往事，但感谢微博，这些，我都没有错过。</p>
<p>在我眼里，微信和QQ更多的是熟人的圈子，而微博则更多是围绕着名人或者一个自己感兴趣的圈子。我关注的600人里，IT圈子的人就有300+。有了微博，我不像以前<br>那样在大学里按着学校的计划一步一步学，而是学得更有激情，了解到太多学校里可能连老师都不知道的东西。通过微博，我可以了解到在大城市里(我说的是互联网意识高的那<br>些城市)的程序员最近都在关注着什么，现在主流的技术是什么，虽然大多数我并不会去接触，但至少我要知道有这些东西，身处“互联网的浪潮”，如果连周围的东西都看不清<br>，又怎么能在浪潮之巅尽情弄潮呢！</p>
<p>微博有时也会让人迷失，无聊的时候一遍一遍的刷着，很多人就这样沉迷其中。我不排斥碎片化的消息，但既然是碎片化的消息为何不用碎片化的时间去对待它，而不是让碎片化<br>的消息来将我们原本的时间碎片化。</p>
<p>对于微博，现在有很多人唱衰，我不置可否。确实，由于言论审核以及对某些人的打击让微博少了很多的自由，我认为在打击谣言方面，确实是需要Z·F来管理，但是他们在做<br>这些事情的时候做得太不明不白了，很多公众根本就不知道它到底做了些什么，这，我也只能呵呵了。另外，微信的兴起，也让微博的地位颤抖了一下，但是我认为微信和微博本<br>身并不冲突，侧重点不同，谁都不可能完全取代谁。不过还好，目前看来确实看不到一种可以彻底颠覆微博或者微信模式的社交平台诞生，至少，国内没有。</p>
<p>总之，感谢微博！</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="https://haofly.net/hulianwangshidai/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="haofly">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/uploads/avatar.png">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="豪翔天下">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="豪翔天下" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/hulianwangshidai/" itemprop="url">
                  《互联网时代》观后感
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2015-03-06T20:23:55+08:00">
                2015-03-06
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/韦编三绝/" itemprop="url" rel="index">
                    <span itemprop="name">韦编三绝</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/hulianwangshidai/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="hulianwangshidai/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>说实话，这样一部片子，很不想跟它写观后感的，但由于辅导员布置的寒假任务需要有这一项，那我就勉为其难地写一写观感。毕竟，这部片子我很早就开始在微博上听到，并且<br>在8月份首播时也是天天晚上守着电视观看的。</p>
<p>首先，抛开其他的，从片子本身来说，这种大型纪录片还是非常令人震撼的，与浪潮之巅一样，能深深地让人体会到身处互联网时代的我们是有多么地幸运。全片分为十集：时代<br>、浪潮、能量、再构、崛起、迁徙、控制、忧虑、世界、眺望，向我们全面展示了信息时代的发展过程以及其当前的影响力。</p>
<p>我是一个90后，电脑系统从Windows Xp一直用到Windows 10，从老式的闪屏电脑到最新的高清平板电脑，从MTK国产手机到最新的MIUI手机，我统<br>统都经历过，深刻地体会到技术力量的不断推进给我们人类生活带来的方便和生活方式上带来的改进。我相信互联网正以改变一切的力量，在全球范围(以后也一定会扩展到外太<br>空去)掀起一场影响人类所有层面的深刻边个，人类正站在一个新时代到来的前沿。</p>
<p>纪录片中说，对于互联网，人类未知的远远大于已知的，但我认为，在互联网方面，人类未知的远远小于已知的，但人类未通过互联网创造的远远大于人类所有历史中所已知的。<br>我们不仅要理解互联网，体会互联网，更要使用互联网为未来创造，给人类带来更加深远的影响。</p>
<p>作为一名计算机专业的大学生，我深深地被这些改变所震撼。从各个新兴互联网公司的崛起，比如小米、淘宝、京东等让我们年轻人也看到了希望，互联网行业远没有饱和。微博<br>改变了新闻传播的方式，支付宝改变了金钱传播的方式，Coursera改变了教育的方式。当互联网产品越来越多地替代了现实生活中的事务时，我们就进入了互联网时代。<br>目前，内陆人们的互联网意识完全不及沿海地区的人们，可以预见，今后的互联网不仅会更多地渗透入我们的日常生活，还会渗透到各个地区，各个行业，实现真正的公平。</p>
<p>最后就说说我对这部片不满意的地方了，每次看到CCAV那欲说还休的嘴脸我也是醉了。片中多次出现长城这个镜头，让人难免联想到GFVV这个众所周知但又没人敢承认的<br>东西。据悉，全球仅有四个国家屏蔽了facebook、twitter等世界最大的几个社交网站，包括朝鲜，伊朗，叙利亚和其它国家。这些国家的ZF都深喑控制言论的<br>方法，将言论自由牢牢地控制在自己手上。互联网发展到今天，如果还要拿国情来当借口，那么总有一天这些国家会因为闭关锁国而没落。还记得中国的第一封跨洋电子邮件的内<br>容：Across the Great Wall we can reach every corner in thee world（越过长城，走向世界），而在某<br>些国家可能一封电子邮件也很难发出去，所以，即使是在互联网这个整个人类历史上最开放的阶段，也依然存在着不公平的现象，改变这种现象，需要的是我们新一代的计算机人<br>。</p>
<p>总之，这部纪录片让我们对互联网有了更加深刻的理解，互联网绝不仅是一场技术上的变革，而是一场社会变革，它势必会引领人类进入一个全新的时代。而我们计算机专业的学<br>生也应该有危机感，抱着终身学习的态度，务必让自己处于浪潮之巅。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/12/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/12/">12</a><span class="page-number current">13</span><a class="page-number" href="/page/14/">14</a><span class="space">&hellip;</span><a class="page-number" href="/page/23/">23</a><a class="extend next" rel="next" href="/page/14/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/uploads/avatar.png"
               alt="haofly" />
          <p class="site-author-name" itemprop="name">haofly</p>
          <p class="site-description motion-element" itemprop="description">豪翔天下的个人博客</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives/">
              <span class="site-state-item-count">228</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              
                <span class="site-state-item-count">17</span>
                <span class="site-state-item-name">分类</span>
              
            </div>
          

          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/haoflynet" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/haoflynet" target="_blank" title="微博">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  微博
                </a>
              </span>
            
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-inline">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              小伙伴们
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="https://www.phodal.com" title="Phodal" target="_blank">Phodal</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://zkzhao.github.io/" title="zkzhao" target="_blank">zkzhao</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://blog.qingguoing.com/" title="倾国倾城的博客" target="_blank">倾国倾城的博客</a>
                </li>
              
            </ul>
          </div>
        

        


      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">haofly</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"haoflynet"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    
    <script src="/lib/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  








  
  

  

  

  

  


</body>
</html>
