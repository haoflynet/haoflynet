<!doctype html>



  


<html class="theme-next pisces use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="/atom.xml" title="豪翔天下" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="豪翔天下的个人博客">
<meta property="og:type" content="website">
<meta property="og:title" content="豪翔天下">
<meta property="og:url" content="https://haofly.net/page/3/index.html">
<meta property="og:site_name" content="豪翔天下">
<meta property="og:description" content="豪翔天下的个人博客">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="豪翔天下">
<meta name="twitter:description" content="豪翔天下的个人博客">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>




  <link rel="canonical" href="https://haofly.net/page/3/"/>

  <title> 豪翔天下 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-47480072-1', 'auto');
  ga('send', 'pageview');
</script>









  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">豪翔天下</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">Change My World by Program</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-favorites">
          <a href="/favorites.html" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-flag"></i> <br />
            
            收藏
          </a>
        </li>
      
        
        <li class="menu-item menu-item-wiki">
          <a href="https://wiki.haofly.net" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-key"></i> <br />
            
            wiki
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/design-pattern/" itemprop="url">
                  [转]23种设计模式
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-12-11T05:55:35+08:00" content="2015-12-11">
              2015-12-11
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/编程之路/" itemprop="url" rel="index">
                    <span itemprop="name">编程之路</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/design-pattern/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="design-pattern/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>原文地址：<a href="http://blog.csdn.net/beijiguangyong/article/details/6010756" target="_blank" rel="external">http://blog.csdn.net/beijiguangyong/article/details/6010756</a>  </p>
<pre><code>这篇文章并不是深入讲解各种设计模式该怎么使用，而是列举了23种设计模式的基本结构以及其使用目的和适用场景。这里没有转载图片，需要看图片的，可以到原文直接查看。
</code></pre><p>创建型<br>1\. Factory Method（工厂方法）<br>2\. Abstract Factory（抽象工厂）<br>3\. Builder（建造者）<br>4\. Prototype（原型）<br>5\. Singleton（单例）  </p>
<p>结构型<br>6\. Adapter Class/Object（适配器）<br>7\. Bridge（桥接）<br>8\. Composite（组合）<br>9\. Decorator（装饰）<br>10\. Facade（外观）<br>11\. Flyweight（享元）<br>12\. Proxy（代理）  </p>
<p>行为型<br>13\. Interpreter（解释器）<br>14\. Template Method（模板方法）<br>15\. Chain of Responsibility（责任链）<br>16\. Command（命令）<br>17\. Iterator（迭代器）<br>18\. Mediator（中介者）<br>19\. Memento（备忘录）<br>20\. Observer（观察者）<br>21\. State（状态）<br>22\. Strategy（策略）<br>23\. Visitor（访问者）  </p>
<p>创建型  </p>
<ol>
<li>Factory Method（工厂方法）  </li>
</ol>
<p>意图：<br>定义一个用于创建对象的接口，让子类决定实例化哪一个类。Factory Method使一个类的实例化延迟到其子类。<br>适用性：<br>当一个类不知道它所必须创建的对象的类的时候。<br>当一个类希望由它的子类来指定它所创建的对象的时候。<br>当类将创建对象的职责委托给多个帮助子类中的某一个，并且你希望将哪一个帮助子类是代理者这一信息局部化的时候。</p>
<ol>
<li>Abstract Factory（抽象工厂）  </li>
</ol>
<p>意图：<br>提供一个创建一系列相关或相互依赖对象的接口，而无需指定它们具体的类。  </p>
<p>适用性：<br>一个系统要独立于它的产品的创建、组合和表示时。<br>一个系统要由多个产品系列中的一个来配置时。<br>当你要强调一系列相关的产品对象的设计以便进行联合使用时。<br>当你提供一个产品类库，而只想显示它们的接口而不是实现时。  </p>
<ol>
<li>Builder（建造者）  </li>
</ol>
<p>意图：<br>将一个复杂对象的构建与它的表示分离，使得同样的构建过程可以创建不同的表示。  </p>
<p>适用性：<br>当创建复杂对象的算法应该独立于该对象的组成部分以及它们的装配方式时。<br>当构造过程必须允许被构造的对象有不同的表示时。</p>
<ol>
<li>Prototype（原型）  </li>
</ol>
<p>意图：<br>用原型实例指定创建对象的种类，并且通过拷贝这些原型创建新的对象。  </p>
<p>适用性：<br>当要实例化的类是在运行时刻指定时，例如，通过动态装载；或者<br>为了避免创建一个与产品类层次平行的工厂类层次时；或者<br>当一个类的实例只能有几个不同状态组合中的一种时。建立相应数目的原型并克隆它们可能比每次用合适的状态手工实例化该类更方便一些。</p>
<ol>
<li>Singleton（单例）<br>意图：<br>保证一个类仅有一个实例，并提供一个访问它的全局访问点。  </li>
</ol>
<p>适用性：<br>当类只能有一个实例而且客户可以从一个众所周知的访问点访问它时。<br>当这个唯一实例应该是通过子类化可扩展的，并且客户应该无需更改代码就能使用一个扩展的实例时。</p>
<ol>
<li>Adapter Class/Object（适配器）  </li>
</ol>
<p>意图：<br>将一个类的接口转换成客户希望的另外一个接口。Adapter模式使得原本由于接口不兼容而不能一起工作的那些类可以一起工作。  </p>
<p>适用性：<br>你想使用一个已经存在的类，而它的接口不符合你的需求。<br>你想创建一个可以复用的类，该类可以与其他不相关的类或不可预见的类（即那些接口可能不一定兼容的类）协同工作。<br>（仅适用于对象Adapter）你想使用一些已经存在的子类，但是不可能对每一个都进行子类化以匹配它们的接口。对象适配器可以适配它的父类接口。</p>
<ol>
<li>Bridge（桥接）  </li>
</ol>
<p>意图：<br>将抽象部分与它的实现部分分离，使它们都可以独立地变化。  </p>
<p>适用性：<br>你不希望在抽象和它的实现部分之间有一个固定的绑定关系。例如这种情况可能是因为，在程序运行时刻实现部分应可以被选择或者切换。<br>类的抽象以及它的实现都应该可以通过生成子类的方法加以扩充。这时Bridge模式使你可以对不同的抽象接口和实现部分进行组合，并分别对它们进行扩充。<br>对一个抽象的实现部分的修改应对客户不产生影响，即客户的代码不必重新编译。<br>（C++）你想对客户完全隐藏抽象的实现部分。在C++中，类的表示在类接口中是可见的。<br>有许多类要生成。这样一种类层次结构说明你必须将一个对象分解成两个部分。Rumbaugh称这种类层次结构为“嵌套的普化”（nested<br>generalizations ）。<br>你想在多个对象间共享实现（可能使用引用计数），但同时要求客户并不知道这一点。一个简单的例子便是Coplien的String类[ Cop92<br>]，在这个类中多个对象可以共享同一个字符串表示（StringRep）。</p>
<ol>
<li>Composite（组合）  </li>
</ol>
<p>意图：<br>将对象组合成树形结构以表示“部分-整体”的层次结构。C o m p o s i t e 使得用户对单个对象和组合对象的使用具有一致性。  </p>
<p>适用性：<br>你想表示对象的部分-整体层次结构。<br>你希望用户忽略组合对象与单个对象的不同，用户将统一地使用组合结构中的所有对象。</p>
<ol>
<li>Decorator（装饰）  </li>
</ol>
<p>意图：<br>动态地给一个对象添加一些额外的职责。就增加功能来说，Decorator模式相比生成子类更为灵活。  </p>
<p>适用性：<br>在不影响其他对象的情况下，以动态、透明的方式给单个对象添加职责。<br>处理那些可以撤消的职责。<br>当不能采用生成子类的方法进行扩充时。一种情况是，可能有大量独立的扩展，为支持每一种组合将产生大量的子类，使得子类数目呈爆炸性增长。另一种情况可能是因为类定义<br>被隐藏，或类定义不能用于生成子类。</p>
<ol>
<li>Facade（外观）  </li>
</ol>
<p>意图：<br>为子系统中的一组接口提供一个一致的界面，Facade模式定义了一个高层接口，这个接口使得这一子系统更加容易使用。  </p>
<p>适用性：<br>当你要为一个复杂子系统提供一个简单接口时。子系统往往因为不断演化而变得越来越复杂。大多数模式使用时都会产生更多更小的类。这使得子系统更具可重用性，也更容易对<br>子系统进行定制，但这也给那些不需要定制子系统的用户带来一些使用上的困难。Facade可以提供一个简单的缺省视图，这一视图对大多数用户来说已经足够，而那些需要<br>更多的可定制性的用户可以越过facade层。<br>客户程序与抽象类的实现部分之间存在着很大的依赖性。引入facade将这个子系统与客户以及其他的子系统分离，可以提高子系统的独立性和可移植性。<br>当你需要构建一个层次结构的子系统时，使用facade模式定义子系统中每层的入口点。如果子系统之间是相互依赖的，你可以让它们仅通过facade进行通讯，从而简<br>化了它们之间的依赖关系。</p>
<ol>
<li>Flyweight（享元）  </li>
</ol>
<p>意图：<br>运用共享技术有效地支持大量细粒度的对象。  </p>
<p>适用性：<br>一个应用程序使用了大量的对象。<br>完全由于使用大量的对象，造成很大的存储开销。<br>对象的大多数状态都可变为外部状态。<br>如果删除对象的外部状态，那么可以用相对较少的共享对象取代很多组对象。<br>应用程序不依赖于对象标识。由于Flyweight对象可以被共享，对于概念上明显有别的对象，标识测试将返回真值。</p>
<ol>
<li>Proxy（代理）  </li>
</ol>
<p>意图：<br>为其他对象提供一种代理以控制对这个对象的访问。  </p>
<p>适用性：<br>在需要用比较通用和复杂的对象指针代替简单的指针的时，使用Proxy模式。下面是一些可以使用Proxy模式常见情况：<br>1) 远程代理（Remote Proxy）为一个对象在不同的地址空间提供局部代表。<br>NEXTSTEP[Add94]使用NXProxy类实现了这一目的。Coplien[Cop92]称这种代理为“大使”（Ambassador）。<br>2 )虚代理（Virtual Proxy）根据需要创建开销很大的对象。在动机一节描述的ImageProxy就是这样一种代理的例子。<br>3) 保护代理（Protection Proxy）控制对原始对象的访问。保护代理用于对象应该有不同的访问权限的时候。例如，在Choices操作系统[<br>CIRM93]中KemelProxies为操作系统对象提供了访问保护。<br>4 )智能指引（Smart Reference）取代了简单的指针，它在访问对象时执行一些附加操作。它的典型用途包括：  </p>
<p>对指向实际对象的引用计数，这样当该对象没有引用时，可以自动释放它(也称为SmartPointers[Ede92 ] )。<br>当第一次引用一个持久对象时，将它装入内存。<br>在访问一个实际对象前，检查是否已经锁定了它，以确保其他对象不能改变它。</p>
<ol>
<li>Interpreter（解释器）  </li>
</ol>
<p>意图：<br>给定一个语言，定义它的文法的一种表示，并定义一个解释器，这个解释器使用该表示来解释语言中的句子。  </p>
<p>适用性：<br>当有一个语言需要解释执行,并且你可将该语言中的句子表示为一个抽象语法树时，可使用解释器模式。而当存在以下情况时该模式效果最好：  </p>
<p>该文法简单对于复杂的文法,文法的类层次变得庞大而无法管理。此时语法分析程序生成器这样的工具是更好的选择。它们无需构建抽象语法树即可解释表达式,这样可以节省空<br>间而且还可能节省时间。  </p>
<p>效率不是一个关键问题最高效的解释器通常不是通过直接解释语法分析树实现的,而是首先将它们转换成另一种形式。例如，正则表达式通常被转换成状态机。但即使在这种情况<br>下,转换器仍可用解释器模式实现,该模式仍是有用的。</p>
<ol>
<li>Template Method（模板方法）  </li>
</ol>
<p>意图：<br>定义一个操作中的算法的骨架，而将一些步骤延迟到子类中。TemplateMethod使得子类可以不改变一个算法的结构即可重定义该算法的某些特定步骤。  </p>
<p>适用性：<br>一次性实现一个算法的不变的部分，并将可变的行为留给子类来实现。<br>各子类中公共的行为应被提取出来并集中到一个公共父类中以避免代码重复。这是Opdyke和Johnson所描述过的“重分解以一般化”的一个很好的例子[ OJ93<br>]。首先识别现有代码中的不同之处，并且将不同之处分离为新的操作。最后，用一个调用这些新的操作的模板方法来替换这些不同的代码。<br>控制子类扩展。模板方法只在特定点调用“hook ”操作（参见效果一节），这样就只允许在这些点进行扩展。</p>
<ol>
<li>Chain of Responsibility（责任链）  </li>
</ol>
<p>意图：<br>使多个对象都有机会处理请求，从而避免请求的发送者和接收者之间的耦合关系。将这些对象连成一条链，并沿着这条链传递该请求，直到有一个对象处理它为止。  </p>
<p>适用性：<br>有多个的对象可以处理一个请求，哪个对象处理该请求运行时刻自动确定。<br>你想在不明确指定接收者的情况下，向多个对象中的一个提交一个请求。<br>可处理一个请求的对象集合应被动态指定。</p>
<ol>
<li>Command（命令）  </li>
</ol>
<p>意图：<br>将一个请求封装为一个对象，从而使你可用不同的请求对客户进行参数化；对请求排队或记录请求日志，以及支持可撤消的操作。  </p>
<p>适用性：<br>抽象出待执行的动作以参数化某对象，你可用过程语言中的回调（call<br>back）函数表达这种参数化机制。所谓回调函数是指函数先在某处注册，而它将在稍后某个需要的时候被调用。Command模式是回调机制的一个面向对象的替代品。<br>在不同的时刻指定、排列和执行请求。一个Command对象可以有一个与初始请求无关的生存期。如果一个请求的接收者可用一种与地址空间无关的方式表达，那么就可将负<br>责该请求的命令对象传送给另一个不同的进程并在那儿实现该请求。<br>支持取消操作。Command的Excute操作可在实施操作前将状态存储起来，在取消操作时这个状态用来消除该操作的影响。Command接口必须添加一个Unex<br>ecute操作，该操作取消上一次Execute调用的效果。执行的命令被存储在一个历史列表中。可通过向后和向前遍历这一列表并分别调用Unexecute和Exe<br>cute来实现重数不限的“取消”和“重做”。<br>支持修改日志，这样当系统崩溃时，这些修改可以被重做一遍。在Command接口中添加装载操作和存储操作，可以用来保持变动的一个一致的修改日志。从崩溃中恢复的过<br>程包括从磁盘中重新读入记录下来的命令并用Execute操作重新执行它们。<br>用构建在原语操作上的高层操作构造一个系统。这样一种结构在支持事务( transaction)的信息系统中很常见。一个事务封装了对数据的一组变动。Comman<br>d模式提供了对事务进行建模的方法。Command有一个公共的接口，使得你可以用同一种方式调用所有的事务。同时使用该模式也易于添加新事务以扩展系统。</p>
<ol>
<li>Iterator（迭代器）  </li>
</ol>
<p>意图：<br>提供一种方法顺序访问一个聚合对象中各个元素,而又不需暴露该对象的内部表示。  </p>
<p>适用性：<br>访问一个聚合对象的内容而无需暴露它的内部表示。<br>支持对聚合对象的多种遍历。<br>为遍历不同的聚合结构提供一个统一的接口(即,支持多态迭代)。</p>
<ol>
<li>Mediator（中介者）  </li>
</ol>
<p>意图：<br>用一个中介对象来封装一系列的对象交互。中介者使各对象不需要显式地相互引用，从而使其耦合松散，而且可以独立地改变它们之间的交互。  </p>
<p>适用性：<br>一组对象以定义良好但是复杂的方式进行通信。产生的相互依赖关系结构混乱且难以理解。<br>一个对象引用其他很多对象并且直接与这些对象通信,导致难以复用该对象。<br>想定制一个分布在多个类中的行为，而又不想生成太多的子类。</p>
<ol>
<li>Memento（备忘录）  </li>
</ol>
<p>意图：<br>在不破坏封装性的前提下，捕获一个对象的内部状态，并在该对象之外保存这个状态。这样以后就可将该对象恢复到原先保存的状态。  </p>
<p>适用性：<br>必须保存一个对象在某一个时刻的(部分)状态,这样以后需要时它才能恢复到先前的状态。<br>如果一个用接口来让其它对象直接得到这些状态，将会暴露对象的实现细节并破坏对象的封装性。</p>
<ol>
<li>Observer（观察者）  </li>
</ol>
<p>意图：<br>定义对象间的一种一对多的依赖关系,当一个对象的状态发生改变时,所有依赖于它的对象都得到通知并被自动更新。  </p>
<p>适用性：<br>当一个抽象模型有两个方面,其中一个方面依赖于另一方面。将这二者封装在独立的对象中以使它们可以各自独立地改变和复用。<br>当对一个对象的改变需要同时改变其它对象,而不知道具体有多少对象有待改变。<br>当一个对象必须通知其它对象，而它又不能假定其它对象是谁。换言之,你不希望这些对象是紧密耦合的。</p>
<ol>
<li>State（状态）  </li>
</ol>
<p>意图：<br>允许一个对象在其内部状态改变时改变它的行为。对象看起来似乎修改了它的类。  </p>
<p>适用性：<br>一个对象的行为取决于它的状态,并且它必须在运行时刻根据状态改变它的行为。<br>一个操作中含有庞大的多分支的条件语句，且这些分支依赖于该对象的状态。这个状态通常用一个或多个枚举常量表示。通常,有多个操作包含这一相同的条件结构。State<br>模式将每一个条件分支放入一个独立的类中。这使得你可以根据对象自身的情况将对象的状态作为一个对象，这一对象可以不依赖于其他对象而独立变化。</p>
<ol>
<li>Strategy（策略）  </li>
</ol>
<p>意图：<br>定义一系列的算法,把它们一个个封装起来,并且使它们可相互替换。本模式使得算法可独立于使用它的客户而变化。  </p>
<p>适用性：<br>许多相关的类仅仅是行为有异。“策略”提供了一种用多个行为中的一个行为来配置一个类的方法。<br>需要使用一个算法的不同变体。例如，你可能会定义一些反映不同的空间/时间权衡的算法。当这些变体实现为一个算法的类层次时[H087] ,可以使用策略模式。<br>算法使用客户不应该知道的数据。可使用策略模式以避免暴露复杂的、与算法相关的数据结构。<br>一个类定义了多种行为,并且这些行为在这个类的操作中以多个条件语句的形式出现。将相关的条件分支移入它们各自的Strategy类中以代替这些条件语句。</p>
<ol>
<li>Visitor（访问者）  </li>
</ol>
<p>意图：<br>定义一个操作中的算法的骨架，而将一些步骤延迟到子类中。TemplateMethod使得子类可以不改变一个算法的结构即可重定义该算法的某些特定步骤。  </p>
<p>适用性：<br>一次性实现一个算法的不变的部分，并将可变的行为留给子类来实现。<br>各子类中公共的行为应被提取出来并集中到一个公共父类中以避免代码重复。这是Opdyke和Johnson所描述过的“重分解以一般化”的一个很好的例子[OJ93]<br>。首先识别现有代码中的不同之处，并且将不同之处分离为新的操作。最后，用一个调用这些新的操作的模板方法来替换这些不同的代码。<br>控制子类扩展。模板方法只在特定点调用“hook ”操作（参见效果一节），这样就只允许在这些点进行扩展。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/mysql-optimization/" itemprop="url">
                  MySQL之调优方法
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-12-10T08:25:34+08:00" content="2015-12-10">
              2015-12-10
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/编程之路/" itemprop="url" rel="index">
                    <span itemprop="name">编程之路</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/mysql-optimization/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="mysql-optimization/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li>数据库分析调优步骤  </li>
</ul>
<pre><code>    1.将sql语句记录下来
2.看查询更新的比例(如果太多，可以抽样查看)
3.看最多查询的数据表有哪些，最多更新的数据表有哪些
4.看最多查询的数据表最多查询的SQL是什么样子的，最多更新的数据表最多执行的SQL语句是怎样的，算出各自每秒的请求频率
5.关键分析，最多查询的SQL，基于同一主键查询的比例多不多(看能不能缓存化)
6.应对大翻页的问题，其实是不需要精确的返回结果数的，像淘宝这些都不会超过100页的
</code></pre><ul>
<li>数据库配置：  </li>
</ul>
<pre><code>innodb_read_io_threads/innodb_write_io_threads：这两个参数指Innodb数据库读写的IO进程数，默认为4
</code></pre><ul>
<li>慢查询日志：  </li>
</ul>
<pre><code>    # 开启慢查询
&gt; show variables like &apos;slow_query_log&apos;   # 查看是否开起慢查询
&gt; set global slow_query_log_file = &apos;&apos;
&gt; set global log_queries_not_using_indexes = on
&gt; set global long_query_time = 1
</code></pre><ul>
<li><p>分库分表<br>表的垂直拆分：把原来一个有很多列的表拆分成多个表，解决了表宽的问题，通常，把不常用的字段单独存放到一个表中，大字段单独存放，一起使用的字段一起存放</p>
</li>
<li><p>语句分析：使用explan查询SQL的执行计划</p>
</li>
<li>其它工具  </li>
</ul>
<pre><code>Mysqldumpslow：慢查询日志的分析工具
</code></pre>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/mysql-design-tips/" itemprop="url">
                  MySQL之设计方法
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-12-10T08:16:46+08:00" content="2015-12-10">
              2015-12-10
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/编程之路/" itemprop="url" rel="index">
                    <span itemprop="name">编程之路</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/mysql-design-tips/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="mysql-design-tips/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="关于架构"><a href="#关于架构" class="headerlink" title="关于架构"></a>关于架构</h2><ul>
<li>一般把读取的请求放在缓存(Redis)，而更新请求放在数据库</li>
</ul>
<h2 id="关于索引"><a href="#关于索引" class="headerlink" title="关于索引"></a>关于索引</h2><ul>
<li>数据查询只能用到一个索引，不过这个只是说的是单表查询，联表查询实际上每个表都可以用到其独立的索引</li>
<li><p>有些时候索引并不会用到，比如<br>where key like ‘keyword\%’：这里可以用到key索引<br>where key like ‘\%keyword\%’：这里用不到key的索引</p>
</li>
<li><p>适当建立复合索引：<br>前几天看了“caoz的梦呓”的文章《如何应对并发(1) - 关于数据索引》，理解了建立复合索引所需要考虑的一些东西，顺序不同效率也有很大的不同。<br>‘SELECT * FROM user where area = ‘$area’ order by lastlogin desc limit 30;’<br>如果只把area当做索引，那么数据库会把符合这个area的所有结果都拿出来，然后按照lastlogin来进行排序；<br>如果只把lastlogin做为索引，那么数据库会从最后一条开始往前遍历，每条都会对比area，直到数出30条<br>如果lastlogin+area建立符合，和单独lastlogin索引是一样的<br>如果area+lastlogin，把两个字段拼接然后排好序后，看这条SQL在这个数列中查询的提现，所命中的完全是连续的30条，仅仅遍历30条索引即可<br>我最先以为简历复合索引也会是先查找出area，再拿出来排序哟，但其实索引都是预先排好了的，这里就相当于先按照area排序，area相同的再按照lastlog<br>in进行排序，这样，只要找到area，然后取前面30条就可以了，就像电话簿一样，先找姓氏，姓氏相同的也会按照名排好序的。</p>
</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/raspberrypi/" itemprop="url">
                  玩转树莓派2
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-12-08T02:58:50+08:00" content="2015-12-08">
              2015-12-08
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/就是爱玩/" itemprop="url" rel="index">
                    <span itemprop="name">就是爱玩</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/raspberrypi/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="raspberrypi/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>想在家里做NAS、DNS等私有云服务，但是无奈家里淘汰下来的电脑已无力承担如此重任。没办法了，就只能试试树莓派。不试不知道，一试吓一跳，完全就是一手掌大小的<br>电脑，听说desktop版本还能使用word等软件，虽然只有1GB内存，但是200多块(淘宝店)就能买到这个东西，那是非常值了。当然，作为一个技术爱好者，别<br>人是完全无法体会这种快乐的。要是其功耗再低点或者能采用其它的供电方式(比如无线供电、电池供电)，感觉完全能颠覆智能市场。  </p>
<h2 id="制作启动镜像"><a href="#制作启动镜像" class="headerlink" title="制作启动镜像"></a><strong>制作启动镜像</strong></h2><p>镜像下载：<a href="https://www.raspberrypi.org/downloads/" target="_blank" rel="external">https://www.raspberrypi.org/downloads/</a>，我下载的是RASPBIAN分支，因为其是官方提供且基于Debian，和Ubuntu操作一样<br><strong>Mac环境</strong>：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">$ df  # 查看当前已经挂载的卷</div><div class="line">一般sd卡在最后，Filesystem是/dev/disk2s1，Mounted on /Volumes/No Name，可以在Finder里面将sd卡的名字改为Pi(我那个默认是No Name)</div><div class="line">$ diskutil unmount /dev/disk2s1   #将sd卡卸载</div><div class="line">Volume Pi on disk2s1 unmounted</div><div class="line">$ diskutil list # 查看是否有sd卡设备</div><div class="line">$ dd bs=4m if=pi.img of=/dev/rdisk2   #将镜像文件pi.img写入sd卡</div><div class="line">$ diskutil unmountDisk /dev/disk2  # 再卸载sd卡，此时可以拔出来插入树莓派的sd卡槽了</div></pre></td></tr></table></figure></p>
<h2 id="启动操作系统"><a href="#启动操作系统" class="headerlink" title="启动操作系统"></a><strong>启动操作系统</strong></h2><p>收到货的那天，发现其有一个DC接口，还以为是通过DC接口供电，出门走了一圈都没发现有卖这货的，于是回家，自习已看，发现可以用Android的电源为期供电的，<br>那接口名字忘了。和网上建议的一样，我采用的是5V 2A的供电设备(其实是直接插到小米插线板上的)<br>然后，我又发现，我家里没多的网线，那怎么办，我装的不是desktop版本，没有网线就不能SSH进去。不过还好，它支持HDMI，于是我把它功过HDMI连接上了<br>家里40英寸的电视，(HDMI高清显示，真他妈爽)就像这样，还通过USB插了外置键盘。<br><img src="http://7xnc86.com1.z0.glb.clouddn.com/raspberrypi_1.jpg" alt="">  </p>
<p>默认是通电自动启动的，所以插上电就会进入系统了，默认用户名pi，默认密码是raspberry，接着就做一些基本的配置，通过<code>sudo raspi-config</code>来运行设置工具：</p>
<ul>
<li>第一项将sd卡的剩余空间全部用来使用</li>
<li>然后修改international里面的时区及默认字符编码</li>
<li>接着修改源，这个国度没办法的事  </li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">$ sudo nano /etc/apt/sources.list.d/raspi.list</div><div class="line">修改为如下：</div><div class="line">deb http://mirrors.ustc.edu.cn/archive.raspberrypi.org/debian/ jessie main</div><div class="line">	</div><div class="line">$ sudo nano /etc/apt/sources.list  </div><div class="line">修改为如下：</div><div class="line">deb http://mirrors.ustc.edu.cn/raspbian/raspbian/ jessie main non-free contrib  </div><div class="line">deb-src http://mirrors.ustc.edu.cn/raspbian/raspbian/ jessie main non-free contrib</div></pre></td></tr></table></figure>
<ul>
<li><p>最后，安装必要的软件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sudo apt-get update &amp;&amp; apt-get upgrade </div><div class="line">sudo apt-get install vim tree ttf-wqy-microhei python python3 python-dev python3-dev python-pip python3-pip zsh git -y</div></pre></td></tr></table></figure>
</li>
<li><p>中文环境配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo dpkg-reconfigure locales</div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="WIFI设置"><a href="#WIFI设置" class="headerlink" title="WIFI设置"></a><strong>WIFI设置</strong></h2><p>当然，我不可能一直用电视作显示器吧，这时候我买的无线设备就有用场了，直接通过USB插到树莓派上，然后设置wifi  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">$ ifconfig # 可以看到wlan0，表示已经识别无线网卡</div><div class="line">$ sudo vim /etc/network/interfaces添加或修改关于wlan0的配置</div><div class="line">auto wlan0</div><div class="line">allow-hotplug wlan0</div><div class="line">iface wlan0 inet dhcp</div><div class="line">wpa-ssid WIFI名称</div><div class="line">wpa-psk WIFI密码</div><div class="line"></div><div class="line"># 然后通过如下命令重启网卡</div><div class="line">sudo ifdown wlan0 &amp;&amp; sudo ifup wlan0</div></pre></td></tr></table></figure>
<p>注：如果要关机，务必使用命令关机，而不要物理直接断，当然开机貌似只能拔了电源再插上</p>
<h2 id="搭建ownCloud私有云"><a href="#搭建ownCloud私有云" class="headerlink" title="搭建ownCloud私有云"></a><strong>搭建ownCloud私有云</strong></h2><p>作为私有云方案，我选择的ownCloud，而不是Samba，因为Samba功能仅仅算是ftp的共享，而不是一个私有云方案，当然ownCloud也有为人诟病的<br>地方，比如内存占用高(树莓派2上占用100多MB)，另一个是因为它本身是基于Apache的，树莓派内存总共就1G，我可不想既有Apache又有Nginx，所<br>以直接用的是Nginx+php5-fpm的方案，不过这样子，配置过程就有点麻烦了。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"># 首先，安装基本服务</div><div class="line">sudo apt-get install php5-common php5-cli php5-fpm</div><div class="line">sudo apt-get install nginx</div><div class="line">sudo apt-get install mysql-server mysql-client</div><div class="line"></div><div class="line"># 配置MySQL，ownCloud需要提前创建用户、数据库和分配权限</div><div class="line">&gt; create database 库名 character set utf8 collate utf8_general_ci;  </div><div class="line">&gt; grant ALL on 库名.* 用户名@localhost identified by &quot;密码&quot;   # 注意，ownCloud是不允许root用户的，因为权限太多</div><div class="line"></div><div class="line"># 配置文件权限</div><div class="line">chmod 775 -R owncloud/        # 不要分配777，分配了也不能用</div><div class="line">chown -R www-data:www-data owncloud/</div><div class="line"></div><div class="line"># 配置php5-fpm</div><div class="line">$ printenv PATH 获取系统环境变量</div><div class="line">vim /etc/php5/fpm/pool.d/www.conf，将下面几行前面的注释去掉</div><div class="line">;env[HOSTNAME] = $HOSTNAME  </div><div class="line">;env[PATH] = /usr/local/bin:/usr/bin:/bin      # 这里还要修改为刚才获取到的环境变量  </div><div class="line">;env[TMP] = /tmp  </div><div class="line">;env[TMPDIR] = /tmp  </div><div class="line">;env[TEMP] = /tmp</div><div class="line"></div><div class="line"># 配置nginx，按照官网的教程配置Nginx conf：https://doc.owncloud.org/server/7.0/admin_manual/installation/nginx_configuration.html</div><div class="line"></div><div class="line">对于官网的配置，我做了如下几项修改：</div><div class="line">location ~ .php(?:$|/)$这里面修改为：</div><div class="line">location ~ ^(.+?.php)(/.*)?$ \&#123;  </div><div class="line">  fastcgi_split_path_info ^(.+.php)(/.+)$;  </div><div class="line">  include fastcgi_params;  </div><div class="line">  fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;  </div><div class="line">  fastcgi_param PATH_INFO $fastcgi_path_info;  </div><div class="line">  fastcgi_pass unix:/var/run/php5-fpm.sock;  </div><div class="line">  fastcgi_index index.php;  </div><div class="line">  include fastcgi_params;  </div><div class="line">  fastcgi_param PHP_VALUE &quot;post_max_size=10G \\n upload_max_filesize=10G&quot;;   # 上传默认居然为513MB，这里可以修改大，不然在owncloud无法调整到更大  </div><div class="line">\&#125;</div><div class="line">检查配置文件是否正确用# nginx -t nginx.conf</div></pre></td></tr></table></figure>
<h2 id="TroubleShooting"><a href="#TroubleShooting" class="headerlink" title="TroubleShooting"></a>TroubleShooting</h2><ul>
<li><strong>中文设置</strong>:</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">sudo raspi-config</div><div class="line">去掉en_GB.UTF-8 UTF-8</div><div class="line">选择“en_US.UTF-8 UTF-8”、“zh_CN.UTF-8 UTF-8”、“zh_CN.GBK GBK”</div><div class="line">然后第二个页面默认语言选择en_GB.UTF-8 UTF-8</div></pre></td></tr></table></figure>
<p>参考：<br><a href="http://blog.akar
in.xyz/raspberry-
init/https://github.com/ccforward/cc/issues/25?utm_source=tuicool" title="Link:
http://blog.akarin.xyz/raspberry-
init/https://github.com/ccforward/cc/issues/25?utm_source=tuicool" target="_blank" rel="external">http://blog.akarin.xyz/raspberry-init/<br>https://github.com/ccforward/cc/issues/25?utm_source=tuicool</a>  </p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/database-application-scenarios/" itemprop="url">
                  各种数据库的应用场景
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-12-07T07:48:21+08:00" content="2015-12-07">
              2015-12-07
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/编程之路/" itemprop="url" rel="index">
                    <span itemprop="name">编程之路</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/database-application-scenarios/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="database-application-scenarios/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li><h1 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a><strong>Redis</strong></h1></li>
</ul>
<p>统计：比如行为指标、点击量统计、访问量统计、排行榜、最新或最高的N个数据等<br>缓存：会话缓存，页面缓存，全局变量缓存<br>队列：队列服务<br>过期：需要设置过期时间的数据</p>
<ul>
<li><h1 id="MongoDB"><a href="#MongoDB" class="headerlink" title="MongoDB"></a><strong>MongoDB</strong></h1></li>
</ul>
<p>文本：日志、文章等</p>
<ul>
<li></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/python-requests/" itemprop="url">
                  Python Requests模块进行网页抓取详解
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-12-04T08:02:53+08:00" content="2015-12-04">
              2015-12-04
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/编程之路/" itemprop="url" rel="index">
                    <span itemprop="name">编程之路</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/python-requests/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="python-requests/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>一直以来我都看不惯python自带的urllib包的繁琐的使用方法，所以我都使用的requests包来代替原生方法。它能方便的发送GET和POST请求，支<br>持HTTPS，基本上能模拟人类真实的访问  </p>
<h2 id="发送请求"><a href="#发送请求" class="headerlink" title="发送请求"></a>发送请求</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># GET请求</div><div class="line">response = requests.get(url)</div></pre></td></tr></table></figure>
<h2 id="自定义HTTP头，修改Headers"><a href="#自定义HTTP头，修改Headers" class="headerlink" title="自定义HTTP头，修改Headers"></a>自定义HTTP头，修改Headers</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">headers = &#123;</div><div class="line">	&apos;User-Agent&apos;: &apos;注意名称&apos;</div><div class="line">&#125;</div><div class="line">requests.get(url, headers=headers)</div></pre></td></tr></table></figure>
<h2 id="重定向"><a href="#重定向" class="headerlink" title="重定向"></a>重定向</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">response.status_code  #HTTP status，http状态码</div><div class="line"># 如果直接请求，如果发生重定向，那么response.status_code = 200, response.history = 301</div><div class="line">print([x for x,y in A.__dict__.items() if type(y) == FunctionType])</div></pre></td></tr></table></figure>
<h1 id="TroubleShooting"><a href="#TroubleShooting" class="headerlink" title="TroubleShooting:"></a>TroubleShooting:</h1><ul>
<li><strong>设置最大重试次数</strong>:之前发现设置了timeout时间却没反应，原来是因为查询不到ip地址，导致在timeout时间内就已经默认在重试了，要设置就得先执行语句：<code>requests.adapters.DEFAULT_RETRIES=5</code></li>
<li><strong>user-agent列表﻿</strong>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">user_agent_list = [  </div><div class="line">    &apos;Mozilla/5.0 (Linux; Android 4.1.1; Nexus 7 Build/JRO03D) AppleWebKit/535.19 (KHTML, like Gecko) Chrome/18.0.1025.166  Safari/535.19&apos;,  </div><div class="line">    &apos;Mozilla/5.0 (Linux; U; Android 4.0.4; en-gb; GT-I9300 Build/IMM76D) AppleWebKit/534.30 (KHTML, like Gecko) Version/4.0 Mobile Safari/534.30&apos;,  </div><div class="line">    &apos;Mozilla/5.0 (Linux; U; Android 2.2; en-gb; GT-P1000 Build/FROYO) AppleWebKit/533.1 (KHTML, like Gecko) Version/4.0 Mobile Safari/533.1&apos;,  </div><div class="line">    &apos;Mozilla/5.0 (Android; Mobile; rv:14.0) Gecko/14.0 Firefox/14.0&apos;,  </div><div class="line">    &apos;Mozilla/5.0 (Android; Tablet; rv:14.0) Gecko/14.0 Firefox/14.0&apos;,  </div><div class="line">    &apos;Mozilla/5.0 (Macintosh; Intel Mac OS X 10.8; rv:21.0) Gecko/20100101 Firefox/21.0&apos;,  </div><div class="line">    &apos;Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:21.0) Gecko/20130331 Firefox/21.0&apos;,  </div><div class="line">    &apos;Mozilla/5.0 (Windows NT 6.2; WOW64; rv:21.0) Gecko/20100101 Firefox/21.0&apos;,  </div><div class="line">    &apos;Mozilla/5.0 (Linux; Android 4.0.4; Galaxy Nexus Build/IMM76B) AppleWebKit/535.19 (KHTML, like Gecko) Chrome/18.0.1025.133 Mobile Safari/535.19&apos;,  </div><div class="line">    &apos;Mozilla/5.0 (Linux; Android 4.1.2; Nexus 7 Build/JZ054K) AppleWebKit/535.19 (KHTML, like Gecko) Chrome/18.0.1025.166 Safari/535.19&apos;,  </div><div class="line">    &apos;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_7_2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/27.0.1453.93 Safari/537.36&apos;,  </div><div class="line">    &apos;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/535.11 (KHTML, like Gecko) Ubuntu/11.10 Chromium/27.0.1453.93 Chrome/27.0.1453.93 Safari/537.36&apos;,  </div><div class="line">    &apos;Mozilla/5.0 (Windows NT 6.2; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/27.0.1453.94 Safari/537.36&apos;,  </div><div class="line">    &apos;Mozilla/5.0 (iPhone; CPU iPhone OS 6_1_4 like Mac OS X) AppleWebKit/536.26 (KHTML, like Gecko) CriOS/27.0.1453.10 Mobile/10B350 Safari/8536.25&apos;,  </div><div class="line">    &apos;Mozilla/4.0 (Windows; MSIE 6.0; Windows NT 5.2)&apos;,  </div><div class="line">    &apos;Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.0)&apos;,  </div><div class="line">    &apos;Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.0; Trident/4.0)&apos;,  </div><div class="line">    &apos;Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Trident/5.0)&apos;,  </div><div class="line">    &apos;Mozilla/5.0 (compatible; WOW64; MSIE 10.0; Windows NT 6.2)&apos;,  </div><div class="line">    &apos;Opera/9.80 (Macintosh; Intel Mac OS X 10.6.8; U; en) Presto/2.9.168 Version/11.52&apos;,  </div><div class="line">    &apos;Opera/9.80 (Windows NT 6.1; WOW64; U; en) Presto/2.10.229 Version/11.62&apos;,  </div><div class="line">    &apos;Mozilla/5.0 (PlayBook; U; RIM Tablet OS 2.1.0; en-US) AppleWebKit/536.2+ (KHTML, like Gecko) Version/7.2.1.0 Safari/536.2+&apos;,  </div><div class="line">    &apos;Mozilla/5.0 (MeeGo; NokiaN9) AppleWebKit/534.13 (KHTML, like Gecko) NokiaBrowser/8.5.0 Mobile Safari/534.13&apos;,  </div><div class="line">    &apos;Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_6_6; en-US) AppleWebKit/533.20.25 (KHTML, like Gecko) Version/5.0.4 Safari/533.20.27&apos;,  </div><div class="line">    &apos;Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US) AppleWebKit/533.20.25 (KHTML, like Gecko) Version/5.0.4 Safari/533.20.27&apos;,  </div><div class="line">    &apos;Mozilla/5.0 (iPad; CPU OS 5_0 like Mac OS X) AppleWebKit/534.46 (KHTML, like Gecko) Version/5.1 Mobile/9A334 Safari/7534.48.3&apos;,  </div><div class="line">    &apos;Mozilla/5.0 (iPhone; CPU iPhone OS 5_0 like Mac OS X) AppleWebKit/534.46 (KHTML, like Gecko) Version/5.1 Mobile/9A334 Safari/7534.48.3&apos;,  </div><div class="line">    &apos;Mozilla/5.0 (iPad; CPU OS 5_0 like Mac OS X) AppleWebKit/534.46 (KHTML, like Gecko) Version/5.1 Mobile/9A334 Safari/7534.48.3&apos;,  </div><div class="line">]</div></pre></td></tr></table></figure></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/internal-network-penetration/" itemprop="url">
                  内网穿透方案
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-12-04T07:39:55+08:00" content="2015-12-04">
              2015-12-04
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/编程之路/" itemprop="url" rel="index">
                    <span itemprop="name">编程之路</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/internal-network-penetration/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="internal-network-penetration/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h5 id="背景：天朝大局域网，网上都说可以打电话叫客服切换到公网IP，但是电信、移动宽带，无论打客服还是安装师傅，居然从上到下都不知道公网IP是什么，他们以为我"><a href="#背景：天朝大局域网，网上都说可以打电话叫客服切换到公网IP，但是电信、移动宽带，无论打客服还是安装师傅，居然从上到下都不知道公网IP是什么，他们以为我" class="headerlink" title="背景：天朝大局域网，网上都说可以打电话叫客服切换到公网IP，但是电信、移动宽带，无论打客服还是安装师傅，居然从上到下都不知道公网IP是什么，他们以为我"></a>背景：天朝大局域网，网上都说可以打电话叫客服切换到公网IP，但是电信、移动宽带，无论打客服还是安装师傅，居然从上到下都不知道公网IP是什么，他们以为我</h5><p>要公网IP是要独立宽带，公网IP和共享宽带明明是两个概念好不好，你可以封80端口，但是其它什么端口至少给我留一个总行吧，客服没用，就只能自己动手了。  </p>
<h2 id="方案一：SSH-Tunnel"><a href="#方案一：SSH-Tunnel" class="headerlink" title="方案一：SSH Tunnel"></a>方案一：SSH Tunnel</h2><p>使用SSH进行的Tunnel进行端口转发，对于不需要访问desktop来说是最简单的一种内网穿透方案，当然，唯一的要求是你得有一个有公网IP的服务器做代理。  </p>
<ol>
<li>首先，在内网主机上执行ssh命令：  </li>
</ol>
<pre><code>ssh -NfR 外网ssh端口号:localhost:本地ssh端口号 远端IP
</code></pre><ol>
<li>在代理服务器上执行通过ssh连接内网的服务器：  </li>
</ol>
<pre><code>ssh -p 刚才定义的远程端口号  localhost
</code></pre><ol>
<li>SSH太容易掉线了，为了不掉线，有多种方法：  </li>
</ol>
<pre><code>    # 首先，修改SSH配置
代理服务器段：vim /etc/ssh/sshd_config，修改或新增如下两项


ClinetAliveInterval 60
ClientAliveCountMax 10
然后重启SSH服务：service sshd restart

内网服务器端：vim /etc/ssh/ssh_config，修改或新增


Host *
ServerAliveInterval 30

# 但其实，这两种方法都还是容易掉线，接下来，终极解决方案  



写一个python脚本，然后nohup keepalived.py &amp;，在脚本里新建一个ssh连接，不断发送空格即可

```
#!/usr/bin/python
#coding: utf-8
import paramiko, time

class myssh():  
    def **init**(self, ip, port, username, password):  
    self.ssh = paramiko.SSHClient()  
    self.ssh.set_missing_host_key_policy(paramiko.AutoAddPolicy())  
    self.ssh.connect(ip, port, username, password, timeout=5)  

    def exec(self, cmd):  
        return self.ssh.exec_command(cmd)  

if &apos;__name__ == &apos;__main__&apos;:  
    ssh = myssh(&apos;localhost&apos;, 8022, &apos;haofly&apos;, &apos;896499825&apos;)  
    while True:  
        ssh.exec(&apos; &apos;)  
        time.sleep(30)  
    ssh.close()
</code></pre><p><strong>推荐阅读</strong>：<br><a href="https://v2ex.com/t/268495#reply11" target="_blank" rel="external">几个内网穿透，内网网站穿透，内网端口映射到公网的服务推荐</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/blog-revision/" itemprop="url">
                  博客再次改版
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-12-02T12:46:10+08:00" content="2015-12-02">
              2015-12-02
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/编程之路/" itemprop="url" rel="index">
                    <span itemprop="name">编程之路</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/blog-revision/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="blog-revision/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>经过长达5个月的艰辛历程(实际的编程时间少之又少)，终于自己打造出了一个静态博客。虽然没有wordpress那么方便，虽然没有预期中那么漂亮，虽然还有很多功<br>能还没有完善，但是这是我第一次用自己的技术为自己做了一个“会用”的东西。</p>
<p>开博两年多了，从Github的octopress到wordpress再到自己搭建静态博客，写了总共一百多篇文章，由于本次改版采用的是大重构，所以我是一篇文章<br>一篇文章的迁移过来的，只是格式有些还没改动，不过大体能成型了。目前博客有我很喜欢的几大特点：</p>
<p>1.静态化，直接使用nginx实现html文件的静态访问</p>
<p>2.ajax异步提交评论，评论不会立即出发更新html的接口，而是后台审核后才能更新</p>
<p>3.SEO自己做，这个还有很多学习的地方</p>
<p>4.每篇文章对应一张大图，其实是自己爱上摄影后才选择的这个主题，因为这样不仅让我在每篇文章编写时用心，还能用心拍照片(当然，实在没照片的时候就使用的Pixe<br>bay的免费可商用的图片)</p>
<p>5.采用我最喜欢的Python语言进行编写(Djanago框架)</p>
<p>总之，这几个月很少更新博客，原因是公司的事情太多，自己没有合理利用好时间，所以导致这种这个局面。其实，最近几个月的实习，自己还是有很多感悟的，以后会陆续写成<br>文章发表出来的。也不知道有没有人看，反正，开心就好咯。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/python-connect-mysql/" itemprop="url">
                  Python3 使用MySQL Connector操作数据库
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-11-04T17:48:41+08:00" content="2015-11-04">
              2015-11-04
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/编程之路/" itemprop="url" rel="index">
                    <span itemprop="name">编程之路</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/python-connect-mysql/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="python-connect-mysql/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>参考文档：<br><a href="https://dev.mysql.com/doc/connector-python/en/" target="_blank" rel="external">https://dev.mysql.com/doc/connector-python/en/</a>  </p>
<p><a href="http://mysql-python.sourceforge.net/MySQLdb.html" target="_blank" rel="external">http://mysql-python.sourceforge.net/MySQLdb.html</a>  </p>
<h2 id="安装方法"><a href="#安装方法" class="headerlink" title="安装方法"></a>安装方法</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"># ubuntu</div><div class="line">sudo apt-get install python3-dev libmysqlclient-dev</div><div class="line">pip install mysqlclient</div><div class="line"></div><div class="line"># CentOS</div><div class="line">sudo yum install pytho3n-devel mysql-devel</div><div class="line">pip install mysqlclient</div></pre></td></tr></table></figure>
<h2 id="数据库的连接"><a href="#数据库的连接" class="headerlink" title="数据库的连接"></a>数据库的连接</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"># 使用Oracle官方提供的数据库引擎的连接方法</div><div class="line">import mysql.connector</div><div class="line">cnx = mysql.connector.connect(  </div><div class="line">                          user=&apos;&apos;,</div><div class="line">                          password=&apos;&apos;,</div><div class="line">                          host=&apos;&apos;,</div><div class="line">                          database=&apos;&apos;,  </div><div class="line">                          pool_size=3 # 连接池大小)</div><div class="line">cnx.close()</div><div class="line"></div><div class="line"># 使用基于MySQLdb的连接方法，比如mysqlclient</div><div class="line">import MySQLdb</div><div class="line">db = MySQLdb.connect(host=&apos;&apos;, user=&apos;&apos;, passwd=&apos;&apos;, db=&apos;&apos;, charset=&apos;utf8&apos;)</div><div class="line">cursor = db.cursor()</div></pre></td></tr></table></figure>
<h2 id="Difference：两个库的区别"><a href="#Difference：两个库的区别" class="headerlink" title="Difference：两个库的区别"></a>Difference：两个库的区别</h2><pre><code># MySQL Connector/Python
Oracle官方的实现，底层完全用C来实现
默认未开启cursorbuffer，如果需要则显式开启：cnx.cursor(buffered=True)或者mysql.connector.connect(buffered=True)，开启了buffer，可同时使用多个游标

# MySQLdb
不完全用C
默认开启了cursor的，会缓存结果，但是针对特别大的查询，可能会导致程序崩溃
</code></pre><h2 id="插入"><a href="#插入" class="headerlink" title="插入"></a>插入</h2><pre><code># 同时插入多条数据


data = [
    (&apos;a&apos;, &apos;b&apos;, &apos;c&apos;, &apos;d&apos;),
    (&apos;e&apos;, &apos;f&apos;, &apos;g&apos;, &apos;h&apos;)
]
stmt = &apos;INSERT INTO table_name (field_name1, field_name2) VALUES(\%s, \%s)&apos;
cursor.executemany(stmt, data)
</code></pre><h2 id="读取"><a href="#读取" class="headerlink" title="读取"></a>读取</h2><pre><code># 看了源码发现，fetchone/fatchmany/fetchall实现居然是一样的：https://github.com/PyMySQL/mysqlclient-python/blob/7d289b21728ab1a94bb1f0210a26367c6714d881/MySQLdb/cursors.py，结果都是一次取出保存，这三个方法就是在结果列表里面切片而已

# fetchone()举例
cursor.execute(&apos;select * FROM user&quot;)
row = cursor.fetchone()
while row is not None:
    print(row)
    row = cursor.fetchone()  

# cursor可以直接拿来做迭代器
cursor.execute(sql)
for row in cursor:
    print(row)

# fetchmany()：获取固定数量的结果，当然，每次fetch过后指针会偏移到后面那个地方
rows = cursor.fetchmany(size=1)
</code></pre><h1 id="TroubleShooting"><a href="#TroubleShooting" class="headerlink" title="TroubleShooting"></a>TroubleShooting</h1><ul>
<li>获取insert后的ID值  </li>
</ul>
<pre><code>db.insert_id()  # 表示上一次插入数据的ID
</code></pre><ul>
<li>多线程的情况下，出现错误”OperationalError:(2013, ‘Lost connection to MySQL server during query’)”，出现这种情况是因为在多线程的情况下，如果只有一个mysql连接，那么mysql该连接会在执行完一个线程后销毁，需要加锁，在线程里面修改全局变量，会导致该变量的引用出错  </li>
</ul>
<pre><code>    LOCK.acquire()  
mysql.cursor.execute(sql)  
result = mysql.cursor.fetchall()  
LOCK.release()  
print(len(result))
</code></pre><ul>
<li></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/supervisor-manage-processor/" itemprop="url">
                  使用Supervisor管理进程
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-08-11T10:07:33+08:00" content="2015-08-11">
              2015-08-11
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/编程之路/" itemprop="url" rel="index">
                    <span itemprop="name">编程之路</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/supervisor-manage-processor/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="supervisor-manage-processor/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>参考文章：<a href="http://segmentfault.com/a/1190000002991175" target="_blank" rel="external">http://segmentfault.com/a/1190000002991175</a>(原文中还有使用OneAPM安装Python探针的应用，可<br>以实时监控web应用数据，暂时还未实践)</p>
<p>supervisor是使用Python编写的进程管理软件，在实际开发中，一般用它来同时开始一批相关的进程，无论是Django的runserver还是直接管理<br>Nginx、Apache等，都比较方便，这里是其使用方法：</p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><pre><code># 不要用apt-get的方式安装，如果安装出现unix:///var/run/supervisor.sock no such file这样的错误，那么请参考：http://tuzii.me/diary/522dc528848eea683d7724f2/\%E8\%A7\%A3\%E5\%86\%B3ubuntu-supervisor-unix:var-run-supervisor.sock-no-such-file.\%E7\%9A\%84\%E6\%96\%B9\%E6\%B3\%95




sudo easy_install supervisor
echo_supervisord_conf &gt; supervisord.conf  # 生成一个配置文件
sudo supervisord -c supervisord.conf      # 使用该配置文件启动supervisord
sudo supervisorctl                        # 进入命令行界面管理进程
</code></pre><h2 id="设置一个进程"><a href="#设置一个进程" class="headerlink" title="设置一个进程"></a>设置一个进程</h2><pre><code># 在supervisord.conf里面添加如下内容
[program:frontend]                                           # 进程名
command=/usr/bin/python manage.py runserver 0.0.0.0:8000     # 启动该进程的命令
directory=/media/sf_company/frontend/frontend                # 在执行上面命令前切换到指定目录
startsecs=0
stopwaitsecs=0
autostart=false
autorestart=false
user=root
stdout_logfile=/root/log/8000_access.log                     # 访问日志
stderr_logfile=/root/log/8000_error.log                      # 错误日志
</code></pre><p>这样就创建了一个进程，进程的名称为frontend</p>
<h2 id="supervisorctl常用命令："><a href="#supervisorctl常用命令：" class="headerlink" title="supervisorctl常用命令："></a>supervisorctl常用命令：</h2><pre><code>start name    # 开始一个进程
stop name    # 终止一个进程
status   # 查看当前管理状态
</code></pre>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/14/">14</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/uploads/avatar.png"
               alt="haofly" />
          <p class="site-author-name" itemprop="name">haofly</p>
          <p class="site-description motion-element" itemprop="description">豪翔天下的个人博客</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">140</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              
                <span class="site-state-item-count">6</span>
                <span class="site-state-item-name">分类</span>
              
            </div>
          

          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/haoflynet" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/haoflynet" target="_blank" title="微博">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  微博
                </a>
              </span>
            
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-inline">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              小伙伴们
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="http://xiang.jwzcq.com" title="谢翔的博客" target="_blank">谢翔的博客</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://www.phodal.com" title="Phodal" target="_blank">Phodal</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://www.cnblogs.com/qingguo" title="qingguo" target="_blank">qingguo</a>
                </li>
              
            </ul>
          </div>
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2013 - 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">haofly</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.0.1"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  



  

    <script type="text/javascript">
      var disqus_shortname = 'haoflynet';
      var disqus_identifier = 'page/3/index.html';
      var disqus_title = "";
      var disqus_url = '';

      function run_disqus_script(disqus_script){
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      }

      run_disqus_script('count.js');
      
    </script>
  




  
  

  

  

  

</body>
</html>
